import {
  $o,
  Ae,
  B,
  C,
  Co,
  Do,
  Dr,
  Ee,
  Eo,
  Fe,
  Fr,
  G,
  Ge,
  H,
  I,
  Io,
  J,
  Jr,
  K,
  Le,
  O,
  Oe,
  Oo,
  Q,
  Qo,
  Re,
  Rr,
  S,
  So,
  T,
  Ue,
  V,
  W,
  X,
  Yo,
  Z,
  Zr,
  a,
  ae,
  as,
  b,
  bo,
  c,
  cs,
  de,
  ee,
  ge,
  go,
  he,
  i,
  j,
  k,
  ko,
  kr,
  lo,
  ls,
  me,
  mo,
  ms,
  n,
  no,
  o,
  oe,
  os,
  ot,
  po,
  qe,
  r,
  ro,
  rt,
  s,
  se,
  st,
  t,
  u,
  ue,
  uo,
  ut,
  v,
  vo,
  w,
  wo,
  x,
  xe,
  yo,
  ze
} from "./chunk-KXGQOUB2.js";

// node_modules/@sendbird/chat/lib/__bundle-092d5d2d.js
var ke;
var Pe = function() {
  function r2(e, t2, n2) {
    var r3, i2;
    this.width = 0, this.height = 0, this.realWidth = 0, this.realHeight = 0, this._requireAuth = false, this._iid = e, this.plainUrl = t2.url, this.width = t2.width, this.height = t2.height, this.realWidth = null !== (r3 = t2.real_width) && void 0 !== r3 ? r3 : t2.width, this.realHeight = null !== (i2 = t2.real_height) && void 0 !== i2 ? i2 : t2.height, this._requireAuth = n2;
  }
  return r2.payloadify = function(n2) {
    return se(oe(n2 instanceof r2 ? { url: n2.plainUrl, width: n2.width, height: n2.height, real_width: n2.realWidth, real_height: n2.realHeight } : { url: "", width: n2.maxWidth, height: n2.maxHeight, real_width: 0, real_height: 0 }));
  }, Object.defineProperty(r2.prototype, "url", { get: function() {
    var e = uo.of(this._iid).sessionManager;
    return this._requireAuth && e.ekey ? "".concat(this.plainUrl, "?auth=").concat(e.ekey) : this.plainUrl;
  }, enumerable: false, configurable: true }), r2;
}();
var Re2 = function(t2) {
  function n2(n3) {
    var r2 = t2.call(this) || this;
    if (r2.method = ae.POST, r2.path = "".concat(he), r2.params = se({ file: n3.file, channel_url: n3.channelUrl }), n3.thumbnailSizes)
      for (var a2 = 0; a2 < n3.thumbnailSizes.length; a2++) {
        var o2 = n3.thumbnailSizes[a2], u2 = o2.maxWidth, c2 = o2.maxHeight;
        r2.params["thumbnail".concat(a2 + 1)] = "".concat(u2, ",").concat(c2);
      }
    return r2.requestId = n3.requestId, r2;
  }
  return t(n2, t2), n2;
}(Fe);
var xe2 = function(e) {
  function t2(t3, n2) {
    var r2, i2, s3, a2, o2 = this;
    return (o2 = e.call(this, t3, n2) || this).url = n2.url, o2.fileSize = null !== (r2 = n2.file_size) && void 0 !== r2 ? r2 : 0, o2.thumbnails = null !== (s3 = null === (i2 = n2.thumbnails) || void 0 === i2 ? void 0 : i2.map(function(e2) {
      return new Pe(t3, e2, false);
    })) && void 0 !== s3 ? s3 : [], o2.requireAuth = null !== (a2 = n2.require_auth) && void 0 !== a2 && a2, o2;
  }
  return t(t2, e), t2;
}(qe);
var De = function(n2) {
  function i2(e, t2) {
    var r2, i3, s3, a2, o2, u2 = this;
    return (u2 = n2.call(this, e) || this).replyCount = 0, u2.memberCount = 0, u2.lastRepliedAt = 0, u2.updatedAt = 0, u2.replyCount = null !== (r2 = t2.reply_count) && void 0 !== r2 ? r2 : 0, u2.memberCount = null !== (i3 = t2.member_count) && void 0 !== i3 ? i3 : 0, u2.mostRepliedUsers = t2.most_replies && C("object", t2.most_replies) ? t2.most_replies.map(function(e2) {
      return new ls(u2._iid, e2);
    }) : [], u2.unreadReplyCount = null !== (s3 = t2.unread_message_count) && void 0 !== s3 ? s3 : 0, u2.isPushNotificationEnabled = "number" == typeof t2.push_enabled ? t2.push_enabled > 0 : void 0, u2.lastRepliedAt = null !== (a2 = t2.last_replied_at) && void 0 !== a2 ? a2 : 0, u2.updatedAt = null !== (o2 = t2.updated_at) && void 0 !== o2 ? o2 : 0, u2;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { reply_count: r2.replyCount, unread_message_count: r2.unreadReplyCount, member_count: r2.memberCount, most_replies: Array.isArray(r2.mostRepliedUsers) ? r2.mostRepliedUsers.map(function(e) {
      return ls.payloadify(e);
    }) : [], push_enabled: "boolean" == typeof r2.isPushNotificationEnabled ? r2.isPushNotificationEnabled ? 1 : 0 : void 0, last_replied_at: r2.lastRepliedAt, updated_at: r2.updatedAt })));
  }, Object.defineProperty(i2.prototype, "_isUpdateRequired", { get: function() {
    return void 0 === this.unreadReplyCount || void 0 === this.isPushNotificationEnabled;
  }, enumerable: false, configurable: true }), i2.prototype._updateFrom = function(e) {
    var t2, n3;
    this.unreadReplyCount = null !== (t2 = e.unreadReplyCount) && void 0 !== t2 ? t2 : this.unreadReplyCount, this.isPushNotificationEnabled = null !== (n3 = e.isPushNotificationEnabled) && void 0 !== n3 ? n3 : this.isPushNotificationEnabled;
  }, i2;
}(Jr);
!function(e) {
  e.ADD = "add", e.DELETE = "delete";
}(ke || (ke = {}));
var Le2;
var Fe2 = function(e) {
  var t2;
  this.messageId = 0, this.operation = null, this.updatedAt = 0;
  var n2 = S("string", e.msg_id) ? parseInt(e.msg_id) : e.msg_id, r2 = e.user_id, i2 = e.operation ? e.operation.toLowerCase() : null, s3 = e.reaction, a2 = e.updated_at, o2 = e.count, u2 = e.sampled_user_ids, c2 = null !== (t2 = e.sampled_user_info) && void 0 !== t2 ? t2 : {};
  n2 && S("string", r2) && S("string", i2) && T(ke, i2) && S("string", s3) && s3 && S("number", a2) && (this.messageId = n2, this.userId = r2, this.key = s3, this.operation = i2, this.updatedAt = a2, this._count = o2, this._sampledUserIds = u2, this._sampledUserInfoList = c2);
};
var qe2 = function(e) {
  function t2(t3, n2, r2) {
    var i2, s3 = this;
    return (s3 = e.call(this, t3) || this).userId = n2, s3.nickname = r2.nickname, s3.plainProfileUrl = r2.profile_url, s3.requireAuth = null !== (i2 = r2.require_auth_for_profile_image) && void 0 !== i2 && i2, s3;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "profileUrl", { get: function() {
    var e2 = uo.of(this._iid).sessionManager;
    return this.requireAuth && e2.ekey ? "".concat(this.plainProfileUrl, "?auth=").concat(e2.ekey) : this.plainProfileUrl;
  }, enumerable: false, configurable: true }), t2.payloadify = function(e2) {
    return { nickname: e2.nickname, profile_url: e2.plainProfileUrl, require_auth_for_profile_image: e2.requireAuth };
  }, t2;
}(Jr);
var ze2 = function(i2) {
  function s3(e, t2) {
    var r2, s4, a2, o2, u2, c2, l, f, y, _ = this;
    (_ = i2.call(this, e) || this)._sampledUserInfoList = [], _._count = 0, _._hasCurrentUserReacted = false;
    var g = t2.key, b2 = c([], a(null !== (o2 = null !== (a2 = t2.sampled_user_ids) && void 0 !== a2 ? a2 : t2.user_ids) && void 0 !== o2 ? o2 : []), false), I2 = null !== (c2 = null !== (u2 = t2.last_ts) && void 0 !== u2 ? u2 : t2.updated_at) && void 0 !== c2 ? c2 : 0, E = null !== (l = t2.is_self_included) && void 0 !== l ? l : b2.includes(uo.of(e).sdkState.userId), T2 = null !== (f = t2.sampled_user_info) && void 0 !== f ? f : {};
    S("string", g) && g && C("string", b2) && b2.length > 0 && S("number", I2) && (_.key = g, _._sampledUserIds = b2, _._updatedAt = I2, _._count = null !== (y = t2.count) && void 0 !== y ? y : b2.length, _._hasCurrentUserReacted = E, Object.keys(T2).forEach(function(t3) {
      _._sampledUserInfoList.push(new qe2(e, t3, T2[t3]));
    }));
    var w2 = {};
    try {
      for (var M = o(_.sampledUserIds), S2 = M.next(); !S2.done; S2 = M.next()) {
        w2[S2.value] = _.updatedAt;
      }
    } catch (e2) {
      r2 = { error: e2 };
    } finally {
      try {
        S2 && !S2.done && (s4 = M.return) && s4.call(M);
      } finally {
        if (r2)
          throw r2.error;
      }
    }
    return _._version = w2, _;
  }
  return t(s3, i2), Object.defineProperty(s3.prototype, "isEmpty", { get: function() {
    return 0 === this._count;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "userIds", { get: function() {
    return this._sampledUserIds;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "sampledUserIds", { get: function() {
    return this._sampledUserIds;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "sampledUserInfoList", { get: function() {
    return this._sampledUserInfoList;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "count", { get: function() {
    return this._count;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "updatedAt", { get: function() {
    return this._updatedAt;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "hasCurrentUserReacted", { get: function() {
    return this._hasCurrentUserReacted;
  }, enumerable: false, configurable: true }), s3.payloadify = function(n2) {
    var r2 = {};
    return n2._sampledUserInfoList.forEach(function(e) {
      r2[e.userId] = qe2.payloadify(e);
    }), se(oe({ key: n2.key, sampled_user_ids: n2._sampledUserIds, sampled_user_info: r2, count: n2._count, is_self_included: n2._hasCurrentUserReacted, last_ts: n2._updatedAt }));
  }, s3.prototype.applyEvent = function(e) {
    var t2 = this;
    if (e.key === this.key && this.updatedAt <= e.updatedAt)
      if (e._sampledUserIds)
        this._sampledUserIds = e._sampledUserIds, this._sampledUserInfoList = [], Object.keys(e._sampledUserInfoList).forEach(function(n3) {
          t2._sampledUserInfoList.push(new qe2(t2._iid, n3, e._sampledUserInfoList[n3]));
        }), this._count = e._count, void 0 !== e._hasCurrentUserReacted && (this._hasCurrentUserReacted = e._hasCurrentUserReacted), this._updatedAt = e.updatedAt;
      else {
        if (!this._version[e.userId] || this._version[e.userId] <= e.updatedAt) {
          var n2 = this._sampledUserIds.indexOf(e.userId);
          switch (e.operation) {
            case ke.ADD:
              n2 < 0 && this._sampledUserIds.push(e.userId);
              break;
            case ke.DELETE:
              n2 >= 0 && this._sampledUserIds.splice(n2, 1);
          }
          this._count = this._sampledUserIds.length, this._version[e.userId] = e.updatedAt;
        }
        this._updatedAt = Math.max(this.updatedAt, e.updatedAt);
      }
  }, s3;
}(Jr);
var Be = function() {
  function n2(e) {
    this.secureUrl = null, this.type = null, this.width = 0, this.height = 0, this.alt = null, this.url = e.url, e.secure_url && (this.secureUrl = e.secure_url), e.type && (this.type = e.type), e.width && (this.width = e.width), e.height && (this.height = e.height), e.alt && (this.alt = e.alt);
  }
  return n2.payloadify = function(n3) {
    var r2, i2;
    return se(oe({ url: n3.url, secure_url: n3.secureUrl, type: n3.type, width: null !== (r2 = n3.width) && void 0 !== r2 ? r2 : 0, height: null !== (i2 = n3.height) && void 0 !== i2 ? i2 : 0, alt: n3.alt }));
  }, n2;
}();
var je = function() {
  function n2(e) {
    this.title = null, this.url = null, this.description = null, this.defaultImage = null, e["og:title"] && (this.title = e["og:title"]), e["og:url"] && (this.url = e["og:url"]), e["og:description"] && (this.description = e["og:description"]), e["og:image"] && (this.defaultImage = new Be(e["og:image"]));
  }
  return n2.payloadify = function(n3) {
    return se(oe({ "og:title": n3.title, "og:url": n3.url, "og:description": n3.description, "og:image": n3.defaultImage ? Be.payloadify(n3.defaultImage) : null }));
  }, n2;
}();
var Ke = function() {
  function n2(e) {
    var t2, n3;
    this.volume = 0, this.name = null !== (t2 = e.name) && void 0 !== t2 ? t2 : "default", this.volume = null !== (n3 = e.volume) && void 0 !== n3 ? n3 : 1;
  }
  return n2.prototype.serialize = function() {
    return { name: this.name, volume: this.volume };
  }, n2.payloadify = function(n3) {
    return se(oe({ name: n3.name, volume: n3.volume }));
  }, n2;
}();
!function(e) {
  e.GOOD = "good", e.BAD = "bad";
}(Le2 || (Le2 = {}));
var Qe = function() {
  function n2(e) {
    this.id = e.id, this.rating = e.rating, this.comment = e.comment;
  }
  return n2._getStatus = function(e) {
    return e ? "id" in e ? "SUBMITTED" : "NO_FEEDBACK" : "NOT_APPLICABLE";
  }, n2._isSubmitted = function(e) {
    return "SUBMITTED" === n2._getStatus(e);
  }, n2._getPayloadByStatus = function(e) {
    return "NO_FEEDBACK" === e ? {} : null;
  }, n2.payloadify = function(n3) {
    return se(oe({ id: n3.id, rating: n3.rating, comment: n3.comment }));
  }, n2;
}();
var Ge2 = function(n2) {
  function i2(e, t2) {
    var r2, i3 = this;
    return (i3 = n2.call(this, e, t2) || this).isBlockedByMe = false, i3.role = T(V, t2.role) ? t2.role : V.NONE, i3.isBlockedByMe = null !== (r2 = t2.is_blocked_by_me) && void 0 !== r2 && r2, i3;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { role: r2.role, is_blocked_by_me: r2.isBlockedByMe })));
  }, i2;
}(ls);
var Ve = function() {
  function n2(e) {
    this.key = e.key, this.value = C("string", e.value) ? c([], a(e.value), false) : [];
  }
  return n2.payloadify = function(n3) {
    var r2;
    return se(oe({ key: n3.key, value: null !== (r2 = n3.value) && void 0 !== r2 ? r2 : [] }));
  }, n2;
}();
var He = function(e) {
  switch (e) {
    case G.BASE:
      return "";
    case G.USER:
      return "MESG";
    case G.FILE:
      return "FILE";
    case G.ADMIN:
      return "ADMM";
  }
};
var We = function(n2) {
  function i2(e, t2) {
    var r2, i3, s3, a2, o2, u2, l, d, h, p = this;
    (p = n2.call(this, e) || this).channelType = H.BASE, p.messageType = G.BASE, p.mentionType = null, p.mentionedUsers = null, p.mentionedUserIds = null, p.metaArrays = [], p.extendedMessage = {}, p.createdAt = 0, p.updatedAt = 0, p.channelUrl = t2.channel_url, p.channelType = T(H, t2.channel_type) ? t2.channel_type : H.GROUP, t2.channel && (t2.channel.channel_url && (p.channelUrl = t2.channel.channel_url), t2.channel.channel_type && (p.channelType = t2.channel.channel_type)), p.data = null !== (r2 = t2.data) && void 0 !== r2 ? r2 : "", p.customType = null !== (i3 = t2.custom_type) && void 0 !== i3 ? i3 : "", p.mentionType = T(B, t2.mention_type) ? t2.mention_type : null, p.mentionedUsers = t2.mentioned_users ? t2.mentioned_users.map(function(e2) {
      return new ls(p._iid, e2);
    }) : null, p.mentionedUserIds = null !== (s3 = t2.mentioned_user_ids) && void 0 !== s3 ? s3 : null, p.mentionedUsers && !p.mentionedUserIds && (p.mentionedUserIds = p.mentionedUsers.map(function(e2) {
      return e2.userId;
    }));
    var m = null !== (a2 = t2.metaarray) && void 0 !== a2 ? a2 : {}, v2 = null !== (o2 = t2.metaarray_key_order) && void 0 !== o2 ? o2 : Object.keys(m).sort(function(e2, t3) {
      return e2.localeCompare(t3);
    });
    p.metaArrays = [];
    for (var y = 0; y < v2.length; y++) {
      var _ = v2[y];
      p.metaArrays.push(new Ve({ key: _, value: m[_] || [] }));
    }
    return t2.sorted_metaarray && (p.metaArrays = t2.sorted_metaarray.map(function(e2) {
      return new Ve(e2);
    })), p.extendedMessage = null !== (u2 = t2.extended_message) && void 0 !== u2 ? u2 : {}, p.extendedMessagePayload = t2.extended_message_payload, p.createdAt = null !== (d = null !== (l = t2.created_at) && void 0 !== l ? l : t2.ts) && void 0 !== d ? d : 0, p.updatedAt = null !== (h = t2.updated_at) && void 0 !== h ? h : 0, p;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    var i3, s3;
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { channel_url: r2.channelUrl, channel_type: r2.channelType, type: He(r2.messageType), data: r2.data, custom_type: r2.customType, mention_type: r2.mentionType, mentioned_user_ids: r2.mentionedUserIds, mentioned_users: null === (i3 = r2.mentionedUsers) || void 0 === i3 ? void 0 : i3.map(function(e) {
      return ls.payloadify(e);
    }), sorted_metaarray: null === (s3 = r2.metaArrays) || void 0 === s3 ? void 0 : s3.map(function(e) {
      return Ve.payloadify(e);
    }), extended_message: r2.extendedMessage, extended_message_payload: r2.extendedMessagePayload, created_at: r2.createdAt, updated_at: r2.updatedAt })));
  }, i2.prototype.isIdentical = function(e) {
    return true;
  }, i2.prototype.isEqual = function(e) {
    return w(this, e);
  }, i2.prototype.isUserMessage = function() {
    return this.messageType === G.USER;
  }, i2.prototype.isFileMessage = function() {
    return this.messageType === G.FILE && !Object.prototype.hasOwnProperty.call(this, "fileInfoList");
  }, i2.prototype.isMultipleFilesMessage = function() {
    return this.messageType === G.FILE && Object.prototype.hasOwnProperty.call(this, "fileInfoList");
  }, i2.prototype.isAdminMessage = function() {
    return this.messageType === G.ADMIN;
  }, i2.prototype.serialize = function() {
    return os(this);
  }, i2.prototype.getMetaArraysByKeys = function(e) {
    return this.metaArrays.filter(function(t2) {
      return e.includes(t2.key);
    });
  }, i2;
}(Jr);
var Ye = function(e) {
  function t2(t3, n2) {
    var r2, i2, s3 = this;
    return (s3 = e.call(this, t3) || this).channelUrl = null !== (r2 = n2.channel_url) && void 0 !== r2 ? r2 : "", s3.channelType = null !== (i2 = n2.channel_type) && void 0 !== i2 ? i2 : H.GROUP, s3.reader = new ls(s3._iid, n2.user), s3.readAt = n2.ts, s3;
  }
  return t(t2, e), t2;
}(Jr);
var Je = function(e) {
  function t2(t3) {
    var n2 = t3.channelUrl;
    return e.call(this, { code: "READ", ackRequired: true, payload: { channel_url: n2 } }) || this;
  }
  return t(t2, e), t2;
}(Ge);
var Xe = function(n2) {
  function s3(r2) {
    var s4 = n2.call(this) || this, a2 = r2.channelUrl, o2 = r2.channelType, u2 = r2.userId, c2 = r2.notificationIds;
    return s4.method = ae.PUT, s4.path = "".concat(Re(o2), "/").concat(encodeURIComponent(a2), "/messages/mark_as_read"), s4.params = se(oe({ user_id: u2, message_ids: c2 })), s4;
  }
  return t(s3, n2), s3;
}(Fe);
var Ze = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "READ", r2) || this;
    return i2.readStatus = new Ye(t3, r2), i2;
  }
  return t(t2, e), t2;
}(ze);
var $e = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.readAt = n2.ts, r2.unreadMessageCount = n2.unread_message_count, r2;
  }
  return t(t2, e), t2;
}(qe);
var et = function(e) {
  function t2(t3) {
    var n2 = t3.channelUrl, r2 = t3.messageId;
    return e.call(this, { code: "READ", ackRequired: true, payload: { channel_url: n2, parent_message_id: r2 } }) || this;
  }
  return t(t2, e), t2;
}(Ge);
var tt = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.pushEnabled, o2 = e.call(this) || this;
    return o2.method = ae.PUT, o2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/thread_push"), o2.params = { push_enabled: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var nt = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.rating, o2 = t3.comment, u2 = e.call(this) || this;
    return u2.method = ae.POST, u2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/feedbacks"), u2.params = { rating: a2, comment: o2 }, u2;
  }
  return t(t2, e), t2;
}(Fe);
var rt2 = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.feedback = new Qe(n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var it = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.feedbackId, o2 = t3.rating, u2 = t3.comment, c2 = e.call(this) || this;
    return c2.method = ae.PUT, c2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/feedbacks/").concat(a2), c2.params = { rating: o2, comment: u2 }, c2;
  }
  return t(t2, e), t2;
}(Fe);
var st2 = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.feedback = new Qe(n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var at = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.feedbackId, o2 = e.call(this) || this;
    return o2.method = ae.DELETE, o2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/feedbacks/").concat(a2), o2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.feedback = new Qe(n2), r2;
  }
  t(t2, e);
}(qe);
var ot2;
var ut2;
var ct = function(i2) {
  function s3(e, t2) {
    var n2, r2, s4, a2, o2, c2 = this;
    return (c2 = i2.call(this, e) || this).plainUrl = "", c2.fileName = null, c2.mimeType = null, c2.fileSize = 0, c2.thumbnails = [], c2._requireAuth = false, c2.plainUrl = null !== (n2 = t2.url) && void 0 !== n2 ? n2 : "", c2.fileName = null !== (r2 = t2.file_name) && void 0 !== r2 ? r2 : null, c2.mimeType = null !== (s4 = t2.file_type) && void 0 !== s4 ? s4 : null, c2.fileSize = null !== (a2 = t2.file_size) && void 0 !== a2 ? a2 : 0, c2._requireAuth = null !== (o2 = t2.require_auth) && void 0 !== o2 && o2, c2.thumbnails = t2.thumbnails ? t2.thumbnails.map(function(e2) {
      var t3;
      return new Pe(c2._iid, "string" == typeof e2 ? { url: e2, width: 0, height: 0 } : n(n({}, e2), { url: (null !== (t3 = e2.url) && void 0 !== t3 ? t3 : "").split("auth=")[0] }), c2._requireAuth);
    }) : [], c2;
  }
  return t(s3, i2), s3.payloadify = function(n2) {
    var r2;
    return se(oe({ url: n2.plainUrl, file_name: n2.fileName, file_type: n2.mimeType, file_size: n2.fileSize, thumbnails: null === (r2 = n2.thumbnails) || void 0 === r2 ? void 0 : r2.map(function(e) {
      var t2;
      return { url: (null !== (t2 = e.plainUrl) && void 0 !== t2 ? t2 : "").split("auth=")[0], width: e.width, height: e.height, real_width: e.realWidth, real_height: e.realHeight };
    }), require_auth: n2._requireAuth }));
  }, Object.defineProperty(s3.prototype, "url", { get: function() {
    var e = uo.of(this._iid).sessionManager;
    return this._requireAuth && e.ekey ? "".concat(this.plainUrl, "?auth=").concat(e.ekey) : this.plainUrl;
  }, enumerable: false, configurable: true }), s3;
}(Jr);
var lt = function(e) {
  var t2 = e.channelUrl, n2 = e.channelType, r2 = e.parentMessage;
  this.channelUrl = t2, this.channelType = n2, this.parentMessage = r2;
};
!function(e) {
  e.NUMBER = "number", e.ENUM = "enum", e.TEXT = "text", e.REGEX = "regex", e.DECIMAL_PLACE = "decimal_place";
}(ot2 || (ot2 = {})), function(e) {
  e.TEXT = "text", e.TEXTAREA = "textarea", e.NUMBER = "number", e.PHONE = "phone", e.EMAIL = "email", e.CHIP = "chip";
}(ut2 || (ut2 = {}));
var dt;
var ht;
var ft = function() {
  function n2(e, t2) {
    var n3 = t2.id, r2 = t2.name, i2 = t2.items, s3 = t2.version, a2 = t2.is_submitted;
    this.messageId = e, this.id = n3, this.name = r2, this.items = i2.map(function(e2) {
      return new pt(e2);
    }).sort(function(e2, t3) {
      return e2.sortOrder - t3.sortOrder;
    }), this.version = null != s3 ? s3 : 1, this._isSubmitted = a2;
  }
  return Object.defineProperty(n2.prototype, "isSubmitted", { get: function() {
    var e;
    return null !== (e = this._isSubmitted) && void 0 !== e ? e : this.items.some(function(e2) {
      return Array.isArray(e2.submittedValues);
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(n2.prototype, "isSubmittable", { get: function() {
    return this.items.every(function(e) {
      return e.required ? !!(Array.isArray(e.draftValues) && e.draftValues.length > 0) && e.isValid(e.draftValues) : !(Array.isArray(e.draftValues) && e.draftValues.length > 0) || e.isValid(e.draftValues);
    });
  }, enumerable: false, configurable: true }), n2.payloadify = function(n3) {
    return se(oe({ id: n3.id, name: n3.name, items: n3.items.map(function(e) {
      return pt.payloadify(e);
    }), version: n3.version, is_submitted: n3._isSubmitted }));
  }, n2.isMessageFormPayload = function(e) {
    return Boolean(null == e ? void 0 : e.message_form);
  }, n2;
}();
var pt = function() {
  function n2(t2) {
    var n3 = t2.id, r2 = t2.name, i2 = t2.required, s3 = t2.sort_order, a2 = t2.placeholder, o2 = t2.style, u2 = t2.item_type, c2 = t2.validators, l = t2.value, d = t2.values;
    this.id = n3, this.name = r2, this.required = i2, this.sortOrder = s3, this.placeholder = a2, 0 === Object.keys(o2).length ? this.style = { layout: u2 } : this.style = se({ layout: o2.layout, options: o2.options, defaultOptions: o2.default_options, resultCount: o2.result_count }), d ? this.submittedValues = d : l && (this.submittedValues = [l]), this._validators = c2;
  }
  return n2.prototype.isValid = function(e) {
    var t2 = this;
    return e.every(function(e2) {
      var n3 = function(e3, t3) {
        return t3.every(function(t4) {
          switch (t4.key) {
            case ot2.NUMBER:
              var n4 = Number(e3);
              return !(isNaN(n4) || t4.min && "number" != typeof t4.min || t4.max && "number" != typeof t4.max || "number" == typeof t4.min && n4 < t4.min || "number" == typeof t4.max && n4 > t4.max);
            case ot2.ENUM:
              return "string" == typeof e3 && (!(t4.enums && Array.isArray(t4.enums) && t4.enums.length > 0 && !t4.enums.includes(e3)) || t4.allow_other);
            case ot2.TEXT:
              return !("string" != typeof e3 || "number" == typeof t4.min_length && e3.length < t4.min_length || "number" == typeof t4.max_length && e3.length > t4.max_length);
            case ot2.REGEX:
              if ("string" != typeof e3)
                return false;
              if (t4.regex) {
                if ("string" != typeof t4.regex)
                  return false;
                if (!new RegExp(t4.regex).test(e3))
                  return false;
              }
              return true;
            case ot2.DECIMAL_PLACE:
              return 0 !== e3.length && (n4 = Number(e3), !(isNaN(n4) || (!t4.max_decimal_place || "number" == typeof t4.max_decimal_place) && t4.max_decimal_place && !function(e4, t5) {
                var n5 = e4.toString(), r2 = n5.indexOf(".");
                return -1 === r2 || n5.slice(r2 + 1).length <= t5;
              }(n4, t4.max_decimal_place)));
            default:
              return true;
          }
        });
      }(e2, t2._validators);
      return n3;
    });
  }, n2.payloadify = function(n3) {
    return se(oe({ id: n3.id, name: n3.name, required: n3.required, sort_order: n3.sortOrder, placeholder: n3.placeholder, style: se({ layout: n3.style.layout, options: n3.style.options, default_options: n3.style.defaultOptions, result_count: n3.style.resultCount }), item_type: n3.style.layout, validators: n3._validators, values: n3.submittedValues }));
  }, n2;
}();
var mt = function(t2) {
  function n2(n3) {
    var r2 = t2.call(this) || this;
    return r2.method = ae.POST, r2.path = "".concat(Oe, "/").concat(n3.formId, "/submit"), r2.params = se({ message_id: n3.messageId, items: n3.items }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
!function(e) {
  e.PENDING = "pending", e.SENT = "sent", e.FAILED = "failed", e.CANCELED = "canceled";
}(dt || (dt = {})), function(e) {
  e.PENDING = "pending", e.IN_QUEUE = "in_queue", e.SENT = "sent", e.FAILED = "failed", e.CANCELED = "canceled", e.REMOVED = "removed";
}(ht || (ht = {}));
var vt;
var yt = function(i2) {
  function s3(e, t2) {
    var n2, r2, s4, a2, o2, u2, c2, l, d, h = this;
    return (h = i2.call(this, e, t2) || this).parentMessage = null, h.silent = false, h.isOperatorMessage = false, h.threadInfo = null, h.reactions = [], h.appleCriticalAlertOptions = null, h.scheduledInfo = null, h.suggestedReplies = null, h.myFeedback = null, h.myFeedbackStatus = "NOT_APPLICABLE", h.messageForm = null, h._isContinuousMessages = false, h._scheduledStatus = null, h._poll = null, h.messageId = null !== (r2 = null !== (n2 = t2.msg_id) && void 0 !== n2 ? n2 : t2.message_id) && void 0 !== r2 ? r2 : 0, h.parentMessageId = null !== (s4 = "string" == typeof t2.parent_message_id ? parseInt(t2.parent_message_id) : t2.parent_message_id) && void 0 !== s4 ? s4 : 0, h.threadInfo = t2.thread_info ? new De(h._iid, t2.thread_info) : null, t2.reactions_summary ? h.reactions = t2.reactions_summary.map(function(t3) {
      return new ze2(e, t3);
    }) : t2.reactions ? h.reactions = t2.reactions.map(function(t3) {
      return new ze2(e, t3);
    }) : h.reactions = [], h.ogMetaData = t2.og_tag ? new je(t2.og_tag) : null, h.silent = null !== (a2 = t2.silent) && void 0 !== a2 && a2, h.isOperatorMessage = null !== (o2 = t2.is_op_msg) && void 0 !== o2 && o2, h.appleCriticalAlertOptions = t2.apple_critical_alert_options ? new Ke(t2.apple_critical_alert_options) : null, "number" == typeof t2.scheduled_message_id && "number" == typeof t2.scheduled_at && t2.scheduled_status && (h.scheduledInfo = { scheduledMessageId: t2.scheduled_message_id, scheduledAt: t2.scheduled_at }, h._scheduledStatus = t2.scheduled_status), h._isContinuousMessages = null !== (u2 = t2.is_continuous_messages) && void 0 !== u2 && u2, h.myFeedback = Qe._isSubmitted(t2.feedback) ? new Qe(t2.feedback) : null, h.myFeedbackStatus = Qe._getStatus(t2.feedback), h.suggestedReplies = null !== (l = null === (c2 = t2.extended_message_payload) || void 0 === c2 ? void 0 : c2.suggested_replies) && void 0 !== l ? l : null, h.messageForm = ft.isMessageFormPayload(t2.extended_message_payload) ? new ft(h.messageId, t2.extended_message_payload.message_form) : null, h.message = null !== (d = t2.message) && void 0 !== d ? d : "", h._poll = t2.poll ? new Io(h._iid, t2.poll) : null, h;
  }
  return t(s3, i2), s3.payloadify = function(n2) {
    var r2, s4;
    return se(oe(n(n({}, i2.payloadify.call(this, n2)), { message_id: n2.messageId, parent_message_id: n2.parentMessageId, thread_info: n2.threadInfo ? De.payloadify(n2.threadInfo) : null, reactions_summary: n2.reactions.map(function(e) {
      return ze2.payloadify(e);
    }), og_tag: n2.ogMetaData ? je.payloadify(n2.ogMetaData) : null, silent: n2.silent, is_op_msg: n2.isOperatorMessage, apple_critical_alert_options: n2.appleCriticalAlertOptions ? Ke.payloadify(n2.appleCriticalAlertOptions) : null, scheduled_message_id: null === (r2 = n2.scheduledInfo) || void 0 === r2 ? void 0 : r2.scheduledMessageId, scheduled_at: null === (s4 = n2.scheduledInfo) || void 0 === s4 ? void 0 : s4.scheduledAt, scheduled_status: n2._scheduledStatus, feedback: n2.myFeedback ? Qe.payloadify(n2.myFeedback) : Qe._getPayloadByStatus(n2.myFeedbackStatus), message: n2.message, poll: n2._poll ? Io.payloadify(n2._poll) : null })));
  }, s3._getParentMessageInfoPayload = function(n2) {
    return se(oe({ type: He(n2.messageType), ts: n2.createdAt, user: n2.sender ? Ge2.payloadify(n2.sender) : null, message: n2.message, file: { url: n2.plainUrl, name: n2.name, type: n2.type, require_auth: n2.requireAuth }, files: Array.isArray(n2.fileInfoList) ? n2.fileInfoList.map(function(e) {
      return ct.payloadify(e);
    }) : null }));
  }, s3.prototype.isIdentical = function(e) {
    return this.messageId === e.messageId;
  }, s3.prototype.applyThreadInfoUpdateEvent = function(e) {
    return this.messageId === e.targetMessageId && (e.threadInfo._isUpdateRequired && this.threadInfo && e.threadInfo._updateFrom(this.threadInfo), this.threadInfo = e.threadInfo, true);
  }, s3.prototype._findReactionIndex = function(e) {
    for (var t2 = 0; t2 < this.reactions.length; t2++)
      if (this.reactions[t2].key === e)
        return t2;
    return -1;
  }, s3.prototype.applyReactionEvent = function(e) {
    var t2 = uo.of(this._iid).sdkState;
    if (this.messageId === e.messageId)
      switch (e.operation) {
        case ke.ADD:
          e.userId === t2.userId && (e._hasCurrentUserReacted = true), -1 !== (r2 = this._findReactionIndex(e.key)) ? this.reactions[r2].applyEvent(e) : e._sampledUserIds ? this.reactions.push(new ze2(this._iid, { key: e.key, sampled_user_ids: e._sampledUserIds, sampled_user_info: e._sampledUserInfoList, count: e._count, is_self_included: e._hasCurrentUserReacted, last_ts: e.updatedAt })) : this.reactions.push(new ze2(this._iid, { key: e.key, user_ids: [e.userId], updated_at: e.updatedAt }));
          break;
        case ke.DELETE:
          var r2;
          -1 !== (r2 = this._findReactionIndex(e.key)) && (e._sampledUserIds ? 0 === e._count ? this.reactions.splice(r2, 1) : (e.userId === t2.userId && (e._hasCurrentUserReacted = false), this.reactions[r2].applyEvent(e)) : (this.reactions[r2].applyEvent(e), this.reactions[r2].isEmpty && this.reactions.splice(r2, 1)));
      }
  }, s3.prototype.applyParentMessage = function(e) {
    if (!this.parentMessage)
      return this.parentMessage = e, true;
    if (this.parentMessageId === e.messageId) {
      var t2 = this.parentMessage.updatedAt;
      if (e.updatedAt >= t2)
        return this.parentMessage = e, true;
    }
    return false;
  }, s3.prototype.applyPoll = function(e) {
    return !(this._poll && this._poll.id === e.id && this._poll.updatedAt > e.updatedAt) && (this._poll = e, true);
  }, Object.defineProperty(s3.prototype, "poll", { get: function() {
    return this._poll;
  }, enumerable: false, configurable: true }), s3.prototype._triggerThreadInfoUpdatedEvent = function() {
    return r(this, void 0, void 0, function() {
      var e;
      return s(this, function(t2) {
        return (e = uo.of(this._iid).dispatcher).dispatch(new lt({ channelType: H.GROUP, channelUrl: this.channelUrl, parentMessage: this })), e.dispatch(new po({ messages: [this], source: no.EVENT_MESSAGE_THREADINFO_UPDATED })), [2];
      });
    });
  }, s3.prototype.markThreadAsRead = function() {
    return r(this, void 0, void 0, function() {
      var e, t2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new et({ channelUrl: this.channelUrl, messageId: this.messageId }), [4, e.send(t2)];
          case 1:
            return r2.sent(), this.threadInfo && 0 !== this.threadInfo.unreadReplyCount ? (this.threadInfo.unreadReplyCount = 0, [4, this._triggerThreadInfoUpdatedEvent()]) : [3, 3];
          case 2:
            r2.sent(), r2.label = 3;
          case 3:
            return [2];
        }
      });
    });
  }, s3.prototype.setPushNotificationEnabled = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = new tt({ channelUrl: this.channelUrl, channelType: this.channelType, messageId: this.messageId, pushEnabled: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), this.threadInfo && this.threadInfo.isPushNotificationEnabled !== e && (this.threadInfo.isPushNotificationEnabled = e), [2];
        }
      });
    });
  }, s3.prototype.submitMessageForm = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            if (t2 = uo.of(this._iid).requestQueue, r2 = null, i3 = null, s4 = this.messageForm, !e && s4) {
              if (!s4.isSubmittable)
                throw new b({ code: u.INVALID_PARAMETER, message: "The form is not submittable. Please check all form items are valid before submitting." });
              if (s4.isSubmitted)
                throw new b({ code: u.INVALID_PARAMETER, message: "The form has already been submitted." });
              r2 = s4.id, i3 = s4.items.reduce(function(e2, t3) {
                return e2.push({ form_item_id: t3.id, values: Array.isArray(t3.draftValues) ? t3.draftValues : [] }), e2;
              }, []);
            } else
              e && (r2 = e.formId, i3 = Object.entries(e.answers).reduce(function(e2, t3) {
                var n2 = a(t3, 2), r3 = n2[0], i4 = n2[1], s5 = Number(r3);
                if (Number.isNaN(s5))
                  throw new b({ code: u.INVALID_PARAMETER, message: "Keys in answers must be numeric string." });
                return e2.push({ form_item_id: s5, value: i4 }), e2;
              }, []));
            if (!r2 || !i3)
              throw new b({ code: u.INVALID_PARAMETER, message: "Missing one or more required inputs: formId, answers." });
            return a2 = new mt({ messageId: this.messageId, formId: r2, items: i3 }), [4, t2.send(a2)];
          case 1:
            return o2.sent(), [2];
        }
      });
    });
  }, s3.prototype.submitFeedback = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return t2 = uo.of(this._iid), r2 = t2.requestQueue, i3 = t2.dispatcher, s4 = new nt({ channelUrl: this.channelUrl, channelType: this.channelType, messageId: this.messageId, rating: e.rating, comment: e.comment }), [4, r2.send(s4)];
          case 1:
            return a2 = u2.sent(), o2 = a2.as(rt2), this.myFeedback = o2.feedback, this.myFeedbackStatus = "SUBMITTED", i3.dispatch(new po({ messages: [this], source: no.EVENT_MESSAGE_FEEDBACK_ADDED })), [2];
        }
      });
    });
  }, s3.prototype.updateFeedback = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return t2 = uo.of(this._iid), r2 = t2.requestQueue, i3 = t2.dispatcher, s4 = new it({ channelUrl: this.channelUrl, channelType: this.channelType, messageId: this.messageId, feedbackId: e.id, rating: e.rating, comment: e.comment }), [4, r2.send(s4)];
          case 1:
            return a2 = u2.sent(), o2 = a2.as(st2), this.myFeedback = o2.feedback, this.myFeedbackStatus = "SUBMITTED", i3.dispatch(new po({ messages: [this], source: no.EVENT_MESSAGE_FEEDBACK_UPDATED })), [2];
        }
      });
    });
  }, s3.prototype.deleteFeedback = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return t2 = uo.of(this._iid), r2 = t2.requestQueue, i3 = t2.dispatcher, s4 = new at({ channelUrl: this.channelUrl, channelType: this.channelType, messageId: this.messageId, feedbackId: e }), [4, r2.send(s4)];
          case 1:
            return a2.sent(), this.myFeedback = null, this.myFeedbackStatus = "NO_FEEDBACK", i3.dispatch(new po({ messages: [this], source: no.EVENT_MESSAGE_FEEDBACK_DELETED })), [2];
        }
      });
    });
  }, s3;
}(We);
var _t = function(n2) {
  function i2(e, t2) {
    var r2, i3, s3, a2, o2 = this;
    if ((o2 = n2.call(this, e, t2) || this).reqId = "", o2.replyToChannel = false, o2.errorCode = 0, o2.sender = t2.user ? new Ge2(o2._iid, t2.user) : t2.sender_id, o2.reqId = null !== (i3 = null !== (r2 = t2.req_id) && void 0 !== r2 ? r2 : t2.request_id) && void 0 !== i3 ? i3 : "", o2.replyToChannel = null !== (s3 = t2.is_reply_to_channel) && void 0 !== s3 && s3, t2.request_state && T(Z, t2.request_state) && (o2.sendingStatus = t2.request_state), !o2.sendingStatus)
      if (o2.messageId > 0)
        o2.sendingStatus = Z.SUCCEEDED;
      else if (o2.scheduledInfo)
        switch (t2.scheduled_status && (o2._scheduledStatus = t2.scheduled_status), t2.scheduled_status) {
          case ht.SENT:
          case ht.IN_QUEUE:
            o2.sendingStatus = Z.SUCCEEDED;
            break;
          case ht.PENDING:
            o2.sendingStatus = Z.SCHEDULED;
            break;
          case ht.FAILED:
          case ht.REMOVED:
            o2.sendingStatus = Z.FAILED;
            break;
          case ht.CANCELED:
            o2.sendingStatus = Z.CANCELED;
        }
      else
        o2.sendingStatus = Z.PENDING;
    return o2.errorCode = null !== (a2 = t2.error_code) && void 0 !== a2 ? a2 : 0, o2._messageToken = t2.mesg_token, o2;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { user: Ge2.payloadify(r2.sender), req_id: r2.reqId, is_reply_to_channel: r2.replyToChannel, request_state: r2.sendingStatus, error_code: r2.errorCode, mesg_token: r2._messageToken })));
  }, Object.defineProperty(i2.prototype, "isResendable", { get: function() {
    return (this.sendingStatus === Z.FAILED || this.sendingStatus === Z.CANCELED) && I(this.errorCode);
  }, enumerable: false, configurable: true }), i2.prototype.isIdentical = function(e) {
    return this.messageId > 0 && e.messageId > 0 ? this.messageId === e.messageId : this.reqId === e.reqId;
  }, i2;
}(yt);
var gt = { prevResultSize: 0, nextResultSize: 0, isInclusive: false, reverse: false, messageTypeFilter: j.ALL, customTypesFilter: void 0, senderUserIdsFilter: void 0, includeReactions: false, includeMetaArray: false, includeParentMessageInfo: false };
var bt = function(e) {
  return S("number", e.prevResultSize) && S("number", e.nextResultSize) && S("boolean", e.isInclusive) && S("boolean", e.reverse) && S("string", e.messageTypeFilter) && T(j, e.messageTypeFilter) && C("string", e.customTypesFilter, true) && C("string", e.senderUserIdsFilter, true) && S("boolean", e.includeMetaArray) && S("boolean", e.includeReactions) && S("boolean", e.includeParentMessageInfo);
};
var It = function(n2) {
  function i2(r2, i3) {
    var s3, a2, o2, c2 = this;
    if ((c2 = n2.call(this, r2, i3) || this).translations = {}, c2.messageType = G.ADMIN, c2.translations = null !== (s3 = i3.translations) && void 0 !== s3 ? s3 : {}, i3.parent_message_info) {
      var l = i3.parent_message_info;
      c2.parentMessage = At(r2, se(oe(n(n({}, l), { message_id: c2.parentMessageId, channel_url: c2.channelUrl, channel_type: c2.channelType, file: l.file, url: null === (a2 = l.file) || void 0 === a2 ? void 0 : a2.url, require_auth: null === (o2 = l.file) || void 0 === o2 ? void 0 : o2.require_auth }))));
    }
    return c2;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { translations: r2.translations, parent_message_info: r2.parentMessage ? n2._getParentMessageInfoPayload.call(this, r2.parentMessage) : null })));
  }, i2.prototype.getThreadedMessagesByTimestamp = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n3 = n(n({}, gt), t2), cs(this.messageId > 0 && S("number", e) && bt(n3)).throw(b.invalidParameters), [4, la.of(this._iid).getThreadedMessagesByTimestamp(this, e, n3)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, i2;
}(yt);
var Et = function() {
  function n2(e) {
    var t2, n3;
    this.detail = {}, this.type = null !== (t2 = e.type) && void 0 !== t2 ? t2 : "", this.vendor = null !== (n3 = e.vendor) && void 0 !== n3 ? n3 : "", e.detail && S("object", e.detail) && !Array.isArray(e.detail) && (this.detail = e.detail);
  }
  return n2.payloadify = function(n3) {
    return se(oe({ type: n3.type, vendor: n3.vendor, detail: n3.detail }));
  }, n2;
}();
var Tt = function() {
  function t2(e) {
    this.status = e.status, e.original_message_info && (this.originalMessageInfo = { createdAt: e.original_message_info.ts, messageId: e.original_message_info.id });
  }
  return t2.payloadify = function(t3) {
    return se({ status: t3.status, original_message_info: t3.originalMessageInfo ? { id: t3.originalMessageInfo.messageId, ts: t3.originalMessageInfo.createdAt } : void 0 });
  }, t2;
}();
var wt = function(n2) {
  function i2(r2, i3) {
    var s3, a2, o2, c2, l, d, h, f = this;
    if ((f = n2.call(this, r2, i3) || this).messageParams = null, f.mentionedMessageTemplate = void 0, f.translations = {}, f.translationTargetLanguages = [], f.messageSurvivalSeconds = -1, f.plugins = [], f.messageType = G.USER, f.translations = null !== (o2 = i3.translations) && void 0 !== o2 ? o2 : {}, f.translationTargetLanguages = null !== (c2 = i3.target_langs) && void 0 !== c2 ? c2 : [], 0 === Object.keys(f.translations).length && f.translationTargetLanguages.length > 0)
      try {
        for (var p = o(f.translationTargetLanguages), m = p.next(); !m.done; m = p.next()) {
          var y = m.value;
          f.translations[y] = "";
        }
      } catch (e) {
        s3 = { error: e };
      } finally {
        try {
          m && !m.done && (a2 = p.return) && a2.call(p);
        } finally {
          if (s3)
            throw s3.error;
        }
      }
    if (f.mentionedMessageTemplate = i3.mentioned_message_template, f.messageSurvivalSeconds = null !== (l = i3.message_survival_seconds) && void 0 !== l ? l : -1, f.plugins = i3.plugins ? i3.plugins.map(function(e) {
      return new Et(e);
    }) : [], i3.parent_message_info) {
      var _ = i3.parent_message_info;
      f.parentMessage = At(r2, se(oe(n(n({}, _), { created_at: _.ts, message_id: f.parentMessageId, channel_url: f.channelUrl, channel_type: f.channelType, file: _.file, url: null === (d = _.file) || void 0 === d ? void 0 : d.url, require_auth: null === (h = _.file) || void 0 === h ? void 0 : h.require_auth }))));
    }
    return i3.review_info && (f.messageReviewInfo = new Tt(i3.review_info)), f;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { translations: r2.translations, message_survival_seconds: r2.messageSurvivalSeconds, mentioned_message_template: r2.mentionedMessageTemplate, plugins: r2.plugins.map(function(e) {
      return Et.payloadify(e);
    }), parent_message_info: r2.parentMessage ? n2._getParentMessageInfoPayload.call(this, r2.parentMessage) : null, review_info: r2.messageReviewInfo ? Tt.payloadify(r2.messageReviewInfo) : void 0 })));
  }, i2.prototype.getThreadedMessagesByTimestamp = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n3 = n(n({}, gt), t2), cs(this.messageId > 0 && S("number", e) && bt(n3)).throw(b.invalidParameters), [4, la.of(this._iid).getThreadedMessagesByTimestamp(this, e, n3)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, i2;
}(_t);
var Mt = function(n2) {
  function i2(r2, i3) {
    var s3, a2, o2, c2, l, d, h, f, p = this;
    if ((p = n2.call(this, r2, i3) || this).messageParams = null, p.fileInfoList = [], p.messageSurvivalSeconds = -1, p.messageType = G.FILE, p.data = null !== (o2 = null !== (a2 = null === (s3 = i3.file) || void 0 === s3 ? void 0 : s3.data) && void 0 !== a2 ? a2 : i3.custom) && void 0 !== o2 ? o2 : "", p.fileInfoList = null !== (l = null === (c2 = i3.files) || void 0 === c2 ? void 0 : c2.map(function(e) {
      return new ct(r2, e);
    })) && void 0 !== l ? l : [], p.messageSurvivalSeconds = null !== (d = i3.message_survival_seconds) && void 0 !== d ? d : -1, i3.parent_message_info) {
      var m = i3.parent_message_info;
      p.parentMessage = At(r2, se(oe(n(n({}, m), { created_at: m.ts, message_id: p.parentMessageId, channel_url: p.channelUrl, channel_type: p.channelType, file: m.file, url: null === (h = m.file) || void 0 === h ? void 0 : h.url, require_auth: null === (f = m.file) || void 0 === f ? void 0 : f.require_auth }))));
    }
    return p;
  }
  return t(i2, n2), i2.prototype.getThreadedMessagesByTimestamp = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n3 = n(n({}, gt), t2), cs(this.messageId > 0 && S("number", e) && bt(n3)).throw(b.invalidParameters), [4, la.of(this._iid).getThreadedMessagesByTimestamp(this, e, n3)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, i2.payloadify = function(r2) {
    var i3, s3, a2, o2, c2, l;
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { file: { name: null !== (s3 = null === (i3 = r2.fileInfoList[0]) || void 0 === i3 ? void 0 : i3.fileName) && void 0 !== s3 ? s3 : "", size: null !== (o2 = null === (a2 = r2.fileInfoList[0]) || void 0 === a2 ? void 0 : a2.fileSize) && void 0 !== o2 ? o2 : 0, type: null !== (l = null === (c2 = r2.fileInfoList[0]) || void 0 === c2 ? void 0 : c2.mimeType) && void 0 !== l ? l : "", data: r2.data }, files: Array.isArray(r2.fileInfoList) ? r2.fileInfoList.map(function(e) {
      return ct.payloadify(e);
    }) : null, message_survival_seconds: r2.messageSurvivalSeconds, parent_message_info: r2.parentMessage ? n2._getParentMessageInfoPayload.call(this, r2.parentMessage) : null })));
  }, i2._isMultipleFilesMessagePayload = function(e) {
    var t2 = e.files;
    return Array.isArray(t2) && t2.length >= 2;
  }, i2._isMultipleFilesMessageSerializedData = function(e) {
    var t2 = e.fileInfoList;
    return Array.isArray(t2);
  }, i2;
}(_t);
!function(e) {
  e.SENT = "SENT", e.READ = "READ";
}(vt || (vt = {}));
var St = function(n2) {
  function i2(e, t2) {
    var r2, i3, s3 = this;
    if ((s3 = n2.call(this, e, t2) || this).notificationData = null, s3.notificationId = t2.notification_message_id, s3.messageType = G.ADMIN, s3.messageStatus = null !== (r2 = t2.message_status) && void 0 !== r2 ? r2 : vt.SENT, s3.priority = null !== (i3 = t2.priority) && void 0 !== i3 ? i3 : X.NORMAL, s3.notificationEventDeadline = t2.notification_event_deadline, 0 === s3.extendedMessage.sub_type)
      try {
        var a2 = JSON.parse(s3.extendedMessage.sub_data), o2 = a2.label, u2 = a2.tags, c2 = void 0 === u2 ? [] : u2, l = a2.template_key, d = a2.template_variables;
        s3.notificationData = { label: o2, tags: c2, templateKey: l, templateVariables: d };
      } catch (e2) {
      }
    return s3;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), { notification_message_id: r2.notificationId, message_status: r2.messageStatus, priority: r2.priority, notification_event_deadline: r2.notificationEventDeadline })));
  }, i2.prototype.isIdentical = function(e) {
    return this.notificationId === e.notificationId;
  }, i2;
}(We);
var Ut = function(e) {
  if (e.notificationId)
    return St.payloadify(e);
  switch (e.messageType) {
    case G.USER:
      return wt.payloadify(e);
    case G.FILE:
      return e.fileInfoList ? Mt.payloadify(e) : Nt.payloadify(e);
    case G.ADMIN:
      return It.payloadify(e);
    default:
      throw b.unknown;
  }
};
var At = function(e, t2) {
  if (t2.notification_message_id)
    return new St(e, t2);
  switch (t2.type) {
    case "MESG":
      return new wt(e, t2);
    case "FILE":
      return Mt._isMultipleFilesMessagePayload(t2) ? new Mt(e, t2) : new Nt(e, t2);
    case "ADMM":
    case "BRDM":
      return new It(e, t2);
    default:
      return null;
  }
};
var Nt = function(i2) {
  function s3(n2, r2) {
    var s4, a2, o2, c2, l, d, h, f, p, m, v2, y, _, b2, I2 = this;
    (I2 = i2.call(this, n2, r2) || this).messageParams = null, I2.plainUrl = "", I2.requireAuth = false, I2.thumbnails = [], I2.messageSurvivalSeconds = -1, I2.messageType = G.FILE;
    var E = r2.file;
    if (I2.plainUrl = (null !== (a2 = null !== (s4 = null == E ? void 0 : E.url) && void 0 !== s4 ? s4 : r2.url) && void 0 !== a2 ? a2 : "").split("?auth=")[0], I2.name = null !== (c2 = null !== (o2 = null == E ? void 0 : E.name) && void 0 !== o2 ? o2 : r2.name) && void 0 !== c2 ? c2 : "File", I2.size = null !== (d = null !== (l = null == E ? void 0 : E.size) && void 0 !== l ? l : r2.size) && void 0 !== d ? d : 0, I2.data = null !== (f = null !== (h = null == E ? void 0 : E.data) && void 0 !== h ? h : r2.custom) && void 0 !== f ? f : "", I2.type = E ? null !== (p = E.type) && void 0 !== p ? p : "" : null !== (m = r2.type) && void 0 !== m ? m : "", I2.requireAuth = null !== (v2 = r2.require_auth) && void 0 !== v2 && v2, I2.thumbnails = r2.thumbnails ? r2.thumbnails.map(function(e) {
      var t2;
      return new Pe(I2._iid, "string" == typeof e ? { url: e, width: 0, height: 0 } : n(n({}, e), { url: (null !== (t2 = e.url) && void 0 !== t2 ? t2 : "").split("auth=")[0] }), I2.requireAuth);
    }) : [], I2.messageSurvivalSeconds = null !== (y = r2.message_survival_seconds) && void 0 !== y ? y : -1, r2.parent_message_info) {
      var T2 = r2.parent_message_info;
      I2.parentMessage = At(n2, se(oe(n(n({}, T2), { created_at: T2.ts, message_id: I2.parentMessageId, channel_url: I2.channelUrl, channel_type: I2.channelType, file: T2.file, url: null === (_ = T2.file) || void 0 === _ ? void 0 : _.url, require_auth: null === (b2 = T2.file) || void 0 === b2 ? void 0 : b2.require_auth }))));
    }
    return I2;
  }
  return t(s3, i2), s3.payloadify = function(n2) {
    var r2;
    return se(oe(n(n({}, i2.payloadify.call(this, n2)), { url: n2.plainUrl, require_auth: n2.requireAuth, file: { name: n2.name, size: n2.size, type: n2.type, data: n2.data }, thumbnails: null === (r2 = n2.thumbnails) || void 0 === r2 ? void 0 : r2.map(function(e) {
      return { url: e.plainUrl, width: e.width, height: e.height, real_width: e.realWidth, real_height: e.realHeight };
    }), message_survival_seconds: n2.messageSurvivalSeconds, parent_message_info: n2.parentMessage ? i2._getParentMessageInfoPayload.call(this, n2.parentMessage) : null })));
  }, Object.defineProperty(s3.prototype, "url", { get: function() {
    var e = uo.of(this._iid).sessionManager;
    return this.requireAuth && e.ekey ? "".concat(this.plainUrl, "?auth=").concat(e.ekey) : this.plainUrl;
  }, enumerable: false, configurable: true }), s3.prototype.getThreadedMessagesByTimestamp = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n2 = n(n({}, gt), t2), cs(this.messageId > 0 && S("number", e) && bt(n2)).throw(b.invalidParameters), [4, la.of(this._iid).getThreadedMessagesByTimestamp(this, e, n2)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, s3;
}(_t);
var Ct = function(e) {
  function t2(t3, n2) {
    var r2 = n2.file, i2 = n2.fileUrl, s3 = n2.fileName, a2 = n2.fileSize, o2 = n2.mimeType, u2 = n2.thumbnailSizes, c2 = n2._uploadedMetaData, l = n2._thumbnails, d = e.call(this, t3) || this;
    return d._plainUrl = i2, d.file = r2, d.fileName = s3, d.fileSize = a2, d.mimeType = o2, d.thumbnailSizes = u2, d._uploadedMetaData = c2, d._thumbnails = l, d;
  }
  return t(t2, e), t2.getPlainUrl = function(e2) {
    return e2 instanceof t2 ? e2._plainUrl : e2.fileUrl;
  }, Object.defineProperty(t2.prototype, "fileUrl", { get: function() {
    var e2, t3 = uo.of(this._iid).sessionManager;
    return this._plainUrl && (null === (e2 = this._uploadedMetaData) || void 0 === e2 ? void 0 : e2.requireAuth) && t3.ekey ? "".concat(this._plainUrl, "?auth=").concat(t3.ekey) : this._plainUrl;
  }, set: function(e2) {
    this._plainUrl = e2;
  }, enumerable: false, configurable: true }), t2.prototype.toJSON = function() {
    return { file: this.file, fileUrl: this._plainUrl, fileName: this.fileName, fileSize: this.fileSize, mimeType: this.mimeType, thumbnailSizes: this.thumbnailSizes, _thumbnails: this._thumbnails, _uploadedMetaData: this._uploadedMetaData };
  }, t2;
}(Jr);
var Ot = function(n2) {
  function i2(r2) {
    var i3, s3, a2, o2, u2 = [];
    return r2.mentionType === B.USERS && (r2.mentionedUserIds ? u2 = r2.mentionedUserIds : r2.mentionedUsers && (u2 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    }))), n2.call(this, { code: "FILE", ackRequired: true, payload: se(oe({ channel_url: r2.channelUrl, files: r2.files ? xt(r2.files) : null, url: r2.url, name: null !== (i3 = r2.fileName) && void 0 !== i3 ? i3 : "", type: null !== (s3 = r2.mimeType) && void 0 !== s3 ? s3 : "", size: null !== (a2 = r2.fileSize) && void 0 !== a2 ? a2 : 0, custom: r2.data, custom_type: r2.customType, thumbnails: null === (o2 = r2._thumbnails) || void 0 === o2 ? void 0 : o2.map(function(e) {
      return Pe.payloadify(e);
    }), require_auth: r2.requireAuth, metaarray: r2.metaArrays, mention_type: r2.mentionType, mentioned_user_ids: u2, push_option: r2.pushNotificationDeliveryOption && r2.pushNotificationDeliveryOption !== W.DEFAULT ? r2.pushNotificationDeliveryOption : void 0, apple_critical_alert_options: r2.appleCriticalAlertOptions ? Ke.payloadify(r2.appleCriticalAlertOptions) : null, silent: r2.silent, reply_to_channel: r2.isReplyToChannel, parent_message_id: r2.parentMessageId ? r2.parentMessageId : null, req_id: r2.reqId, poll_id: r2.pollId, pin_message: r2.isPinnedMessage, message: r2.message })) }) || this;
  }
  return t(i2, n2), i2;
}(Ge);
var kt = function(n2) {
  function s3(r2) {
    var s4, a2, o2 = this;
    o2 = n2.call(this) || this;
    var u2 = [];
    return r2.mentionType === B.USERS && (r2.mentionedUserIds ? u2 = r2.mentionedUserIds : r2.mentionedUsers && (u2 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    }))), o2.method = ae.POST, o2.path = "".concat(Re(r2.channelType), "/").concat(encodeURIComponent(r2.channelUrl), "/messages"), o2.params = se(oe({ message_type: G.FILE, user_id: r2.userId, files: r2.files ? xt(r2.files) : null, url: r2.fileUrl, mention_type: r2.mentionType, mentioned_user_ids: u2, file_name: r2.fileName, file_size: r2.fileSize, file_type: r2.mimeType, data: r2.data, custom_type: r2.customType, thumbnails: null === (s4 = r2._thumbnails) || void 0 === s4 ? void 0 : s4.map(function(e) {
      return Pe.payloadify(e);
    }), require_auth: r2.requireAuth, sorted_metaarray: null === (a2 = r2.metaArrays) || void 0 === a2 ? void 0 : a2.map(function(e) {
      return Ve.payloadify(e);
    }), push_option: r2.pushNotificationDeliveryOption, parent_message_id: r2.parentMessageId ? r2.parentMessageId : null, apple_critical_alert_options: r2.appleCriticalAlertOptions ? Ke.payloadify(r2.appleCriticalAlertOptions) : null, reply_to_channel: r2.isReplyToChannel, req_id: r2.reqId, poll_id: r2.pollId, pin_message: r2.isPinnedMessage })), o2;
  }
  return t(s3, n2), s3;
}(Fe);
var Pt = function(e) {
  function t2(t3, r2, i2) {
    var s3, a2, o2, u2, c2 = this;
    (c2 = e.call(this, t3, "FILE", i2) || this).message = i2.files && i2.files.length >= 2 ? new Mt(t3, i2) : new Nt(t3, i2);
    var l = uo.of(t3).sdkState;
    return c2.isMentioned = xe(c2.message.mentionType, null !== (o2 = null !== (s3 = c2.message.mentionedUserIds) && void 0 !== s3 ? s3 : null === (a2 = c2.message.mentionedUsers) || void 0 === a2 ? void 0 : a2.map(function(e2) {
      return e2.userId;
    })) && void 0 !== o2 ? o2 : [], l.userId), c2.forceUpdateLastMessage = null !== (u2 = i2.force_update_last_message) && void 0 !== u2 && u2, c2;
  }
  return t(t2, e), t2;
}(ze);
var Rt = function(e) {
  function t2(t3, r2) {
    var i2, s3, a2, o2, u2 = this;
    (u2 = e.call(this, t3, r2) || this).message = r2.files && r2.files.length >= 2 ? new Mt(t3, r2) : new Nt(t3, r2);
    var c2 = uo.of(t3).sdkState;
    return u2.isMentioned = xe(u2.message.mentionType, null !== (a2 = null !== (i2 = u2.message.mentionedUserIds) && void 0 !== i2 ? i2 : null === (s3 = u2.message.mentionedUsers) || void 0 === s3 ? void 0 : s3.map(function(e2) {
      return e2.userId;
    })) && void 0 !== a2 ? a2 : [], c2.userId), u2.forceUpdateLastMessage = null !== (o2 = r2.force_update_last_message) && void 0 !== o2 && o2, u2;
  }
  return t(t2, e), t2;
}(qe);
function xt(n2) {
  return n2.map(function(n3) {
    var r2, i2;
    return se(oe({ url: Ct.getPlainUrl(n3), file_name: n3.fileName, file_type: n3.mimeType, file_size: n3.fileSize, thumbnails: null === (r2 = n3._thumbnails) || void 0 === r2 ? void 0 : r2.map(function(e) {
      return Pe.payloadify(e);
    }), require_auth: null === (i2 = n3._uploadedMetaData) || void 0 === i2 ? void 0 : i2.requireAuth }));
  });
}
var Dt;
!function(e) {
  e[e.PENDING = 0] = "PENDING", e[e.UPLOADING = 1] = "UPLOADING", e[e.UPLOADED = 2] = "UPLOADED", e[e.SENDING = 3] = "SENDING", e[e.FAILED = 4] = "FAILED";
}(Dt || (Dt = {}));
var Lt = function() {
  function e(e2, t2) {
    var n2 = t2.sdkState, r2 = t2.dispatcher, i2 = t2.requestQueue, s3 = t2.onlineDetector, a2 = t2.cacheContext, o2 = this;
    this._queueMap = /* @__PURE__ */ new Map(), this._iid = e2, this._sdkState = n2, this._requestQueue = i2, this._cacheContext = a2, this._dispatcher = r2, this._dispatcher.on(function(e3) {
      e3 instanceof Fr && (o2._connectionState = e3.stateType);
    }), this._onlineDetector = s3;
  }
  return Object.defineProperty(e.prototype, "_shouldSendThroughWebSocket", { get: function() {
    return this._connectionState === Rr.CONNECTED || this._connectionState === Rr.CONNECTING || this._connectionState === Rr.RECONNECTING;
  }, enumerable: false, configurable: true }), e.prototype._sendFileMessage = function(e2, t2) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i2;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return n2 = this._createSendFileMessageRequestParams(e2, t2), this._shouldSendThroughWebSocket ? (r2 = new Ot(n2), [4, this._requestQueue.send(r2)]) : [3, 2];
          case 1:
            return i2 = s3.sent(), [2, i2.as(Pt).message];
          case 2:
            return r2 = new kt(n(n({}, n2), { userId: this._sdkState.userId })), [4, this._requestQueue.send(r2)];
          case 3:
            return i2 = s3.sent(), [2, i2.as(Rt).message];
        }
      });
    });
  }, e.prototype._createSendFileMessageRequestParams = function(e2, t2) {
    var n2 = n(n({}, t2.params), { channelUrl: e2.url, channelType: e2.channelType, reqId: t2.requestId, url: "" });
    if (t2.multipleFileUploadInfo) {
      var r2 = t2.params;
      n2.files = r2.fileInfoList;
    } else {
      r2 = t2.params;
      n2.url = r2.fileUrl, n2.requireAuth = r2.requireAuth;
    }
    return n2;
  }, e.prototype._resolveMessageQueue = function(e2) {
    var t2;
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, p;
      return s(this, function(m) {
        switch (m.label) {
          case 0:
            if (!(n2 = this._queueMap.get(e2.url)))
              return [3, 21];
            if (n2.isResolving)
              return [3, 20];
            n2.isResolving = true, r2 = [], i2 = true, m.label = 1;
          case 1:
            m.trys.push([1, 15, 16, 17]), s3 = o(n2.messageQueue), a2 = s3.next(), m.label = 2;
          case 2:
            if (a2.done)
              return [3, 14];
            switch (o2 = a2.value, o2.state) {
              case Dt.PENDING:
              case Dt.UPLOADING:
                return [3, 3];
              case Dt.UPLOADED:
                return [3, 4];
              case Dt.FAILED:
                return [3, 12];
            }
            return [3, 13];
          case 3:
            return i2 = false, r2.push(o2), [3, 13];
          case 4:
            if (!i2)
              return [3, 10];
            m.label = 5;
          case 5:
            return m.trys.push([5, 8, , 9]), o2.state = Dt.SENDING, [4, this._sendFileMessage(e2, o2)];
          case 6:
            return u2 = m.sent(), o2.deferred.resolve(u2), [4, ms(100)];
          case 7:
            return m.sent(), [3, 9];
          case 8:
            return c2 = m.sent(), o2.deferred.reject(c2), [3, 9];
          case 9:
            return [3, 11];
          case 10:
            r2.push(o2), m.label = 11;
          case 11:
            return [3, 13];
          case 12:
            return l = null !== (t2 = o2.error) && void 0 !== t2 ? t2 : b.unknown, o2.deferred.reject(l.code === u.REQUEST_CANCELED ? b.fileUploadCanceled : l), [3, 13];
          case 13:
            return a2 = s3.next(), [3, 2];
          case 14:
            return [3, 17];
          case 15:
            return d = m.sent(), f = { error: d }, [3, 17];
          case 16:
            try {
              a2 && !a2.done && (p = s3.return) && p.call(s3);
            } finally {
              if (f)
                throw f.error;
            }
            return [7];
          case 17:
            return h = n2.isResolveRequestPending, n2.messageQueue = r2, n2.isResolving = false, n2.isResolveRequestPending = false, h ? [4, this._resolveMessageQueue(e2)] : [3, 19];
          case 18:
            m.sent(), m.label = 19;
          case 19:
            return [3, 21];
          case 20:
            n2.isResolveRequestPending = true, m.label = 21;
          case 21:
            return [2];
        }
      });
    });
  }, e.prototype._uploadNextPendingItem = function(e2) {
    var t2;
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, u2, c2, l, d;
      return s(this, function(h) {
        switch (h.label) {
          case 0:
            return (n2 = this._queueMap.get(e2.url)) && (r2 = n2.messageQueue.find(function(e3) {
              return e3.state === Dt.PENDING;
            })) ? r2.multipleFileUploadInfo ? (i2 = r2.multipleFileUploadInfo, s3 = i2.uploadIndex, a2 = i2.uploadCount, o2 = i2.requestHandler, d = r2.params, u2 = d.fileInfoList[s3], !k(u2.file) || (null === (t2 = u2._uploadedMetaData) || void 0 === t2 ? void 0 : t2.isUploaded) ? [3, 2] : [4, this._tryUploadNextItemAndUpdateItemState(e2, n2, r2)]) : [3, 4] : [3, 9];
          case 1:
            return h.sent(), [3, 3];
          case 2:
            r2.state = s3 < a2 - 1 ? Dt.PENDING : Dt.UPLOADED, h.label = 3;
          case 3:
            return c2 = d.fileInfoList[s3], l = r2.multipleFileUploadInfo.uploadIndex++, r2.multipleFileUploadInfo.isCopy || null == o2 || o2._triggerOnFileUploaded(r2.requestId, l, c2, r2.error), [3, 7];
          case 4:
            return d = r2.params, k(d.file) ? [4, this._tryUploadNextItemAndUpdateItemState(e2, n2, r2)] : [3, 6];
          case 5:
            return h.sent(), [3, 7];
          case 6:
            d.thumbnailSizes = [], r2.state = Dt.UPLOADED, h.label = 7;
          case 7:
            return this._uploadNextPendingItem(e2), [4, this._resolveMessageQueue(e2)];
          case 8:
            h.sent(), h.label = 9;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype._tryUploadNextItemAndUpdateItemState = function(e2, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i2, s3, a2, o2, u2, c2;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this._onlineDetector.isOnline()];
          case 1:
            if (i2 = l.sent(), !uo.of(this._iid).sessionManager.currentUser || !i2)
              return r2.error = b.connectionRequired, r2.state = Dt.FAILED, [2];
            if (!(t2.uploadQueue.length < 6))
              return [3, 9];
            r2.state = Dt.UPLOADING, t2.uploadQueue.push(r2), l.label = 2;
          case 2:
            return l.trys.push([2, 7, , 8]), r2.multipleFileUploadInfo ? (s3 = r2.multipleFileUploadInfo, a2 = s3.uploadIndex, o2 = s3.uploadCount, u2 = r2.params, [4, this._uploadNextFileForMultipleFilesItemAndUpdateParams(e2, r2, u2)]) : [3, 4];
          case 3:
            return l.sent(), r2.state = a2 < o2 - 1 ? Dt.PENDING : Dt.UPLOADED, [3, 6];
          case 4:
            return u2 = r2.params, [4, this._uploadNextFileForSingleFileItemAndUpdateParams(e2, r2, u2)];
          case 5:
            l.sent(), r2.state = Dt.UPLOADED, l.label = 6;
          case 6:
            return [3, 8];
          case 7:
            switch ((c2 = l.sent()).code) {
              case u.REQUEST_FAILED:
                r2.error = new b({ code: u.NETWORK_ERROR, message: "Failed to upload a file." });
                break;
              case u.REQUEST_CANCELED:
                r2.error = b.fileUploadCanceled;
                break;
              default:
                r2.error = c2;
            }
            return r2.state = Dt.FAILED, [3, 8];
          case 8:
            this._dequeueUploadItem(t2, r2), l.label = 9;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype._dequeueUploadItem = function(e2, t2) {
    var n2 = e2.uploadQueue.findIndex(function(e3) {
      return e3.requestId === t2.requestId;
    });
    n2 >= 0 && e2.uploadQueue.splice(n2, 1);
  }, e.prototype._uploadNextFileForSingleFileItemAndUpdateParams = function(e2, t2, n2) {
    var r2, i2, s3;
    return r(this, void 0, void 0, function() {
      var a2, o2, u2, c2, l, d, h, f, p, m;
      return s(this, function(v2) {
        switch (v2.label) {
          case 0:
            return a2 = new Re2({ file: n2.file, channelUrl: e2.url, thumbnailSizes: n2.thumbnailSizes, requestId: t2.requestId }), [4, this._requestQueue.send(a2)];
          case 1:
            return o2 = v2.sent(), u2 = o2.as(xe2), c2 = u2.url, l = u2.fileSize, d = void 0 === l ? n2.fileSize : l, h = u2.thumbnails, f = void 0 === h ? [] : h, p = u2.requireAuth, m = void 0 !== p && p, n2.fileName = null !== (r2 = n2.fileName) && void 0 !== r2 ? r2 : n2.file.name, n2.mimeType = null !== (i2 = n2.mimeType) && void 0 !== i2 ? i2 : n2.file.type, n2.fileSize = null !== (s3 = n2.fileSize) && void 0 !== s3 ? s3 : n2.file.size, n2.fileUrl = c2, n2.fileSize = d, n2.requireAuth = m, n2._thumbnails = f, [2];
        }
      });
    });
  }, e.prototype._uploadNextFileForMultipleFilesItemAndUpdateParams = function(e2, t2, n2) {
    var r2, i2, s3;
    return r(this, void 0, void 0, function() {
      var a2, o2, c2, l, d, h, f, p, m, v2, y;
      return s(this, function(_) {
        switch (_.label) {
          case 0:
            return a2 = t2.multipleFileUploadInfo.uploadIndex, o2 = n2.fileInfoList[a2], c2 = new Re2({ file: o2.file, channelUrl: e2.url, thumbnailSizes: o2.thumbnailSizes, requestId: t2.requestId }), [4, this._requestQueue.send(c2)];
          case 1:
            return l = _.sent(), d = l.as(xe2), h = d.url, f = d.fileSize, p = void 0 === f ? o2.fileSize : f, m = d.thumbnails, v2 = d.requireAuth, y = void 0 !== v2 && v2, o2.fileName = null !== (r2 = o2.fileName) && void 0 !== r2 ? r2 : o2.file.name, o2.mimeType = null !== (i2 = o2.mimeType) && void 0 !== i2 ? i2 : o2.file.type, o2.fileSize = null !== (s3 = o2.fileSize) && void 0 !== s3 ? s3 : o2.file.size, o2.file = void 0, o2.fileUrl = h, o2.fileSize = p, o2._thumbnails = m, o2._uploadedMetaData = n(n({}, o2._uploadedMetaData), { requireAuth: y, isUploaded: true }), o2 instanceof Ct || (n2.fileInfoList[a2] = new Ct(this._iid, o2)), [2];
        }
      });
    });
  }, e.prototype.request = function(e2, t2, n2, r2) {
    return void 0 === r2 && (r2 = {}), r(this, void 0, void 0, function() {
      var i2, s3, a2, o2, c2;
      return s(this, function(l) {
        return this._queueMap.has(e2.url) || (i2 = { messageQueue: [], uploadQueue: [], isResolving: false, isResolveRequestPending: false }, this._queueMap.set(e2.url, i2)), s3 = this._queueMap.get(e2.url), a2 = new rt(), o2 = { requestId: t2, params: n2, state: Dt.PENDING, deferred: a2 }, function(e3) {
          return "fileInfoList" in e3;
        }(n2) && (c2 = n({ uploadIndex: 0, uploadCount: n2.fileInfoList.length }, r2), o2.multipleFileUploadInfo = c2), s3.messageQueue.push(o2), this._uploadNextPendingItem(e2), [2, a2.promise];
      });
    });
  }, e.prototype.cancel = function(e2, t2) {
    var n2, r2, i2 = this._queueMap.get(e2.url);
    if (i2) {
      var s3 = t2 ? [i2.messageQueue.find(function(e3) {
        return e3.requestId === t2;
      })] : c([], a(i2.messageQueue), false);
      try {
        for (var a2 = o(s3), o2 = a2.next(); !o2.done; o2 = a2.next()) {
          var u2 = o2.value;
          if (u2)
            switch (u2.state) {
              case Dt.PENDING:
                if (u2.state = Dt.FAILED, u2.error = b.requestCanceled, u2.multipleFileUploadInfo && !u2.multipleFileUploadInfo.isCopy) {
                  var c2 = u2.multipleFileUploadInfo, l = c2.uploadIndex, d = c2.requestHandler, h = u2.params.fileInfoList[l];
                  null == d || d._triggerOnFileUploaded(u2.requestId, l, h, b.fileUploadCanceled);
                }
                this._resolveMessageQueue(e2);
                break;
              case Dt.UPLOADING:
                this._requestQueue.cancel(u2.requestId), this._dispatcher.dispatch(new st({ requestId: u2.requestId }));
            }
        }
      } catch (e3) {
        n2 = { error: e3 };
      } finally {
        try {
          o2 && !o2.done && (r2 = a2.return) && r2.call(a2);
        } finally {
          if (n2)
            throw n2.error;
        }
      }
    } else
      t2 && (this._requestQueue.cancel(t2), this._dispatcher.dispatch(new st({ requestId: t2 })));
  }, e;
}();
var Ft;
var qt;
var zt = { prevResultSize: 0, nextResultSize: 0, isInclusive: false, reverse: false, messageTypeFilter: j.ALL, customTypesFilter: void 0, senderUserIdsFilter: void 0, replyType: Q.NONE, includeReactions: false, includeMetaArray: false, includeParentMessageInfo: false, includeThreadInfo: false, showSubchannelMessagesOnly: false };
var Bt = function(e) {
  return S("number", e.prevResultSize) && S("number", e.nextResultSize) && S("boolean", e.isInclusive) && S("boolean", e.reverse) && S("string", e.messageTypeFilter) && T(j, e.messageTypeFilter) && C("string", e.customTypesFilter, true) && C("string", e.senderUserIdsFilter, true) && T(Q, e.replyType) && S("boolean", e.includeMetaArray) && S("boolean", e.includeReactions) && S("boolean", e.includeParentMessageInfo) && S("boolean", e.includeThreadInfo) && S("boolean", e.showSubchannelMessagesOnly);
};
var jt = { replyType: Q.NONE, includeReactions: false, includeThreadInfo: false, includeMetaArray: false, includeParentMessageInfo: false };
var Kt = function(e) {
  return T(Q, e.replyType) && S("boolean", e.includeReactions) && S("boolean", e.includeMetaArray) && S("boolean", e.includeParentMessageInfo) && S("boolean", e.includeThreadInfo);
};
!function(e) {
  e.MESSAGE = "message";
}(Ft || (Ft = {})), function(e) {
  e.INTERNAL_BACKSYNC = "internal_backsync", e.INTERNAL_FILL_GAP = "internal_fill_gap", e.EXTERNAL_LEGACY = "external_legacy", e.EXTERNAL_COLLECTION = "external_collection";
}(qt || (qt = {}));
var Qt;
var Gt = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.includeMetaArray, o2 = t3.includeReactions, u2 = t3.includeThreadInfo, c2 = t3.includeParentMessageInfo, l = e.call(this) || this;
    return l.method = ae.GET, l.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(encodeURIComponent(s3)), l.params = { is_sdk: true, with_sorted_meta_array: a2, include_reactions_summary: null != o2 && o2, include_thread_info: u2, include_parent_message_info: c2, include_poll_details: true }, l;
  }
  return t(t2, e), t2;
}(Fe);
var Vt = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.message = n2 ? At(t3, n({}, n2)) : null, r2;
  }
  return t(t2, e), t2;
}(qe);
var Ht = function(n2) {
  function s3(r2) {
    var s4 = r2.channelType, a2 = r2.channelUrl, o2 = r2.timestamp, u2 = r2.token, c2 = r2.prevResultSize, l = r2.nextResultSize, d = r2.isInclusive, h = r2.reverse, f = r2.messageTypeFilter, p = r2.customTypesFilter, m = r2.senderUserIdsFilter, v2 = r2.replyType, y = r2.includeMetaArray, _ = r2.includeReactions, g = r2.parentMessageId, b2 = r2.includeThreadInfo, I2 = r2.includeParentMessageInfo, E = r2.showSubchannelMessagesOnly, T2 = r2.checkingHasNext, M = r2.checkingContinuousMessages, S2 = r2.sdkSource, U = n2.call(this) || this;
    return U.method = ae.GET, U.path = "".concat(Re(s4), "/").concat(encodeURIComponent(a2), "/messages"), U.params = se(oe({ is_sdk: true, prev_limit: c2, next_limit: l, include: d, reverse: h, message_ts: o2, message_id: u2, message_type: null != f ? f : null, custom_types: p, sender_ids: m, include_reply_type: v2, with_sorted_meta_array: y, include_reactions_summary: _, parent_message_id: g, include_thread_info: b2, include_parent_message_info: I2, show_subchannel_message_only: E, include_poll_details: true, checking_has_next: T2, checking_continuous_messages: M, sdk_source: S2 })), U;
  }
  return t(s3, n2), s3;
}(Fe);
var Wt = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return void 0 !== n2.is_continuous_messages && (r2.isContinuousMessages = n2.is_continuous_messages), void 0 !== n2.has_next && (r2.hasNext = n2.has_next), r2.messages = n2.messages.map(function(e2) {
      return At(t3, e2);
    }), r2;
  }
  return t(t2, e), t2;
}(qe);
var Yt = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.timestamp, a2 = t3.token, o2 = t3.replyType, u2 = t3.includeMetaArray, c2 = t3.includeReactions, l = t3.includeThreadInfo, d = t3.includeParentMessageInfo, h = e.call(this) || this;
    return h.method = ae.GET, h.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/changelogs"), h.params = { change_ts: s3, token: a2, with_sorted_meta_array: u2, include_reactions_summary: c2, include_thread_info: l, include_reply_type: o2, include_parent_message_info: d, include_poll_details: true }, h;
  }
  return t(t2, e), t2;
}(Fe);
var Jt = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.updatedMessages = n2.updated.map(function(e2) {
      return At(t3, e2);
    }), r2.deletedMessagesInfo = n2.deleted.map(function(e2) {
      return { messageId: e2.message_id, deletedAt: e2.deleted_at };
    }), r2.hasMore = n2.has_more, r2.nextToken = n2.next, r2.forceUseNextToken = n2.force_use_next_token || false, r2;
  }
  return t(t2, e), t2;
}(qe);
var Xt = function(e) {
  function t2(t3) {
    var n2 = t3.channelUrl, r2 = t3.scheduledMessageId, s3 = e.call(this) || this;
    return s3.method = ae.GET, s3.path = "".concat(de, "/").concat(encodeURIComponent(n2), "/scheduled_messages/").concat(encodeURIComponent(r2)), s3.params = {}, s3;
  }
  return t(t2, e), t2;
}(Fe);
var Zt = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.message = n2 ? At(t3, n({}, n2)) : null, r2;
  }
  return t(t2, e), t2;
}(qe);
!function(e) {
  e.MUTED = "muted", e.BANNED = "banned";
}(Qt || (Qt = {}));
var $t = function() {
  function n2(e) {
    var t2, n3, r2, i2;
    this.restrictionType = null, T(Qt, e.restriction_type) && (this.restrictionType = e.restriction_type), this.description = null !== (t2 = e.description) && void 0 !== t2 ? t2 : null, this.endAt = null !== (r2 = null !== (n3 = e.end_at) && void 0 !== n3 ? n3 : e.muted_end_at) && void 0 !== r2 ? r2 : -1, this.remainingDuration = null !== (i2 = e.remaining_duration) && void 0 !== i2 ? i2 : -1;
  }
  return n2.payloadify = function(n3) {
    return se(oe({ restriction_type: n3.restrictionType, description: n3.description, end_at: n3.endAt, remaining_duration: n3.remainingDuration }));
  }, n2;
}();
var en = function(n2) {
  function i2(e, t2) {
    var r2 = n2.call(this, e, t2) || this;
    return r2.restrictionInfo = new $t(t2), r2;
  }
  return t(i2, n2), i2.payloadify = function(r2) {
    return se(oe(n(n({}, n2.payloadify.call(this, r2)), $t.payloadify(r2.restrictionInfo))));
  }, i2;
}(ls);
var tn = function(e) {
  function t2(t3, n2) {
    var r2, i2 = this;
    return (i2 = e.call(this, t3, n2) || this).isMuted = false, i2.isMuted = null !== (r2 = n2.is_muted) && void 0 !== r2 && r2, i2;
  }
  return t(t2, e), t2;
}(ls);
var nn = function() {
  function e() {
    this._onPending = ut, this._onFailed = ut, this._onSucceeded = ut;
  }
  return e.prototype._trigger = function(e2) {
    switch (null == e2 ? void 0 : e2.sendingStatus) {
      case Z.PENDING:
        0 === e2.errorCode && this._onPending(e2);
        break;
      case Z.SCHEDULED:
      case Z.SUCCEEDED:
        this._onSucceeded(e2);
    }
  }, e.prototype._triggerFailed = function(e2, t2) {
    switch (null == t2 ? void 0 : t2.sendingStatus) {
      case Z.FAILED:
      case Z.CANCELED:
        this._onFailed(e2, t2.scheduledInfo ? null : t2);
    }
  }, e.prototype.onPending = function(e2) {
    return this._onPending = e2, this;
  }, e.prototype.onFailed = function(e2) {
    return this._onFailed = e2, this;
  }, e.prototype.onSucceeded = function(e2) {
    return this._onSucceeded = e2, this;
  }, e;
}();
var rn = { data: void 0, customType: void 0, mentionType: B.USERS, mentionedUserIds: void 0, mentionedUsers: void 0, metaArrays: void 0, parentMessageId: void 0, isReplyToChannel: false, pushNotificationDeliveryOption: void 0, appleCriticalAlertOptions: void 0, isPinnedMessage: false, pollId: void 0 };
var sn = function(e) {
  return S("string", e.data, true) && S("string", e.customType, true) && T(B, e.mentionType) && C("string", e.mentionedUserIds, true) && C(ls, e.mentionedUsers, true) && C(Ve, e.metaArrays, true) && S("number", e.parentMessageId, true) && S("boolean", e.isReplyToChannel) && T(W, e.pushNotificationDeliveryOption, true) && S(Ke, e.appleCriticalAlertOptions, true) && S("boolean", e.isPinnedMessage, true) && S("number", e.pollId, true);
};
var an = function(e) {
  return { isReplyToChannel: e.isReplyToChannel, pushNotificationDeliveryOption: e.pushNotificationDeliveryOption, pollId: e.pollId };
};
var on = n(n({}, rn), { message: "", mentionedMessageTemplate: void 0, translationTargetLanguages: void 0, extendedMessagePayload: void 0 });
function un(e) {
  var n2, r2, i2;
  return null !== (n2 = e.messageParams) && void 0 !== n2 ? n2 : oe(n(n({}, e), { mentionType: e.mentionType, mentionedUserIds: null !== (r2 = e.mentionedUserIds) && void 0 !== r2 ? r2 : null === (i2 = e.mentionedUsers) || void 0 === i2 ? void 0 : i2.map(function(e2) {
    return e2.userId;
  }), mentionedMessageTemplate: e.mentionedMessageTemplate, translationTargetLanguages: Object.keys(e.translations), pushNotificationDeliveryOption: W.DEFAULT, parentMessageId: null, isReplyToChannel: false, isPinnedMessage: false }));
}
var cn;
var ln = function(n2) {
  var r2;
  return se(oe({ data: n2.data, customType: n2.customType, mentionType: n2.mentionType, mentionedUsers: n2.mentionedUsers, mentionedUserIds: n2.mentionedUserIds, mentionedMessageTemplate: n2.mentionedMessageTemplate, metaArrays: n2.metaArrays, pollId: null === (r2 = n2.poll) || void 0 === r2 ? void 0 : r2.id, parentMessageId: n2.parentMessageId, appleCriticalAlertOptions: n2.appleCriticalAlertOptions, message: n2.message, translationTargetLanguages: Object.keys(n2.translations), extendedMessagePayload: n2.extendedMessagePayload }));
};
var dn = function(e) {
  return sn(e) && S("string", e.message) && S("string", e.mentionedMessageTemplate, true) && C("string", e.translationTargetLanguages, true) && S("object", e.extendedMessagePayload, true);
};
!function(e) {
  e.FILE = "file", e.BLOB = "blob", e.BLOB_LIKE_OBJECT = "blobLikeObject", e.URL = "url";
}(cn || (cn = {}));
var hn = function(e) {
  return "undefined" != typeof window && "Blob" in window && "undefined" != typeof Blob && e instanceof Blob;
};
var fn = function(e) {
  return e === cn.BLOB || e === cn.FILE;
};
var pn = function(e) {
  return { file: e.file, fileKey: e.fileKey, fileType: e.fileType, isReplyToChannel: e.isReplyToChannel, pushNotificationDeliveryOption: e.pushNotificationDeliveryOption };
};
var mn = n(n({}, rn), { file: void 0, fileKey: void 0, fileUrl: void 0, fileName: void 0, fileType: void 0, fileSize: void 0, mimeType: void 0, thumbnailSizes: void 0, requireAuth: false, message: void 0 });
function vn(e) {
  var n2, r2, i2, s3;
  return null !== (n2 = e.messageParams) && void 0 !== n2 ? n2 : oe(n(n({}, e), { fileUrl: e.plainUrl, fileName: e.name, fileSize: e.size, mimeType: e.type, mentionType: e.mentionType, mentionedUserIds: null !== (r2 = e.mentionedUserIds) && void 0 !== r2 ? r2 : null === (i2 = e.mentionedUsers) || void 0 === i2 ? void 0 : i2.map(function(e2) {
    return e2.userId;
  }), pushNotificationDeliveryOption: W.DEFAULT, parentMessageId: null, isReplyToChannel: false, thumbnailSizes: null === (s3 = e.thumbnails) || void 0 === s3 ? void 0 : s3.map(function(e2) {
    return { maxWidth: e2.width, maxHeight: e2.height };
  }), requireAuth: e.requireAuth, isPinnedMessage: false, _thumbnails: e.thumbnails, message: e.message }));
}
var yn;
var _n = function(n2, r2) {
  var i2, s3;
  return n2.messageParams ? (!n2.url && k(r2) && (n2.messageParams.file = r2), n2.messageParams) : se(oe({ data: n2.data, customType: n2.customType, mentionType: n2.mentionType, mentionedUsers: n2.mentionedUsers, mentionedUserIds: n2.mentionedUserIds, metaArrays: n2.metaArrays, parentMessageId: n2.parentMessageId, appleCriticalAlertOptions: n2.appleCriticalAlertOptions, file: r2, fileUrl: n2.url, fileName: n2.name, fileSize: n2.size, mimeType: n2.type, thumbnailSizes: null === (i2 = n2.thumbnails) || void 0 === i2 ? void 0 : i2.map(function(e) {
    return { maxWidth: e.width, maxHeight: e.height };
  }), message: n2.message, pollId: null === (s3 = n2.poll) || void 0 === s3 ? void 0 : s3.id }));
};
var gn = function(e) {
  return sn(e) && (k(e.file) || S("string", e.fileUrl)) && S("string", e.fileName, true) && S("string", e.mimeType, true) && S("number", e.fileSize, true) && S("string", e.message, true) && (null === e.thumbnailSizes || void 0 === e.thumbnailSizes || Array.isArray(e.thumbnailSizes) && e.thumbnailSizes.every(function(e2) {
    return S("object", e2) && e2.maxWidth > 0 && e2.maxHeight > 0;
  }));
};
var bn = { data: void 0, customType: void 0, mentionType: B.USERS, mentionedUserIds: void 0, mentionedUsers: void 0, metaArrays: void 0, pushNotificationDeliveryOption: void 0, appleCriticalAlertOptions: void 0 };
var In = function(e) {
  return S("string", e.data, true) && S("string", e.customType, true) && T(B, e.mentionType) && C("string", e.mentionedUserIds, true) && C(ls, e.mentionedUsers, true) && C(Ve, e.metaArrays, true) && T(W, e.pushNotificationDeliveryOption, true) && S(Ke, e.appleCriticalAlertOptions, true);
};
var En = n(n({}, bn), { message: void 0, mentionedMessageTemplate: void 0, translationTargetLanguages: void 0, pollId: void 0 });
var Tn = function(e) {
  return In(e) && S("string", e.mentionedMessageTemplate, true) && S("string", e.message, true) && C("string", e.translationTargetLanguages, true) && S("number", e.pollId, true);
};
var wn = n({}, bn);
var Mn = function(e) {
  function t2(t3) {
    var n2 = t3.channelUrl, r2 = t3.channelType, s3 = t3.token, a2 = t3.limit, o2 = e.call(this) || this;
    return o2.method = ae.GET, o2.path = "".concat(Re(r2), "/").concat(encodeURIComponent(n2), "/operators"), o2.params = { token: s3, limit: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
var Sn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.operators = n2.operators.map(function(e2) {
      return new ls(t3, e2);
    }), r2.token = n2.next, r2;
  }
  return t(t2, e), t2;
}(qe);
var Un = function(e) {
  function t2(t3, n2, r2, i2) {
    return e.call(this, t3, n2, r2, i2) || this;
  }
  return t(t2, e), t2.prototype._validate = function() {
    return e.prototype._validate.call(this);
  }, t2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : (e2 = [], this._hasNext ? (this._isLoading = true, t3 = uo.of(this._iid).requestQueue, r2 = new Mn(n(n({}, this), { channelUrl: this.channelUrl, token: this._token })), [4, t3.send(r2)]) : [3, 2]) : [3, 5];
          case 1:
            return i2 = c2.sent(), s3 = i2.as(Sn), a2 = s3.operators, o2 = s3.token, this._token = o2, this._hasNext = !!o2, this._isLoading = false, [2, a2];
          case 2:
            return [2, e2];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(ko);
var An = function(e) {
  function n2(t2, n3, r2, i2) {
    var s3, a2, o2, u2, c2, l, d, h, f, p, m = this;
    return (m = e.call(this, t2, n3, r2, i2) || this).reverse = false, m.messageTypeFilter = j.ALL, m.customTypesFilter = null, m.senderUserIdsFilter = null, m.replyType = Q.NONE, m.includeMetaArray = false, m.includeReactions = false, m.includeParentMessageInfo = false, m.includeThreadInfo = false, m.showSubchannelMessagesOnly = false, m._edge = Number.MAX_SAFE_INTEGER, m.reverse = null !== (s3 = i2.reverse) && void 0 !== s3 && s3, m.messageTypeFilter = null !== (a2 = i2.messageTypeFilter) && void 0 !== a2 ? a2 : j.ALL, m.customTypesFilter = null !== (o2 = i2.customTypesFilter) && void 0 !== o2 ? o2 : null, m.senderUserIdsFilter = null !== (u2 = i2.senderUserIdsFilter) && void 0 !== u2 ? u2 : null, m.replyType = null !== (c2 = i2.replyType) && void 0 !== c2 ? c2 : Q.NONE, m.includeMetaArray = null !== (l = i2.includeMetaArray) && void 0 !== l && l, m.includeReactions = null !== (d = i2.includeReactions) && void 0 !== d && d, m.includeParentMessageInfo = null !== (h = i2.includeParentMessageInfo) && void 0 !== h && h, m.includeThreadInfo = null !== (f = i2.includeThreadInfo) && void 0 !== f && f, m.showSubchannelMessagesOnly = null !== (p = i2.showSubchannelMessagesOnly) && void 0 !== p && p, m;
  }
  return t(n2, e), n2.prototype._validate = function() {
    return e.prototype._validate.call(this) && S("boolean", this.reverse) && T(j, this.messageTypeFilter) && T(Q, this.replyType) && C("string", this.customTypesFilter, true) && C("string", this.senderUserIdsFilter, true) && S("boolean", this.includeMetaArray) && S("boolean", this.includeReactions) && S("boolean", this.includeParentMessageInfo) && S("boolean", this.includeThreadInfo) && S("boolean", this.showSubchannelMessagesOnly);
  }, n2.prototype.load = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(n3) {
        switch (n3.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, [4, la.of(this._iid).getMessagesByTimestamp(this.channelUrl, this.channelType, this._edge, oe({ prevResultSize: this.limit, nextResultSize: 0, isInclusive: false, reverse: this.reverse, messageTypeFilter: this.messageTypeFilter, customTypesFilter: this.customTypesFilter, replyType: this.replyType, senderUserIdsFilter: this.senderUserIdsFilter, includeReactions: this.includeReactions, includeMetaArray: this.includeMetaArray, includeParentMessageInfo: this.includeParentMessageInfo, includeThreadInfo: this.includeThreadInfo, showSubchannelMessagesOnly: this.showSubchannelMessagesOnly }))]) : [3, 2] : [3, 5];
          case 1:
            return e2 = n3.sent(), this._edge = Math.min.apply(Math, c([Number.MAX_SAFE_INTEGER], a(e2.map(function(e3) {
              return e3.createdAt;
            })), false)), this._hasNext = e2.length >= this.limit, this._isLoading = false, [2, e2];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, n2;
}(ko);
var Nn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.limit, o2 = t3.token;
    return (n2 = e.call(this) || this).method = ae.GET, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/mute"), n2.params = { limit: a2, token: o2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var Cn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    r2.mutedUsers = [];
    var i2 = n2.next, s3 = n2.muted_list;
    return r2.token = i2, s3 && s3.length > 0 && (r2.mutedUsers = s3.map(function(e2) {
      return new en(t3, e2);
    })), r2;
  }
  return t(t2, e), t2;
}(qe);
var On = function(e) {
  function t2(t3, n2, r2, i2) {
    return e.call(this, t3, n2, r2, i2) || this;
  }
  return t(t2, e), t2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, t3 = new Nn(n(n({}, this), { token: this._token })), [4, e2.send(t3)]) : [3, 2] : [3, 5];
          case 1:
            return r2 = o2.sent(), i2 = r2.as(Cn), s3 = i2.mutedUsers, a2 = i2.token, this._token = a2, this._hasNext = !!a2, this._isLoading = false, [2, s3];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(ko);
var kn = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelUrl, a2 = n3.channelType, o2 = n3.limit, u2 = n3.token;
    return (r2 = t2.call(this) || this).method = ae.GET, r2.path = "".concat(Re(a2), "/").concat(encodeURIComponent(s3), "/ban"), r2.params = se({ limit: o2, token: u2 }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var Pn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    r2.bannedUsers = [];
    var i2 = n2.next, s3 = n2.banned_list;
    return r2.token = i2, s3 && s3.length > 0 && (r2.bannedUsers = s3.map(function(e2) {
      return new en(t3, e2.user);
    })), r2;
  }
  return t(t2, e), t2;
}(qe);
var Rn = function(e) {
  function t2(t3, n2, r2, i2) {
    return e.call(this, t3, n2, r2, i2) || this;
  }
  return t(t2, e), t2.prototype._validate = function() {
    return e.prototype._validate.call(this);
  }, t2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, t3 = new kn(n(n({}, this), { token: this._token })), [4, e2.send(t3)]) : [3, 2] : [3, 5];
          case 1:
            return r2 = o2.sent(), i2 = r2.as(Pn), s3 = i2.bannedUsers, a2 = i2.token, this._token = a2, this._hasNext = !!a2, this._isLoading = false, [2, s3];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(ko);
!function(e) {
  e.SPAM = "spam", e.HARASSING = "harassing", e.SUSPICIOUS = "suspicious", e.INAPPROPRIATE = "inappropriate";
}(yn || (yn = {}));
var xn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.operatorUserIds;
    return (n2 = e.call(this) || this).method = ae.POST, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/operators"), n2.params = { operator_ids: a2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var Dn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.operatorUserIds;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/operators"), n2.params = { operator_ids: a2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var Ln = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.userId;
    return (n2 = e.call(this) || this).method = ae.GET, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/mute/").concat(a2), n2;
  }
  return t(t2, e), t2;
}(Fe);
var Fn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    r2.isMuted = false, r2.startAt = 0, r2.endAt = 0;
    var i2 = n2.is_muted, s3 = n2.start_at, a2 = n2.end_at, o2 = n2.remaining_duration, u2 = n2.description;
    return r2.isMuted = i2, r2.startAt = s3, r2.endAt = a2, r2.remainingDuration = o2, r2.description = u2, r2;
  }
  return t(t2, e), t2;
}(qe);
var qn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.keys;
    return (n2 = e.call(this) || this).method = ae.GET, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metadata"), n2.params = { keys: a2, include_ts: true }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var zn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.metadata, s3 = n2.ts;
    return r2.metadata = i2, r2.ts = s3, r2;
  }
  return t(t2, e), t2;
}(qe);
var Bn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.metadata;
    return (n2 = e.call(this) || this).method = ae.POST, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metadata"), n2.params = { metadata: a2, include_ts: true }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var jn = function(e) {
  function t2(t3, n2) {
    var r2, i2, s3 = this;
    return (s3 = e.call(this, t3, n2) || this).metaData = null !== (r2 = n2.metadata) && void 0 !== r2 ? r2 : {}, s3.ts = null !== (i2 = n2.ts) && void 0 !== i2 ? i2 : null, s3;
  }
  return t(t2, e), t2;
}(qe);
var Kn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.metadata, o2 = t3.upsert;
    return (n2 = e.call(this) || this).method = ae.PUT, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metadata"), n2.params = { metadata: a2, include_ts: true, upsert: null != o2 && o2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var Qn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.metadata, s3 = n2.ts;
    return r2.metadata = i2, r2.ts = s3, r2;
  }
  return t(t2, e), t2;
}(qe);
var Gn = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return r2.data && (i2.created = r2.data.created, i2.updated = r2.data.updated, i2.deleted = r2.data.deleted), i2;
  }
  return t(t2, e), t2;
}(ze);
var Vn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.key;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metadata/").concat(a2), n2.params = { include_ts: true }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var Hn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.ts;
    return r2.ts = i2, r2;
  }
  return t(t2, e), t2;
}(qe);
var Wn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metadata"), n2.params = { include_ts: true }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var Yn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.ts;
    return r2.ts = i2, r2;
  }
  return t(t2, e), t2;
}(qe);
var Jn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.keys;
    return (n2 = e.call(this) || this).method = ae.GET, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metacounter"), n2.params = { keys: a2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var Xn = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.metaCounter = n2, r2;
  }
  return t(t2, e), t2;
}(qe);
var Zn = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.metaCounter;
    return (n2 = e.call(this) || this).method = ae.POST, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metacounter"), n2.params = { metacounter: a2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var $n = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.metaCounter = n2, r2;
  }
  return t(t2, e), t2;
}(qe);
var er = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.metaCounter, o2 = t3.upsert, u2 = void 0 !== o2 && o2, c2 = t3.mode, l = void 0 === c2 ? "set" : c2;
    return (n2 = e.call(this) || this).method = ae.PUT, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metacounter"), n2.params = { metacounter: a2, upsert: u2, mode: l }, n2;
  }
  return t(t2, e), t2;
}(Fe);
var tr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.metaCounter = n2, r2;
  }
  return t(t2, e), t2;
}(qe);
var nr = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return r2.data && (i2.created = r2.data.created, i2.updated = r2.data.updated, i2.deleted = r2.data.deleted), i2;
  }
  return t(t2, e), t2;
}(ze);
var rr = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.key;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metacounter/").concat(a2), n2.params = {}, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var ir = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/metacounter"), n2.params = {}, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var sr = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.userId, o2 = t3.seconds, u2 = t3.description;
    return (n2 = e.call(this) || this).method = ae.POST, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/mute"), n2.params = { user_id: a2, seconds: o2, description: u2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var ar = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return i2.user = new en(t3, r2.data), i2;
  }
  return t(t2, e), t2;
}(ze);
var or = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.userId;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/mute/").concat(encodeURIComponent(a2)), n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var ur = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return i2.user = new en(t3, r2.data), i2;
  }
  return t(t2, e), t2;
}(ze);
var cr = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelUrl, a2 = n3.channelType, o2 = n3.userId, u2 = n3.seconds, c2 = n3.description;
    return (r2 = t2.call(this) || this).method = ae.POST, r2.path = "".concat(Re(a2), "/").concat(encodeURIComponent(s3), "/ban"), r2.params = se({ user_id: o2, seconds: u2, description: c2 }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var lr = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return i2.user = new en(t3, r2.data), r2.data.member_count && (i2.memberCount = r2.data.member_count), r2.data.joined_member_count && (i2.joinedMemberCount = r2.data.joined_member_count), i2;
  }
  return t(t2, e), t2;
}(ze);
var dr = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.userId;
    return (n2 = e.call(this) || this).method = ae.DELETE, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/ban/").concat(encodeURIComponent(a2)), n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var hr = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return i2.user = new en(t3, r2.data), i2;
  }
  return t(t2, e), t2;
}(ze);
var fr = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.channelUrl, s3 = t3.channelType, a2 = t3.freezing;
    return (n2 = e.call(this) || this).method = ae.PUT, n2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(r2), "/freeze"), n2.params = { freeze: a2 }, n2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var pr = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "SYEV", r2) || this;
    return i2.freeze = r2.data.freeze, i2;
  }
  return t(t2, e), t2;
}(ze);
var mr = function(e) {
  return e instanceof ro ? e._custom ? "custom" : e.name : e;
};
var vr = function(e) {
  if (e instanceof ro && e._custom)
    return e.name;
};
var yr = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelUrl, a2 = n3.channelType, o2 = n3.category, u2 = n3.userId, c2 = n3.description;
    return (r2 = t2.call(this) || this).method = ae.POST, r2.path = "".concat(Le(a2), "/").concat(encodeURIComponent(s3)), r2.params = se({ report_category: mr(o2), reporting_user_id: u2, report_description: c2, custom_report_category_name: vr(o2) }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var _r = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelUrl, a2 = n3.channelType, o2 = n3.category, u2 = n3.userId, c2 = n3.offendingUserId, l = n3.description;
    return (r2 = t2.call(this) || this).method = ae.POST, r2.path = "".concat(ge, "/users/").concat(c2), r2.params = se({ channel_url: s3, channel_type: a2 === H.OPEN ? "open_channels" : "group_channels", report_category: mr(o2), reporting_user_id: u2, report_description: l, custom_report_category_name: vr(o2) }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var gr = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelUrl, a2 = n3.channelType, o2 = n3.category, u2 = n3.userId, c2 = n3.offendingUserId, l = n3.messageId, d = n3.description;
    return (r2 = t2.call(this) || this).method = ae.POST, r2.path = "".concat(Le(a2), "/").concat(encodeURIComponent(s3), "/messages/").concat(l), r2.params = se({ report_category: mr(o2), reporting_user_id: u2, report_description: d, offending_user_id: c2, custom_report_category_name: vr(o2) }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var br = function(n2) {
  function i2(r2) {
    var i3 = [];
    return r2.mentionType === B.USERS && (r2.mentionedUserIds ? i3 = r2.mentionedUserIds : r2.mentionedUsers && (i3 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    }))), n2.call(this, { code: "MESG", ackRequired: true, payload: se(oe({ channel_url: r2.channelUrl, message: r2.message, data: r2.data, custom_type: r2.customType, metaarray: r2.metaArrays, mention_type: r2.mentionType, mentioned_user_ids: i3, mentioned_message_template: r2.mentionedMessageTemplate, target_langs: r2.translationTargetLanguages, push_option: r2.pushNotificationDeliveryOption && r2.pushNotificationDeliveryOption !== W.DEFAULT ? r2.pushNotificationDeliveryOption : void 0, apple_critical_alert_options: r2.appleCriticalAlertOptions, silent: r2.silent, reply_to_channel: r2.isReplyToChannel, parent_message_id: r2.parentMessageId ? r2.parentMessageId : null, req_id: r2.reqId, poll_id: r2.pollId, pin_message: r2.isPinnedMessage, extended_message_payload: r2.extendedMessagePayload })) }) || this;
  }
  return t(i2, n2), i2;
}(Ge);
var Ir = function(e) {
  function t2(t3, r2, i2) {
    var s3, a2, o2, u2, c2 = this;
    (c2 = e.call(this, t3, "MESG", i2) || this).message = new wt(t3, i2);
    var l = uo.of(t3).sdkState;
    return c2.isMentioned = xe(c2.message.mentionType, null !== (o2 = null !== (s3 = c2.message.mentionedUserIds) && void 0 !== s3 ? s3 : null === (a2 = c2.message.mentionedUsers) || void 0 === a2 ? void 0 : a2.map(function(e2) {
      return e2.userId;
    })) && void 0 !== o2 ? o2 : [], l.userId), c2.forceUpdateLastMessage = null !== (u2 = i2.force_update_last_message) && void 0 !== u2 && u2, c2;
  }
  return t(t2, e), t2;
}(ze);
var Er = function(n2) {
  function i2(r2) {
    var i3 = null;
    return r2.mentionType === B.USERS && (r2.mentionedUserIds ? i3 = r2.mentionedUserIds : r2.mentionedUsers && (i3 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    }))), n2.call(this, { code: "MEDI", ackRequired: true, payload: se(oe({ channel_url: r2.channelUrl, msg_id: r2.messageId, message: r2.message, data: r2.data, custom_type: r2.customType, metaarray: r2.metaArrayParams, mention_type: r2.mentionType, mentioned_user_ids: i3, mentioned_message_template: r2.mentionedMessageTemplate, apple_critical_alert_options: r2.appleCriticalAlertOptions ? Ke.payloadify(r2.appleCriticalAlertOptions) : null, poll_id: r2.pollId })) }) || this;
  }
  return t(i2, n2), i2;
}(Ge);
var Tr = function(e) {
  function i2(r2, i3, s3) {
    var a2, o2, u2, c2, l, d = this;
    (d = e.call(this, r2, "MEDI", s3) || this).message = new wt(r2, s3);
    var h = uo.of(r2).sdkState;
    return d.mentionCountChange = Ue({ mentionType: null === (a2 = s3.old_values) || void 0 === a2 ? void 0 : a2.mention_type, mentionedUserIds: null !== (u2 = null === (o2 = s3.old_values) || void 0 === o2 ? void 0 : o2.mentioned_user_ids) && void 0 !== u2 ? u2 : [] }, oe({ mentionType: d.message.mentionType, mentionedUserIds: null !== (c2 = d.message.mentionedUserIds) && void 0 !== c2 ? c2 : null === (l = d.message.mentionedUsers) || void 0 === l ? void 0 : l.map(function(e2) {
      return e2.userId;
    }) }), h.userId), d;
  }
  return t(i2, e), i2;
}(ze);
var wr = function(n2) {
  function i2(r2) {
    var i3 = null;
    return r2.mentionType === B.USERS && (r2.mentionedUserIds ? i3 = r2.mentionedUserIds : r2.mentionedUsers && (i3 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    }))), n2.call(this, { code: "FEDI", ackRequired: true, payload: se(oe({ channel_url: r2.channelUrl, msg_id: r2.messageId, data: r2.data, custom_type: r2.customType, metaarray: r2.metaArrayParams, mention_type: r2.mentionType, mentioned_user_ids: i3, apple_critical_alert_options: r2.appleCriticalAlertOptions })) }) || this;
  }
  return t(i2, n2), i2;
}(Ge);
var Mr = function(e) {
  function i2(r2, i3, s3) {
    var a2, o2, u2, c2, l, d = this;
    (d = e.call(this, r2, "FEDI", s3) || this).message = new Nt(r2, s3);
    var h = uo.of(r2).sdkState;
    return d.mentionCountChange = Ue({ mentionType: null === (a2 = s3.old_values) || void 0 === a2 ? void 0 : a2.mention_type, mentionedUserIds: null !== (u2 = null === (o2 = s3.old_values) || void 0 === o2 ? void 0 : o2.mentioned_user_ids) && void 0 !== u2 ? u2 : [] }, oe({ mentionType: d.message.mentionType, mentionedUserIds: null !== (c2 = d.message.mentionedUserIds) && void 0 !== c2 ? c2 : null === (l = d.message.mentionedUsers) || void 0 === l ? void 0 : l.map(function(e2) {
      return e2.userId;
    }) }), h.userId), d;
  }
  return t(i2, e), i2;
}(ze);
var Sr = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.reactionKey, o2 = e.call(this) || this;
    return o2.method = ae.POST, o2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/reactions"), o2.params = { reaction: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
var Ur = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.reactionEvent = new Fe2(n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Ar = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.reactionKey, o2 = e.call(this) || this;
    return o2.method = ae.DELETE, o2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/reactions"), o2.params = { reaction: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
var Nr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.reactionEvent = new Fe2(n({}, n2)), r2;
  }
  return t(t2, e), t2;
}(qe);
var Cr = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = t3.translationTargetLanguages, o2 = e.call(this) || this;
    return o2.method = ae.POST, o2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(encodeURIComponent(s3), "/translation"), o2.params = { target_langs: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
var Or = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.message = new wt(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var kr2 = function(n2) {
  function s3(r2) {
    var s4, a2 = this;
    a2 = n2.call(this) || this;
    var o2 = [];
    r2.mentionType === B.USERS && (r2.mentionedUserIds ? o2 = r2.mentionedUserIds : r2.mentionedUsers && (o2 = r2.mentionedUsers.map(function(e) {
      return e.userId;
    })));
    var u2 = r2.channelType, c2 = r2.channelUrl;
    return a2.method = ae.POST, a2.path = "".concat(Re(u2), "/").concat(encodeURIComponent(c2), "/scheduled_messages"), a2.params = se(oe({ req_id: r2.reqId, scheduled_at: r2.scheduledAt, message_type: K.USER, message: r2.message, custom_type: r2.customType, data: r2.data, mention_type: r2.mentionType, mentioned_user_ids: o2, sorted_metaarray: null === (s4 = r2.metaArrays) || void 0 === s4 ? void 0 : s4.map(function(e) {
      return Ve.payloadify(e);
    }), apple_critical_alert_options: r2.appleCriticalAlertOptions ? Ke.payloadify(r2.appleCriticalAlertOptions) : null, target_langs: r2.translationTargetLanguages, push_option: r2.pushNotificationDeliveryOption })), a2;
  }
  return t(s3, n2), s3;
}(Fe);
var Pr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.message = new wt(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Rr2 = function(e) {
  function n2(n3) {
    var r2, s3, a2 = this;
    a2 = e.call(this) || this;
    var o2 = [];
    n3.mentionType === B.USERS && (n3.mentionedUserIds ? o2 = n3.mentionedUserIds : n3.mentionedUsers && (o2 = n3.mentionedUsers.map(function(e2) {
      return e2.userId;
    })));
    var u2 = n3.channelType, c2 = n3.channelUrl;
    return a2.method = ae.POST, a2.path = "".concat(Re(u2), "/").concat(encodeURIComponent(c2), "/scheduled_messages"), a2.params = oe({ req_id: n3.reqId, scheduled_at: n3.scheduledAt, message_type: K.FILE, url: n3.fileUrl, file_name: n3.fileName, file_size: n3.fileSize, file_type: n3.mimeType, thumbnails: null === (r2 = n3._thumbnails) || void 0 === r2 ? void 0 : r2.map(function(e2) {
      return Pe.payloadify(e2);
    }), custom_type: n3.customType, data: n3.data, require_auth: n3.requireAuth, mention_type: n3.mentionType, mentioned_user_ids: o2, sorted_metaarray: null === (s3 = n3.metaArrays) || void 0 === s3 ? void 0 : s3.map(function(e2) {
      return Ve.payloadify(e2);
    }), apple_critical_alert_options: n3.appleCriticalAlertOptions ? Ke.payloadify(n3.appleCriticalAlertOptions) : null, push_option: n3.pushNotificationDeliveryOption }), a2;
  }
  return t(n2, e), n2;
}(Fe);
var xr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.message = new Nt(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Dr2 = function(e) {
  function t2(t3) {
    var n2 = t3.pollId, r2 = t3.title, s3 = t3.data, a2 = t3.allowUserSuggestion, o2 = t3.allowMultipleVotes, u2 = t3.closeAt, c2 = e.call(this) || this;
    return c2.method = ae.PUT, c2.path = "".concat(me, "/").concat(encodeURIComponent(n2)), c2.params = { title: r2, data: s3, allow_user_suggestion: a2, allow_multiple_votes: o2, close_at: u2 }, c2;
  }
  return t(t2, e), t2;
}(Fe);
var Lr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.poll = new Io(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Fr2 = function(e) {
  function t2(t3) {
    var n2 = t3.pollId, r2 = e.call(this) || this;
    return r2.method = ae.DELETE, r2.path = "".concat(me, "/").concat(encodeURIComponent(n2)), r2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var qr = function(e) {
  function t2(t3) {
    var n2 = t3.pollId, r2 = e.call(this) || this;
    return r2.method = ae.PUT, r2.path = "".concat(me, "/").concat(encodeURIComponent(n2), "/close"), r2;
  }
  return t(t2, e), t2;
}(Fe);
var zr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.poll = new Io(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Br = function(e) {
  function t2(t3) {
    var n2 = t3.channelUrl, r2 = t3.channelType, s3 = t3.pollId, a2 = t3.optionText, o2 = e.call(this) || this;
    return o2.method = ae.POST, o2.path = "".concat(me, "/").concat(encodeURIComponent(s3), "/options"), o2.params = { channel_url: n2, channel_type: r2, text: a2 }, o2;
  }
  return t(t2, e), t2;
}(Fe);
var jr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.poll = new Io(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Kr = function(e) {
  function t2(t3) {
    var n2 = t3.pollId, r2 = t3.pollOptionId, s3 = t3.optionText, a2 = e.call(this) || this;
    return a2.method = ae.PUT, a2.path = "".concat(me, "/").concat(encodeURIComponent(n2), "/options/").concat(encodeURIComponent(r2)), a2.params = { text: s3 }, a2;
  }
  return t(t2, e), t2;
}(Fe);
var Qr = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.poll = new Io(t3, n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var Gr = function(e) {
  function t2(t3) {
    var n2 = t3.pollId, r2 = t3.pollOptionId, s3 = e.call(this) || this;
    return s3.method = ae.DELETE, s3.path = "".concat(me, "/").concat(encodeURIComponent(n2), "/options/").concat(encodeURIComponent(r2)), s3;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  t(t2, e);
}(qe);
var Vr = function(t2) {
  function n2(n3) {
    var r2 = n3.reqId, i2 = n3.channelType, s3 = n3.channelUrl, a2 = n3.pollId, o2 = n3.pollOptionIds;
    return t2.call(this, { code: "VOTE", ackRequired: true, payload: se({ req_id: r2, channel_type: i2 === H.OPEN ? "open_channels" : "group_channels", channel_url: s3, poll_id: a2, option_ids: o2 }) }) || this;
  }
  return t(n2, t2), n2;
}(Ge);
var Hr = function(e) {
  function t2(t3, n2, r2) {
    var i2 = e.call(this, t3, "VOTE", r2) || this;
    return i2.event = new Do(r2), i2.channelUrl = r2.channel_url, i2.channelType = r2.channel_type, i2;
  }
  return t(t2, e), t2;
}(ze);
var Wr = 100;
var Yr = "GroupChannel";
var Jr2 = "url";
var Xr = 100;
var Zr2 = "Message";
var $r = "messageId";
var ti = "NotificationMessage";
var ni = "notificationId";
var ri = "Poll";
var ii = "pollId";
var ai = "FeedChannel";
var oi = "url";
var ui = "UserInfo";
var ci = "userId";
function li(e) {
  var n2, r2, i2;
  return null !== (n2 = e.messageParams) && void 0 !== n2 ? n2 : oe(n(n({}, e), { isReplyToChannel: false, mentionedUserIds: null !== (r2 = e.mentionedUserIds) && void 0 !== r2 ? r2 : null === (i2 = e.mentionedUsers) || void 0 === i2 ? void 0 : i2.map(function(e2) {
    return e2.userId;
  }), pushNotificationDeliveryOption: W.DEFAULT, isPinnedMessage: false, fileInfoList: e.fileInfoList.map(function(e2) {
    var t2;
    return { fileUrl: e2.plainUrl, fileName: e2.fileName, fileSize: e2.fileSize, mimeType: e2.mimeType, thumbnailSizes: null === (t2 = e2.thumbnails) || void 0 === t2 ? void 0 : t2.map(function(e3) {
      return { maxWidth: e3.width, maxHeight: e3.height };
    }), _thumbnails: e2.thumbnails, _uploadedMetaData: { requireAuth: e2._requireAuth, isUploaded: true } };
  }) }));
}
var di = n(n({}, rn), { fileInfoList: [], message: "" });
var hi = function(e) {
  return (k(e.file) || S("string", e.fileUrl)) && S("string", e.fileName, true) && S("string", e.mimeType, true) && S("number", e.fileSize, true) && (void 0 === e.thumbnailSizes || Array.isArray(e.thumbnailSizes) && e.thumbnailSizes.every(function(e2) {
    return e2.maxWidth > 0 && e2.maxHeight > 0;
  }));
};
var fi = function(e) {
  function t2() {
    var t3 = null !== e && e.apply(this, arguments) || this;
    return t3._onFileUploaded = ut, t3;
  }
  return t(t2, e), t2.prototype._triggerOnFileUploaded = function(e2, t3, n2, r2) {
    this._onFileUploaded(e2, t3, n2, r2);
  }, t2.prototype.onFileUploaded = function(e2) {
    return this._onFileUploaded = e2, this;
  }, t2.prototype.onPending = function(t3) {
    return e.prototype.onPending.call(this, t3), this;
  }, t2.prototype.onFailed = function(t3) {
    return e.prototype.onFailed.call(this, t3), this;
  }, t2.prototype.onSucceeded = function(t3) {
    return e.prototype.onSucceeded.call(this, t3), this;
  }, t2;
}(nn);
var pi = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3) || this;
    return r2.message = null, r2.message = At(t3, n2.message), r2;
  }
  return t(t2, e), t2;
}(Jr);
var mi = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.channelType, a2 = n3.channelUrl, o2 = n3.limit, u2 = n3.token, c2 = n3.includeReactions, l = n3.includeMetaArray, d = n3.includeParentMessageInfo, h = n3.includeThreadInfo, f = n3.includePollDetails;
    return (r2 = t2.call(this) || this).method = ae.GET, r2.path = "".concat(Re(s3), "/").concat(encodeURIComponent(a2), "/pinned_messages"), r2.params = se({ limit: o2, token: u2, include_reactions_summary: c2, with_sorted_meta_array: l, include_thread_info: h, include_parent_message_info: d, include_poll_details: f }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var vi = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.pinned_messages, s3 = n2.has_more, a2 = n2.next;
    return r2.pinnedMessages = i2.map(function(e2) {
      return new pi(t3, e2);
    }), r2.hasMore = s3, r2.token = a2, r2;
  }
  return t(t2, e), t2;
}(qe);
var yi = function(e) {
  function t2(t3, n2, r2, i2) {
    var s3 = e.call(this, t3, n2, r2, i2) || this;
    return s3.includeMetaArray = i2.includeMetaArray, s3.includeReactions = i2.includeReactions, s3.includeParentMessageInfo = i2.includeParentMessageInfo, s3.includeThreadInfo = i2.includeThreadInfo, s3.includePollDetails = i2.includePollDetails, s3;
  }
  return t(t2, e), t2.prototype._validate = function() {
    return e.prototype._validate.call(this) && S("boolean", this.includeMetaArray, true) && S("boolean", this.includeReactions, true) && S("boolean", this.includeParentMessageInfo, true) && S("boolean", this.includeThreadInfo, true) && S("boolean", this.includePollDetails, true);
  }, t2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, t3 = new mi(n(n({}, this), { token: this._token })), [4, e2.send(t3)]) : [3, 2] : [3, 5];
          case 1:
            return r2 = c2.sent(), i2 = r2.as(vi), s3 = i2.pinnedMessages, a2 = i2.hasMore, o2 = i2.token, this._token = o2, this._hasNext = !!a2, this._isLoading = false, [2, s3];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(ko);
var _i = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = e.call(this) || this;
    return a2.method = ae.POST, a2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/pin"), a2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var gi = function(e) {
  function t2(t3) {
    var n2 = t3.channelType, r2 = t3.channelUrl, s3 = t3.messageId, a2 = e.call(this) || this;
    return a2.method = ae.DELETE, a2.path = "".concat(Re(n2), "/").concat(encodeURIComponent(r2), "/messages/").concat(s3, "/pin"), a2;
  }
  return t(t2, e), t2;
}(Fe);
!function(e) {
  function t2(t3, n2) {
    return e.call(this, t3, n2) || this;
  }
  t(t2, e);
}(qe);
var bi;
var Ii = 2;
!function(e) {
  e.SEND = "send", e.RESEND = "resend", e.COPY = "copy";
}(bi || (bi = {}));
var Ei;
var Ti = function(i2) {
  function s3(e, t2) {
    var n2, r2, s4, a2, o2, u2, l, d = this;
    return (d = i2.call(this, e) || this)._name = "", d._createdAt = 0, d.pinnedMessageIds = [], d.channelType = H.BASE, d.coverUrl = "", d.customType = "", d.data = "", d.isFrozen = false, d.isEphemeral = false, d.creator = null, d._messageCollectionLastAccessedAt = 0, d._url = t2.channel_url, d._name = null !== (n2 = t2.name) && void 0 !== n2 ? n2 : "", d._createdAt = 1e3 * t2.created_at, d.coverUrl = null !== (r2 = t2.cover_url) && void 0 !== r2 ? r2 : "", d.customType = null !== (s4 = t2.custom_type) && void 0 !== s4 ? s4 : "", d.data = null !== (a2 = t2.data) && void 0 !== a2 ? a2 : "", d.isFrozen = null !== (o2 = t2.freeze) && void 0 !== o2 && o2, d.isEphemeral = null !== (u2 = t2.is_ephemeral) && void 0 !== u2 && u2, d.creator = t2.created_by ? new ls(d._iid, t2.created_by) : null, t2.metadata && Object.keys(t2.metadata).length > 0 && t2.ts ? (d._cachedMetaData = /* @__PURE__ */ new Map(), Object.keys(t2.metadata).forEach(function(e2) {
      d._cachedMetaData.set(e2, { value: t2.metadata[e2], isRemoved: false, updatedAt: t2.ts });
    })) : "string" == typeof t2.metadata && (d._cachedMetaData = new Map(Object.entries(JSON.parse(t2.metadata)))), d.pinnedMessageIds = null !== (l = t2.pinned_message_ids) && void 0 !== l ? l : [], d;
  }
  return t(s3, i2), Object.defineProperty(s3.prototype, "url", { get: function() {
    return this._url;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "name", { get: function() {
    return this._name;
  }, set: function(e) {
    this._name = e;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "createdAt", { get: function() {
    return this._createdAt;
  }, enumerable: false, configurable: true }), s3.prototype.toJSON = function() {
    return n(n({}, this), { url: this._url, name: this._name, createdAt: this._createdAt });
  }, s3.payloadify = function(n2) {
    return se(oe(n(n({}, i2.payloadify.call(this, n2)), { channel_url: n2.url, name: n2.name, cover_url: n2.coverUrl, custom_type: n2.customType, data: n2.data, freeze: n2.isFrozen, is_ephemeral: n2.isEphemeral, created_by: n2.creator ? ls.payloadify(n2.creator) : null, created_at: n2.createdAt / 1e3, metadata: n2.cachedMetaData, pinned_message_ids: n2.pinnedMessageIds })));
  }, s3.prototype.isGroupChannel = function() {
    return this.channelType === H.GROUP;
  }, s3.prototype.isOpenChannel = function() {
    return this.channelType === H.OPEN;
  }, s3.prototype.isFeedChannel = function() {
    return this.channelType === H.FEED;
  }, Object.defineProperty(s3.prototype, "cachedMetaData", { get: function() {
    var e = {};
    return this._cachedMetaData ? (this._cachedMetaData.forEach(function(t2, n2) {
      t2.isRemoved || (e[n2] = t2.value);
    }), e) : e;
  }, enumerable: false, configurable: true }), Object.defineProperty(s3.prototype, "messageCollectionLastAccessedAt", { get: function() {
    return this._messageCollectionLastAccessedAt;
  }, enumerable: false, configurable: true }), s3.prototype._serializeCachedMetaData = function() {
    return this._cachedMetaData ? { cachedMetaData: JSON.stringify(Object.fromEntries(this._cachedMetaData)) } : {};
  }, s3.prototype._updateMessageCollectionLastAccessedAt = function() {
    this._messageCollectionLastAccessedAt = Date.now();
  }, s3.prototype._update = function(e) {
    Object.assign(this, e);
  }, s3.prototype._upsertCachedMetaData = function(e, t2) {
    var n2 = this;
    Object.keys(e).forEach(function(r2) {
      n2._cachedMetaData || (n2._cachedMetaData = /* @__PURE__ */ new Map());
      var i3 = n2._cachedMetaData.get(r2);
      (!i3 || i3.updatedAt <= t2) && n2._cachedMetaData.set(r2, { value: e[r2], isRemoved: false, updatedAt: t2 });
    });
  }, s3.prototype._updateCachedMetaData = function(e, t2) {
    var n2 = this, r2 = false;
    return this._cachedMetaData ? this._cachedMetaData.forEach(function(i3, s4) {
      var a2;
      i3.updatedAt <= t2 && (n2._cachedMetaData.set(s4, { value: null !== (a2 = e[s4]) && void 0 !== a2 ? a2 : i3.value, isRemoved: !e[s4], updatedAt: t2 }), r2 = true);
    }) : (this._cachedMetaData = /* @__PURE__ */ new Map(), Object.keys(e).forEach(function(r3) {
      n2._cachedMetaData.set(r3, { value: e[r3], isRemoved: false, updatedAt: t2 });
    }), r2 = true), { isUpdated: r2 };
  }, s3.prototype._removeFromCachedMetaData = function(e, t2) {
    var n2 = this;
    this._cachedMetaData && e.forEach(function(e2) {
      var r2 = n2._cachedMetaData.get(e2);
      r2 && r2.updatedAt < t2 && (r2.isRemoved = true, r2.updatedAt = t2);
    });
  }, s3.prototype._clearCachedMetaData = function() {
    this._cachedMetaData && this._cachedMetaData.clear();
  }, s3.prototype._runIfHandleableWithGroupChannel = function(e) {
    this.isGroupChannel() ? e(this) : this.isFeedChannel() && e(this.groupChannel);
  }, s3.prototype._generateRequestId = function() {
    return "rq-".concat(ee());
  }, s3.prototype.isIdentical = function(e) {
    return e && this.url === e.url;
  }, s3.prototype.isEqual = function(e) {
    return w(this, e);
  }, s3.prototype.createOperatorListQuery = function(e) {
    return void 0 === e && (e = {}), new Un(this._iid, this.url, this.channelType, e);
  }, s3.prototype.createMutedUserListQuery = function(e) {
    return void 0 === e && (e = {}), new On(this._iid, this.url, this.channelType, e);
  }, s3.prototype.createBannedUserListQuery = function(e) {
    return void 0 === e && (e = {}), new Rn(this._iid, this.url, this.channelType, e);
  }, s3.prototype.createPreviousMessageListQuery = function(e) {
    return void 0 === e && (e = {}), new An(this._iid, this.url, this.channelType, e);
  }, s3.prototype.createPinnedMessageListQuery = function(e) {
    return void 0 === e && (e = {}), new yi(this._iid, this.url, this.channelType, e);
  }, s3.prototype.addOperators = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(C("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new xn({ channelUrl: this.url, channelType: this.channelType, operatorUserIds: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.removeOperators = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(C("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new Dn({ channelUrl: this.url, channelType: this.channelType, operatorUserIds: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.getMyMutedInfo = function() {
    return r(this, void 0, void 0, function() {
      var e, t2, r2, i3, s4, a2, o2, u2, c2, l, d;
      return s(this, function(h) {
        switch (h.label) {
          case 0:
            return e = uo.of(this._iid), t2 = e.sdkState, r2 = e.requestQueue, i3 = new Ln({ channelUrl: this.url, channelType: this.channelType, userId: t2.userId }), [4, r2.send(i3)];
          case 1:
            return s4 = h.sent(), a2 = s4.as(Fn), o2 = a2.isMuted, u2 = a2.startAt, c2 = a2.endAt, l = a2.remainingDuration, d = a2.description, [2, { isMuted: o2, startAt: u2, endAt: c2, remainingDuration: l, description: d }];
        }
      });
    });
  }, s3.prototype.getMetaData = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return cs(C("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new qn({ channelUrl: this.url, channelType: this.channelType, keys: e }), [4, t2.send(r2)];
          case 1:
            return i3 = u2.sent(), s4 = i3.as(zn), a2 = s4.metadata, o2 = s4.ts, this._upsertCachedMetaData(a2, o2), [2, a2];
        }
      });
    });
  }, s3.prototype.getAllMetaData = function() {
    return r(this, void 0, void 0, function() {
      var e, t2, r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new qn({ channelUrl: this.url, channelType: this.channelType, keys: [] }), [4, e.send(t2)];
          case 1:
            return r2 = o2.sent(), i3 = r2.as(zn), s4 = i3.metadata, a2 = i3.ts, this._updateCachedMetaData(s4, a2), [2, s4];
        }
      });
    });
  }, s3.prototype.createMetaData = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = new Bn({ channelUrl: this.url, channelType: this.channelType, metadata: e }), [4, t2.send(r2)];
          case 1:
            return i3 = a2.sent(), s4 = i3.as(jn).metaData, this._upsertCachedMetaData(s4, 0), [2, s4];
        }
      });
    });
  }, s3.prototype.updateMetaData = function(e, t2) {
    return void 0 === t2 && (t2 = false), r(this, void 0, void 0, function() {
      var r2, i3, s4, a2, o2, u2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return r2 = uo.of(this._iid).requestQueue, i3 = new Kn({ channelUrl: this.url, channelType: this.channelType, metadata: e, upsert: t2 }), [4, r2.send(i3)];
          case 1:
            return s4 = c2.sent(), a2 = s4.as(Qn), o2 = a2.metadata, u2 = a2.ts, this._upsertCachedMetaData(o2, u2), [2, o2];
        }
      });
    });
  }, s3.prototype.deleteMetaData = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(S("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new Vn({ channelUrl: this.url, channelType: this.channelType, key: e }), [4, t2.send(r2)];
          case 1:
            return i3 = a2.sent(), s4 = i3.as(Hn).ts, this._removeFromCachedMetaData([e], s4), [2];
        }
      });
    });
  }, s3.prototype.deleteAllMetaData = function() {
    return r(this, void 0, void 0, function() {
      var e, t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new Wn({ channelUrl: this.url, channelType: this.channelType }), [4, e.send(t2)];
          case 1:
            return r2 = s4.sent(), i3 = r2.as(Yn).ts, this._removeFromCachedMetaData(c([], a(this._cachedMetaData.keys()), false), i3), [2];
        }
      });
    });
  }, s3.prototype.getMetaCounters = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return cs(C("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new Jn({ channelUrl: this.url, channelType: this.channelType, keys: e }), [4, t2.send(r2)];
          case 1:
            return i3 = s4.sent(), [2, i3.as(Xn).metaCounter];
        }
      });
    });
  }, s3.prototype.getAllMetaCounters = function() {
    return r(this, void 0, void 0, function() {
      var e, t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new Jn({ channelUrl: this.url, channelType: this.channelType, keys: [] }), [4, e.send(t2)];
          case 1:
            return r2 = i3.sent(), [2, r2.as(Xn).metaCounter];
        }
      });
    });
  }, s3.prototype.createMetaCounters = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = new Zn({ channelUrl: this.url, channelType: this.channelType, metaCounter: e }), [4, t2.send(r2)];
          case 1:
            return i3 = s4.sent(), [2, i3.as($n).metaCounter];
        }
      });
    });
  }, s3.prototype.updateMetaCounters = function(e, t2) {
    return void 0 === t2 && (t2 = false), r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return r2 = uo.of(this._iid).requestQueue, i3 = new er({ channelUrl: this.url, channelType: this.channelType, metaCounter: e, upsert: t2 }), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(tr).metaCounter];
        }
      });
    });
  }, s3.prototype.increaseMetaCounters = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = new er({ channelUrl: this.url, channelType: this.channelType, metaCounter: e, upsert: false, mode: "increase" }), [4, t2.send(r2)];
          case 1:
            return i3 = s4.sent(), [2, i3.as(tr).metaCounter];
        }
      });
    });
  }, s3.prototype.decreaseMetaCounters = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = new er({ channelUrl: this.url, channelType: this.channelType, metaCounter: e, upsert: false, mode: "decrease" }), [4, t2.send(r2)];
          case 1:
            return i3 = s4.sent(), [2, i3.as(tr).metaCounter];
        }
      });
    });
  }, s3.prototype.deleteMetaCounter = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(S("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new rr({ channelUrl: this.url, channelType: this.channelType, key: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.deleteAllMetaCounters = function() {
    return r(this, void 0, void 0, function() {
      var e, t2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new ir({ channelUrl: this.url, channelType: this.channelType }), [4, e.send(t2)];
          case 1:
            return r2.sent(), [2];
        }
      });
    });
  }, s3.prototype.muteUser = function(e, t2, n2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(r2) {
        return [2, this.muteUserWithUserId(e.userId, t2, n2)];
      });
    });
  }, s3.prototype.muteUserWithUserId = function(e, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(S("string", e) && S("number", t2, true) && S("string", r2, true)).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new sr({ channelUrl: this.url, channelType: this.channelType, userId: e, seconds: t2, description: r2 }), [4, i3.send(s4)];
          case 1:
            return a2.sent(), [2];
        }
      });
    });
  }, s3.prototype.unmuteUser = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        return [2, this.unmuteUserWithUserId(e.userId)];
      });
    });
  }, s3.prototype.unmuteUserWithUserId = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(S("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new or({ channelUrl: this.url, channelType: this.channelType, userId: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.banUser = function(e, t2, n2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(r2) {
        return [2, this.banUserWithUserId(e.userId, t2, n2)];
      });
    });
  }, s3.prototype.banUserWithUserId = function(e, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(S("string", e) && S("number", t2, true) && S("string", r2, true)).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new cr({ channelUrl: this.url, channelType: this.channelType, userId: e, seconds: t2, description: r2 }), [4, i3.send(s4)];
          case 1:
            return a2.sent(), [2];
        }
      });
    });
  }, s3.prototype.unbanUser = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        return [2, this.unbanUserWithUserId(e.userId)];
      });
    });
  }, s3.prototype.unbanUserWithUserId = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(S("string", e)).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new dr({ channelUrl: this.url, channelType: this.channelType, userId: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.freeze = function() {
    return r(this, void 0, void 0, function() {
      var e, t2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new fr({ channelUrl: this.url, channelType: this.channelType, freezing: true }), [4, e.send(t2)];
          case 1:
            return r2.sent(), this.isFrozen = true, [2];
        }
      });
    });
  }, s3.prototype.unfreeze = function() {
    return r(this, void 0, void 0, function() {
      var e, t2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e = uo.of(this._iid).requestQueue, t2 = new fr({ channelUrl: this.url, channelType: this.channelType, freezing: false }), [4, e.send(t2)];
          case 1:
            return r2.sent(), this.isFrozen = false, [2];
        }
      });
    });
  }, s3.prototype.getMessagesByMessageId = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n2 = n(n({}, zt), t2), cs(S("number", e) && Bt(n2)).throw(b.invalidParameters), [4, la.of(this._iid).getMessagesByMessageId(this.url, this.channelType, e, n2)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, s3.prototype.getMessagesByTimestamp = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n2 = n(n({}, zt), t2), cs(S("number", e) && Bt(n2)).throw(b.invalidParameters), [4, la.of(this._iid).getMessagesByTimestamp(this.url, this.channelType, e, n2)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, s3.prototype.getMessageChangeLogsSinceTimestamp = function(e, t2) {
    return void 0 === t2 && (t2 = {}), r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n2 = n(n({}, jt), t2), cs(S("number", e) && Kt(n2)).throw(b.invalidParameters), [4, la.of(this._iid).getMessageChangelogs(this.url, this.channelType, e, n2)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, s3.prototype.getMessageChangeLogsSinceToken = function(e, t2) {
    return void 0 === t2 && (t2 = {}), r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return n2 = n(n({}, jt), t2), cs(S("string", e) && Kt(n2)).throw(b.invalidParameters), [4, la.of(this._iid).getMessageChangelogs(this.url, this.channelType, e, n2)];
          case 1:
            return [2, r2.sent()];
        }
      });
    });
  }, s3.prototype._createPendingSendableMessagePayload = function(r2, i3, s4) {
    var a2, o2 = uo.of(this._iid).sessionManager;
    return se(oe({ channel_url: this.url, channel_type: this.channelType, msg_id: 0, parent_message_id: r2.parentMessageId, data: r2.data, custom_type: r2.customType, mention_type: r2.mentionType, sorted_metaarray: r2.metaArrays ? r2.metaArrays.map(function(e) {
      return Ve.payloadify(e);
    }) : null, apple_critical_alert_options: r2.appleCriticalAlertOptions ? Ke.payloadify(r2.appleCriticalAlertOptions) : null, created_at: s4, user: o2.currentUser ? Ge2.payloadify(o2.currentUser) : null, req_id: i3, request_state: Z.PENDING, mentioned_user_ids: r2.mentionedUserIds, mentioned_users: null === (a2 = r2.mentionedUsers) || void 0 === a2 ? void 0 : a2.map(function(e) {
      return ls.payloadify(e);
    }) }));
  }, s3.prototype._createPendingUserMessage = function(t2, n2, r2) {
    var i3, s4, a2 = {};
    if (t2.translationTargetLanguages)
      try {
        for (var o2 = o(t2.translationTargetLanguages), c2 = o2.next(); !c2.done; c2 = o2.next()) {
          a2[c2.value] = "";
        }
      } catch (e) {
        i3 = { error: e };
      } finally {
        try {
          c2 && !c2.done && (s4 = o2.return) && s4.call(o2);
        } finally {
          if (i3)
            throw i3.error;
        }
      }
    var l = se(n(n({}, this._createPendingSendableMessagePayload(t2, n2, r2)), { type: G.USER, message: t2.message, translations: a2, extended_message_payload: t2.extendedMessagePayload })), d = new wt(this._iid, l);
    return d.messageParams = t2, d;
  }, s3.prototype._createPendingScheduledUserMessage = function(e, t2, n2) {
    var r2 = this._createPendingUserMessage(e, t2, n2);
    return r2.scheduledInfo = { scheduledMessageId: 0, scheduledAt: e.scheduledAt, scheduledMessageParams: e }, r2;
  }, s3.prototype._createPendingFileMessage = function(t2, n2, r2) {
    var i3, s4, a2, o2, c2, l, d, h = se(n(n({}, this._createPendingSendableMessagePayload(t2, n2, r2)), { type: G.FILE, url: t2.fileUrl, file: { name: null !== (i3 = t2.fileName) && void 0 !== i3 ? i3 : null === (s4 = t2.file) || void 0 === s4 ? void 0 : s4.name, size: null !== (a2 = t2.fileSize) && void 0 !== a2 ? a2 : null === (o2 = t2.file) || void 0 === o2 ? void 0 : o2.size, type: null !== (c2 = t2.mimeType) && void 0 !== c2 ? c2 : null === (l = t2.file) || void 0 === l ? void 0 : l.type, data: t2.data }, thumbnails: null === (d = t2._thumbnails) || void 0 === d ? void 0 : d.map(function(e) {
      return Pe.payloadify(e);
    }), message: t2.message })), f = new Nt(this._iid, h);
    return f.messageParams = t2, f;
  }, s3.prototype._createPendingMultipleFilesMessage = function(t2, n2, r2) {
    var i3 = se(n(n({}, this._createPendingSendableMessagePayload(t2, n2, r2)), { type: G.FILE, file: t2.fileInfoList.length > 0 ? { name: t2.fileInfoList[0].fileName, size: t2.fileInfoList[0].fileSize, type: t2.fileInfoList[0].mimeType, data: t2.data } : void 0, message: t2.message })), s4 = new Mt(this._iid, i3);
    return s4.messageParams = t2, s4;
  }, s3.prototype._validateFailedFileMessageHasFile = function(e, t2) {
    var n2;
    return Boolean(e.url) || k(t2) || k(null === (n2 = e.messageParams) || void 0 === n2 ? void 0 : n2.file);
  }, s3.prototype._createPendingScheduledFileMessage = function(e, t2, n2) {
    var r2 = this._createPendingFileMessage(e, t2, n2);
    return r2.scheduledInfo = { scheduledMessageId: 0, scheduledAt: e.scheduledAt, scheduledMessageParams: e }, r2;
  }, s3.prototype._markMessageAsFailed = function(e, t2, n2) {
    void 0 === n2 && (n2 = false), e.errorCode = t2.code, t2.code === u.REQUEST_CANCELED || t2.code === u.FILE_UPLOAD_CANCEL_FAILED ? e.sendingStatus = Z.CANCELED : n2 || (e.sendingStatus = Z.FAILED);
  }, s3.prototype.sendUserMessage = function(e) {
    var t2 = n(n({}, on), e);
    return cs(dn(t2)).throw(b.invalidParameters), this._sendUserMessage(t2);
  }, s3.prototype._sendUserMessage = function(e, t2, r2) {
    var i3 = this;
    void 0 === t2 && (t2 = bi.SEND);
    var s4 = uo.of(this._iid), a2 = s4.dispatcher, o2 = s4.requestQueue, c2 = null != r2 ? r2 : this._generateRequestId(), l = Date.now(), d = new nn();
    return ms(2).then(function() {
      var r3 = i3._createPendingUserMessage(e, c2, l);
      a2.dispatch(new po({ messages: [r3], source: t2 === bi.RESEND ? no.LOCAL_MESSAGE_RESEND_STARTED : no.EVENT_MESSAGE_SENT_PENDING })), kr(function() {
        return r(i3, void 0, void 0, function() {
          return s(this, function(e2) {
            return [2, d._trigger(r3)];
          });
        });
      });
      var s5 = new br(n(n({}, e), { channelUrl: i3.url, channelType: i3.channelType, reqId: c2 }));
      o2.send(s5).then(function(e2) {
        var t3 = e2.as(Ir).message;
        a2.dispatch(new po({ messages: [t3], source: no.EVENT_MESSAGE_SENT_SUCCESS })), kr(function() {
          return r(i3, void 0, void 0, function() {
            return s(this, function(e3) {
              return [2, d._trigger(t3)];
            });
          });
        });
      }).catch(function(t3) {
        if (v(t3))
          throw t3;
        ms(2).then(function() {
          var r4 = i3._createPendingUserMessage(e, c2, l), s6 = uo.of(i3._iid).cacheContext, o3 = s6.localCacheEnabled && s6.localCacheConfig.enableAutoResend && O(t3.code);
          i3._markMessageAsFailed(r4, t3, o3), a2.dispatch(new po({ messages: [r4], source: r4.sendingStatus === Z.PENDING ? no.REQUEST_RESEND_MESSAGE : no.EVENT_MESSAGE_SENT_FAILED })), kr(function() {
            return r(i3, void 0, void 0, function() {
              return s(this, function(e2) {
                return [2, d._triggerFailed(t3, r4)];
              });
            });
          });
        });
      });
    }), d;
  }, s3.prototype._autoResendUserMessage = function(e) {
    return cs(e instanceof wt && !!e.messageParams).throw(b.invalidParameters), this._sendUserMessage(e.messageParams, bi.SEND, e.reqId);
  }, s3.prototype.resendUserMessage = function(e) {
    var t2;
    return r(this, void 0, void 0, function() {
      var n2, r2;
      return s(this, function(i3) {
        return cs(e instanceof wt && !e.scheduledInfo).throw(b.invalidParameters), n2 = new rt(), r2 = null !== (t2 = e.messageParams) && void 0 !== t2 ? t2 : ln(e), this._sendUserMessage(r2, bi.RESEND, e.reqId).onFailed(function(e2) {
          return n2.reject(e2);
        }).onSucceeded(function(e2) {
          return n2.resolve(e2);
        }), [2, n2.promise];
      });
    });
  }, s3.prototype.updateUserMessage = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return r2 = n(n({}, En), t2), cs(S("number", e) && Tn(r2)).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new Er(n({ channelType: this.channelType, channelUrl: this.url, messageId: e, metaArrayParams: r2.metaArrays ? { array: r2.metaArrays, mode: "add", upsert: true } : void 0 }, r2)), [4, i3.send(s4)];
          case 1:
            return a2 = o2.sent(), [2, a2.as(Tr).message];
        }
      });
    });
  }, s3.prototype.copyUserMessage = function(e, n2) {
    var r2, i3, a2;
    return r(this, void 0, void 0, function() {
      var o2, c2;
      return s(this, function(l) {
        return cs(e instanceof s3 && n2 instanceof wt && n2.sendingStatus === Z.SUCCEEDED && this.url === n2.channelUrl && !n2.scheduledInfo).throw(b.invalidParameters), cs(!n2.poll).throw(b.notSupportedError), o2 = new rt(), c2 = null !== (r2 = n2.messageParams) && void 0 !== r2 ? r2 : oe(n(n({}, n2), { mentionType: n2.mentionType, mentionedUserIds: null !== (i3 = n2.mentionedUserIds) && void 0 !== i3 ? i3 : null === (a2 = n2.mentionedUsers) || void 0 === a2 ? void 0 : a2.map(function(e2) {
          return e2.userId;
        }), translationTargetLanguages: Object.keys(n2.translations), pushNotificationDeliveryOption: W.DEFAULT, parentMessageId: null, isReplyToChannel: false, isPinnedMessage: false })), e._sendUserMessage(c2).onSucceeded(function(e2) {
          o2.resolve(e2);
        }).onFailed(function(e2) {
          return o2.reject(e2);
        }), [2, o2.promise];
      });
    });
  }, s3.prototype.translateUserMessage = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(e instanceof wt && e.messageId > 0 && C("string", t2)).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new Cr({ channelType: this.channelType, channelUrl: this.url, messageId: e.messageId, translationTargetLanguages: t2 }), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(Or).message];
        }
      });
    });
  }, s3.prototype._createScheduledUserMessage = function(e, t2) {
    var r2 = this, i3 = uo.of(this._iid).requestQueue, s4 = Date.now(), a2 = this._generateRequestId();
    ms(2).then(function() {
      var n2 = r2._createPendingScheduledUserMessage(e, a2, s4);
      kr(function() {
        return r(r2, void 0, void 0, function() {
          return s(this, function(e2) {
            return [2, t2._trigger(n2)];
          });
        });
      });
    });
    var o2 = new kr2(n({ reqId: a2, channelType: this.channelType, channelUrl: this.url }, e));
    i3.send(o2).then(function(e2) {
      var n2 = e2.as(Pr).message;
      kr(function() {
        return r(r2, void 0, void 0, function() {
          return s(this, function(e3) {
            return [2, t2._trigger(n2)];
          });
        });
      });
    }).catch(function(n2) {
      if (v(n2))
        throw n2;
      ms(2).then(function() {
        var i4 = r2._createPendingScheduledUserMessage(e, a2, s4);
        r2._markMessageAsFailed(i4, n2), kr(function() {
          return r(r2, void 0, void 0, function() {
            return s(this, function(e2) {
              return [2, t2._triggerFailed(n2, i4)];
            });
          });
        });
      });
    });
  }, s3.prototype.sendFileMessage = function(e) {
    var t2 = n(n({}, mn), e);
    return cs(gn(t2)).throw(b.invalidParameters), this._sendFileMessage(t2);
  }, s3.prototype.sendMultipleFilesMessage = function(e) {
    var t2, r2 = n(n({}, di), e), i3 = uo.of(this._iid);
    cs(function(e2, t3) {
      return void 0 === t3 && (t3 = Zr), sn(e2) && S("string", e2.message, true) && Array.isArray(e2.fileInfoList) && e2.fileInfoList.length >= 2 && e2.fileInfoList.length <= t3 && e2.fileInfoList.every(function(e3) {
        return hi(e3);
      });
    }(r2, null === (t2 = i3.appInfo) || void 0 === t2 ? void 0 : t2.multipleFilesMessageFileCountLimit)).throw(b.invalidParameters);
    var s4 = !!e.fileInfoList.find(function(e2) {
      var t3 = i3.appInfo.uploadSizeLimit;
      return e2.file instanceof Blob && e2.file.size > t3 || e2.fileSize > t3;
    });
    return cs(!s4).throw(b.fileSizeLimitExceededError), this._sendMultipleFilesMessage(r2);
  }, s3.prototype._sendFileMessage = function(e, t2, r2) {
    var i3 = this;
    void 0 === t2 && (t2 = bi.SEND);
    var s4 = uo.of(this._iid).dispatcher, a2 = la.of(this._iid).fileMessageQueue, o2 = null != r2 ? r2 : this._generateRequestId(), u2 = Date.now(), c2 = new nn();
    return ms(2).then(function() {
      var r3 = i3._createPendingFileMessage(e, o2, u2);
      s4.dispatch(new po({ messages: [r3], source: t2 === bi.RESEND ? no.LOCAL_MESSAGE_RESEND_STARTED : no.EVENT_MESSAGE_SENT_PENDING })), kr(function() {
        return r(i3, void 0, void 0, function() {
          return s(this, function(e2) {
            return [2, c2._trigger(r3)];
          });
        });
      }), a2.request(i3, o2, e).then(function(e2) {
        s4.dispatch(new po({ messages: [e2], source: no.EVENT_MESSAGE_SENT_SUCCESS })), kr(function() {
          return r(i3, void 0, void 0, function() {
            return s(this, function(t3) {
              return [2, c2._trigger(e2)];
            });
          });
        });
      }).catch(function(t3) {
        if (v(t3))
          throw t3;
        ms(2).then(function() {
          var r4 = i3._createPendingFileMessage(e, o2, u2), a3 = uo.of(i3._iid).cacheContext, l = a3.localCacheEnabled && a3.localCacheConfig.enableAutoResend && O(t3.code);
          i3._markMessageAsFailed(r4, t3, l), s4.dispatch(new po({ messages: [r4], source: r4.sendingStatus === Z.PENDING ? no.REQUEST_RESEND_MESSAGE : t3.code === u.FILE_UPLOAD_CANCEL_FAILED ? no.LOCAL_MESSAGE_CANCELED : no.EVENT_MESSAGE_SENT_FAILED })), kr(function() {
            return r(i3, void 0, void 0, function() {
              return s(this, function(e2) {
                return [2, c2._triggerFailed(t3, r4)];
              });
            });
          });
        });
      });
    }), c2;
  }, s3.prototype._autoResendFileMessage = function(e) {
    cs(e instanceof Nt && !!e.messageParams).throw(b.invalidParameters);
    var t2 = uo.of(this._iid).logger;
    return t2.debug("autoResendFileMessage pending", e), this._sendFileMessage(e.messageParams, bi.SEND, e.reqId).onFailed(function(e2) {
      t2.debug("autoResendFileMessage failed", e2);
    }).onSucceeded(function(e2) {
      t2.debug("autoResendFileMessage success", e2);
    });
  }, s3.prototype._sendMultipleFilesMessage = function(e, t2, r2) {
    var i3 = this, s4 = uo.of(this._iid).dispatcher, a2 = la.of(this._iid).fileMessageQueue, o2 = null != r2 ? r2 : this._generateRequestId(), u2 = Date.now(), c2 = new fi();
    return ms(2).then(function() {
      var n2 = i3._createPendingMultipleFilesMessage(e, o2, u2);
      s4.dispatch(new po({ messages: [n2], source: t2 === bi.RESEND ? no.LOCAL_MESSAGE_RESEND_STARTED : no.EVENT_MESSAGE_SENT_PENDING })), kr(function() {
        return r(i3, void 0, void 0, function() {
          return s(this, function(e2) {
            return [2, c2._trigger(n2)];
          });
        });
      }), a2.request(i3, o2, e, { requestHandler: c2, isCopy: t2 === bi.COPY }).then(function(e2) {
        s4.dispatch(new po({ messages: [e2], source: no.EVENT_MESSAGE_SENT_SUCCESS })), kr(function() {
          return r(i3, void 0, void 0, function() {
            return s(this, function(t3) {
              return [2, c2._trigger(e2)];
            });
          });
        });
      }).catch(function(t3) {
        if (v(t3))
          throw t3;
        ms(2).then(function() {
          var n3 = i3._createPendingMultipleFilesMessage(e, o2, u2);
          i3._markMessageAsFailed(n3, t3), s4.dispatch(new po({ messages: [n3], source: no.EVENT_MESSAGE_SENT_FAILED })), kr(function() {
            return r(i3, void 0, void 0, function() {
              return s(this, function(e2) {
                return [2, c2._triggerFailed(t3, n3)];
              });
            });
          });
        });
      });
    }), c2;
  }, s3.prototype._createScheduledFileMessage = function(e, t2, r2, i3) {
    var s4 = this, a2 = uo.of(this._iid).requestQueue, o2 = new Rr2(n(n({ reqId: r2, channelType: this.channelType, channelUrl: this.url }, e), { fileUrl: e.fileUrl, requireAuth: e.requireAuth }));
    a2.send(o2).then(function(e2) {
      var n2 = e2.as(xr).message;
      kr(function() {
        return r(s4, void 0, void 0, function() {
          return s(this, function(e3) {
            return [2, t2._trigger(n2)];
          });
        });
      });
    }).catch(function(n2) {
      if (v(n2))
        throw n2;
      ms(2).then(function() {
        var a3 = s4._createPendingScheduledFileMessage(e, r2, i3);
        s4._markMessageAsFailed(a3, n2), kr(function() {
          return r(s4, void 0, void 0, function() {
            return s(this, function(e2) {
              return [2, t2._triggerFailed(n2, a3)];
            });
          });
        });
      });
    });
  }, s3.prototype.sendFileMessages = function(e) {
    var t2, n2;
    cs(e.every(function(e2) {
      return gn(n(n({}, mn), e2));
    })).throw(b.invalidParameters);
    var r2 = new nn();
    try {
      for (var i3 = o(e), s4 = i3.next(); !s4.done; s4 = i3.next()) {
        var a2 = s4.value;
        this.sendFileMessage(a2).onPending(function(e2) {
          return r2._trigger(e2);
        }).onFailed(function(e2, t3) {
          return r2._triggerFailed(e2, t3);
        }).onSucceeded(function(e2) {
          return r2._trigger(e2);
        });
      }
    } catch (e2) {
      t2 = { error: e2 };
    } finally {
      try {
        s4 && !s4.done && (n2 = i3.return) && n2.call(i3);
      } finally {
        if (t2)
          throw t2.error;
      }
    }
    return r2;
  }, s3.prototype.resendFileMessage = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i3;
      return s(this, function(s4) {
        return n2 = this._validateFailedFileMessageHasFile(e, t2), cs(e instanceof Nt && n2 && !e.scheduledInfo).throw(b.invalidParameters), r2 = new rt(), i3 = _n(e, t2), this._sendFileMessage(i3, bi.RESEND, e.reqId).onFailed(function(e2) {
          return r2.reject(e2);
        }).onSucceeded(function(e2) {
          return r2.resolve(e2);
        }), [2, r2.promise];
      });
    });
  }, s3.prototype.resendMessage = function(e, t2) {
    var n2, r2;
    if (cs(e instanceof _t && !e.scheduledInfo && e.isResendable).throw(b.invalidParameters), e.isUserMessage()) {
      var i3 = null !== (n2 = e.messageParams) && void 0 !== n2 ? n2 : ln(e);
      return this._sendUserMessage(i3, bi.RESEND, e.reqId);
    }
    if (e.isFileMessage()) {
      var s4 = this._validateFailedFileMessageHasFile(e, t2);
      cs(s4).throw(b.invalidParameters);
      i3 = null !== (r2 = e.messageParams) && void 0 !== r2 ? r2 : _n(e, t2);
      return this._sendFileMessage(i3, bi.RESEND, e.reqId);
    }
    if (e.isMultipleFilesMessage())
      throw b.channelTypeNotSupportedError;
  }, s3.prototype.updateFileMessage = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return r2 = n(n({}, wn), t2), cs(S("number", e) && function(e2) {
              return In(e2);
            }(r2)).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new wr(n({ channelType: this.channelType, channelUrl: this.url, messageId: e, metaArrayParams: r2.metaArrays ? { array: r2.metaArrays, mode: "add", upsert: true } : void 0 }, r2)), [4, i3.send(s4)];
          case 1:
            return a2 = o2.sent(), [2, a2.as(Mr).message];
        }
      });
    });
  }, s3.prototype.uploadFile = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4, a2, o2, u2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return t2 = uo.of(this._iid).requestQueue, r2 = ee(), (i3 = new Re2({ file: e.file, channelUrl: this.url, thumbnailSizes: e.thumbnailSizes, requestId: r2 })).uploadProgressHandler = e.progressHandler, e.uploadStartedHandler && e.uploadStartedHandler(r2), [4, t2.send(i3)];
          case 1:
            return s4 = c2.sent(), a2 = s4.as(xe2), o2 = a2.url, u2 = a2.thumbnails, [2, { requestId: r2, url: o2, thumbnails: u2 }];
        }
      });
    });
  }, s3.prototype.cancelUploadingFileMessage = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        return cs(S("string", e)).throw(b.invalidParameters), la.of(this._iid).fileMessageQueue.cancel(this, e), [2, true];
      });
    });
  }, s3.prototype.copyFileMessage = function(e, n2) {
    var r2, i3, a2;
    return r(this, void 0, void 0, function() {
      var o2, c2;
      return s(this, function(l) {
        return cs(e instanceof s3 && n2 instanceof Nt && n2.sendingStatus === Z.SUCCEEDED && this.url === n2.channelUrl && !n2.scheduledInfo).throw(b.invalidParameters), o2 = new rt(), c2 = oe(n(n({}, n2), { fileUrl: n2.url, fileName: n2.name, fileSize: n2.size, mimeType: n2.type, mentionType: n2.mentionType, mentionedUserIds: null !== (r2 = n2.mentionedUserIds) && void 0 !== r2 ? r2 : null === (i3 = n2.mentionedUsers) || void 0 === i3 ? void 0 : i3.map(function(e2) {
          return e2.userId;
        }), pushNotificationDeliveryOption: W.DEFAULT, parentMessageId: null, isReplyToChannel: false, thumbnailSizes: null === (a2 = n2.thumbnails) || void 0 === a2 ? void 0 : a2.map(function(e2) {
          return { maxWidth: e2.width, maxHeight: e2.height };
        }), requireAuth: n2.requireAuth, isPinnedMessage: false })), e._sendFileMessage(c2).onSucceeded(function(e2) {
          return o2.resolve(e2);
        }).onFailed(function(e2) {
          return o2.reject(e2);
        }), [2, o2.promise];
      });
    });
  }, s3.prototype.copyMessage = function(e, t2) {
    cs(e instanceof s3 && t2 instanceof _t && t2.sendingStatus === Z.SUCCEEDED && this.url === t2.channelUrl && !t2.scheduledInfo).throw(b.invalidParameters);
    var n2 = t2, r2 = e;
    if (n2.isUserMessage()) {
      cs(!n2.poll).throw(b.notSupportedError);
      var i3 = un(n2);
      return r2._sendUserMessage(i3);
    }
    if (n2.isFileMessage()) {
      i3 = vn(n2);
      return r2._sendFileMessage(i3);
    }
    if (t2.isMultipleFilesMessage())
      throw b.channelTypeNotSupportedError;
  }, s3.prototype.deleteMessage = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(e instanceof yt).throw(b.invalidParameters), e.messageId > 0 ? (t2 = uo.of(this._iid).requestQueue, r2 = new ot({ channelType: this.channelType, channelUrl: this.url, messageId: e.messageId, messageToken: e instanceof _t ? e._messageToken : void 0 }), [4, t2.send(r2)]) : [3, 2];
          case 1:
            i3.sent(), i3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, s3.prototype.addReaction = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(e instanceof yt && e.messageId > 0 && S("string", t2)).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new Sr({ channelType: this.channelType, channelUrl: this.url, messageId: e.messageId, reactionKey: t2 }), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(Ur).reactionEvent];
        }
      });
    });
  }, s3.prototype.deleteReaction = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(e instanceof yt && e.messageId > 0 && S("string", t2)).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new Ar({ channelType: this.channelType, channelUrl: this.url, messageId: e.messageId, reactionKey: t2 }), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(Nr).reactionEvent];
        }
      });
    });
  }, s3.prototype._updateUserMessageMetaArray = function(e, t2, r2, i3) {
    return r(this, void 0, void 0, function() {
      var s4, a2, o2, u2, c2, l;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return s4 = uo.of(this._iid), a2 = s4.dispatcher, o2 = s4.requestQueue, u2 = new Er({ channelType: this.channelType, channelUrl: this.url, messageId: e, metaArrayParams: { array: t2, mode: r2, upsert: i3 } }), [4, o2.send(u2)];
          case 1:
            return c2 = d.sent(), l = c2.as(Tr).message, a2.dispatch(new po({ messages: [l], source: no.EVENT_MESSAGE_UPDATED })), [2, l];
        }
      });
    });
  }, s3.prototype._updateFileMessageMetaArray = function(e, t2, r2, i3) {
    return r(this, void 0, void 0, function() {
      var s4, a2, o2, u2, c2, l;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return s4 = uo.of(this._iid), a2 = s4.dispatcher, o2 = s4.requestQueue, u2 = new wr({ channelType: this.channelType, channelUrl: this.url, messageId: e, metaArrayParams: { array: t2, mode: r2, upsert: i3 } }), [4, o2.send(u2)];
          case 1:
            return c2 = d.sent(), l = c2.as(Mr).message, a2.dispatch(new po({ messages: [l], source: no.EVENT_MESSAGE_UPDATED })), [2, l];
        }
      });
    });
  }, s3.prototype.createMessageMetaArrayKeys = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        return cs(e instanceof yt && e.messageId > 0 && C("string", t2)).throw(b.invalidParameters), n2 = t2.map(function(e2) {
          return new Ve({ key: e2 });
        }), e instanceof Nt ? [2, this._updateFileMessageMetaArray(e.messageId, n2, "add", true)] : [2, this._updateUserMessageMetaArray(e.messageId, n2, "add", true)];
      });
    });
  }, s3.prototype.deleteMessageMetaArrayKeys = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        return cs(e instanceof yt && e.messageId > 0 && C("string", t2)).throw(b.invalidParameters), n2 = t2.map(function(e2) {
          return new Ve({ key: e2 });
        }), e instanceof Nt ? [2, this._updateFileMessageMetaArray(e.messageId, n2, "remove", true)] : [2, this._updateUserMessageMetaArray(e.messageId, n2, "remove", true)];
      });
    });
  }, s3.prototype.addMessageMetaArrayValues = function(e, t2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        return cs(e instanceof yt && e.messageId > 0 && t2.every(function(e2) {
          return e2 instanceof Ve;
        })).throw(b.invalidParameters), e instanceof Nt ? [2, this._updateFileMessageMetaArray(e.messageId, t2, "add", true)] : [2, this._updateUserMessageMetaArray(e.messageId, t2, "add", true)];
      });
    });
  }, s3.prototype.removeMessageMetaArrayValues = function(e, t2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        return cs(e instanceof yt && e.messageId > 0 && t2.every(function(e2) {
          return e2 instanceof Ve;
        })).throw(b.invalidParameters), e instanceof Nt ? [2, this._updateFileMessageMetaArray(e.messageId, t2, "remove", true)] : [2, this._updateUserMessageMetaArray(e.messageId, t2, "remove", true)];
      });
    });
  }, s3.prototype.report = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return cs((T(yn, e) || e instanceof ro) && S("string", t2)).throw(b.invalidParameters), r2 = uo.of(this._iid), i3 = r2.sdkState, s4 = r2.requestQueue, a2 = new yr({ channelUrl: this.url, channelType: this.channelType, userId: i3.userId, category: e, description: t2 }), [4, s4.send(a2)];
          case 1:
            return o2.sent(), [2];
        }
      });
    });
  }, s3.prototype.reportUser = function(e, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return cs(e instanceof ls && (T(yn, t2) || t2 instanceof ro) && S("string", r2)).throw(b.invalidParameters), i3 = uo.of(this._iid), s4 = i3.sdkState, a2 = i3.requestQueue, o2 = new _r({ channelUrl: this.url, channelType: this.channelType, userId: s4.userId, offendingUserId: e.userId, category: t2, description: r2 }), [4, a2.send(o2)];
          case 1:
            return u2.sent(), [2];
        }
      });
    });
  }, s3.prototype.reportMessage = function(e, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return cs(e instanceof _t && (T(yn, t2) || t2 instanceof ro) && S("string", r2)).throw(b.invalidParameters), i3 = uo.of(this._iid), s4 = i3.sdkState, a2 = i3.requestQueue, o2 = new gr({ channelUrl: this.url, channelType: this.channelType, userId: s4.userId, offendingUserId: e.sender.userId, messageId: e.messageId, category: t2, description: r2, messageToken: e._messageToken }), [4, a2.send(o2)];
          case 1:
            return u2.sent(), [2];
        }
      });
    });
  }, s3.prototype.updatePoll = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return cs(S("number", e) && function(e2) {
              return S("string", e2.title, true) && Co(e2.data) && S("boolean", e2.allowUserSuggestion, true) && S("boolean", e2.allowMultipleVotes, true) && S("number", e2.closeAt, true);
            }(t2)).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new Dr2(n({ pollId: e }, t2)), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(Lr).poll];
        }
      });
    });
  }, s3.prototype.deletePoll = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return t2 = S("number", e), cs(t2).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new Fr2({ pollId: e }), [4, r2.send(i3)];
          case 1:
            return s4.sent(), [2];
        }
      });
    });
  }, s3.prototype.closePoll = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return t2 = S("number", e), cs(t2).throw(b.invalidParameters), r2 = uo.of(this._iid).requestQueue, i3 = new qr({ pollId: e }), [4, r2.send(i3)];
          case 1:
            return s4 = a2.sent(), [2, s4.as(zr).poll];
        }
      });
    });
  }, s3.prototype.addPollOption = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return r2 = S("number", e) && S("string", t2) && "" !== t2.trim(), cs(r2).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new Br({ channelUrl: this.url, channelType: this.channelType, pollId: e, optionText: t2 }), [4, i3.send(s4)];
          case 1:
            return a2 = o2.sent(), [2, a2.as(jr).poll];
        }
      });
    });
  }, s3.prototype.updatePollOption = function(e, t2, r2) {
    return r(this, void 0, void 0, function() {
      var i3, s4, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return i3 = S("number", e) && S("number", t2) && S("string", r2) && "" !== r2.trim(), cs(i3).throw(b.invalidParameters), s4 = uo.of(this._iid).requestQueue, a2 = new Kr({ pollId: e, pollOptionId: t2, optionText: r2 }), [4, s4.send(a2)];
          case 1:
            return o2 = u2.sent(), [2, o2.as(Qr).poll];
        }
      });
    });
  }, s3.prototype.deletePollOption = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return r2 = S("number", e) && S("number", t2), cs(r2).throw(b.invalidParameters), i3 = uo.of(this._iid).requestQueue, s4 = new Gr({ pollId: e, pollOptionId: t2 }), [4, i3.send(s4)];
          case 1:
            return a2.sent(), [2];
        }
      });
    });
  }, s3.prototype.votePoll = function(e, t2) {
    return r(this, void 0, void 0, function() {
      var r2, i3, s4, a2, o2, u2, c2;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return r2 = S("number", e) && C("number", t2), cs(r2).throw(b.invalidParameters), i3 = uo.of(this._iid), s4 = i3.requestQueue, a2 = i3.dispatcher, o2 = new Vr({ reqId: this._generateRequestId(), channelUrl: this.url, channelType: this.channelType, pollId: e, pollOptionIds: t2 }), [4, s4.send(o2)];
          case 1:
            return u2 = l.sent(), c2 = u2.as(Hr).event, a2.dispatch(new So({ event: c2, source: no.EVENT_POLL_VOTED })), [2, c2];
        }
      });
    });
  }, s3.prototype.getPollChangeLogsSinceTimestamp = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return cs(S("number", e)).throw(b.invalidParameters), [4, Qo.of(this._iid).getPollChangeLogs(this.url, this.channelType, e)];
          case 1:
            return [2, t2.sent()];
        }
      });
    });
  }, s3.prototype.getPollChangeLogsSinceToken = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return cs(S("string", e, true)), [4, Qo.of(this._iid).getPollChangeLogs(this.url, this.channelType, e)];
          case 1:
            return [2, t2.sent()];
        }
      });
    });
  }, s3.prototype.createPollListQuery = function(e) {
    return void 0 === e && (e = 10), new Yo(this._iid, { channelUrl: this.url, channelType: this.channelType, limit: e });
  }, s3.prototype.createPollVoterListQuery = function(e, t2, n2) {
    return void 0 === n2 && (n2 = 20), new $o(this._iid, { channelUrl: this.url, channelType: this.channelType, pollId: e, pollOptionId: t2, limit: n2 });
  }, s3.prototype.pinMessage = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(S("number", e) && e > 0).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new _i({ channelType: this.channelType, channelUrl: this.url, messageId: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3.prototype.unpinMessage = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, r2;
      return s(this, function(i3) {
        switch (i3.label) {
          case 0:
            return cs(S("number", e) && e > 0).throw(b.invalidParameters), t2 = uo.of(this._iid).requestQueue, r2 = new gi({ channelType: this.channelType, channelUrl: this.url, messageId: e }), [4, t2.send(r2)];
          case 1:
            return i3.sent(), [2];
        }
      });
    });
  }, s3;
}(Jr);
var wi = function(e) {
  function t2(t3) {
    void 0 === t3 && (t3 = {});
    var n2 = e.call(this) || this;
    return Object.keys(t3).forEach(function(e2) {
      n2.hasOwnProperty(e2) && (n2[e2] = t3[e2]);
    }), n2;
  }
  return t(t2, e), t2;
}(function() {
  this.onConnected = ut, this.onReconnectStarted = ut, this.onReconnectSucceeded = ut, this.onReconnectFailed = ut, this.onDisconnected = ut;
});
var Mi = function(e) {
  function t2(t3) {
    void 0 === t3 && (t3 = {});
    var n2 = e.call(this) || this;
    return Object.keys(t3).forEach(function(e2) {
      n2.hasOwnProperty(e2) && (n2[e2] = t3[e2]);
    }), n2;
  }
  return t(t2, e), t2;
}(function() {
  this.onSessionExpired = ut, this.onSessionTokenRequired = function(e) {
    return e(null);
  }, this.onSessionError = ut, this.onSessionRefreshed = ut, this.onSessionClosed = ut;
});
var Si = function(e) {
  function t2(t3) {
    void 0 === t3 && (t3 = {});
    var n2 = e.call(this) || this;
    return Object.keys(t3).forEach(function(e2) {
      n2.hasOwnProperty(e2) && (n2[e2] = t3[e2]);
    }), n2;
  }
  return t(t2, e), t2;
}(function() {
  this.onFriendsDiscovered = ut, this.onTotalUnreadMessageCountChanged = ut, this.onTotalUnreadMessageCountUpdated = ut;
});
var Ui = function(t2) {
  function n2(n3) {
    var r2 = n3.limit, s3 = n3.token, a2 = n3.userIdsFilter, o2 = n3.metaDataKeyFilter, u2 = n3.metaDataValuesFilter, c2 = n3.nicknameStartsWithFilter, l = t2.call(this) || this;
    return l.method = ae.GET, l.path = ue, l.params = se({ limit: r2, token: s3, user_ids: a2, metadatakey: o2, metadatavalues_in: u2, nickname_startswith: c2 }), l;
  }
  return t(n2, t2), n2;
}(Fe);
var Ai = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.users = n2.users.map(function(e2) {
      return new ls(t3, e2);
    }), r2.next = n2.next, r2;
  }
  return t(t2, e), t2;
}(qe);
var Ni = function(e) {
  function i2(t2, n2) {
    var r2, i3, s3, a2 = this;
    return (a2 = e.call(this, t2, n2) || this).userIdsFilter = null, a2.metaDataKeyFilter = null, a2.metaDataValuesFilter = null, a2.nicknameStartsWithFilter = null, a2.userIdsFilter = null !== (r2 = n2.userIdsFilter) && void 0 !== r2 ? r2 : null, a2.metaDataKeyFilter = null !== (i3 = n2.metaDataKeyFilter) && void 0 !== i3 ? i3 : null, a2.metaDataValuesFilter = null !== (s3 = n2.metaDataValuesFilter) && void 0 !== s3 ? s3 : null, a2.nicknameStartsWithFilter = n2.nicknameStartsWithFilter || null, a2;
  }
  return t(i2, e), i2.prototype._validate = function() {
    return e.prototype._validate.call(this) && C("string", this.userIdsFilter, true) && S("string", this.metaDataKeyFilter, true) && C("string", this.metaDataValuesFilter, true) && S("string", this.nicknameStartsWithFilter, true);
  }, i2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, r2, i3, s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, r2 = new Ui(oe(n(n({}, this), { token: this._token }))), [4, e2.send(r2)]) : [3, 2] : [3, 5];
          case 1:
            return i3 = c2.sent(), s3 = i3.as(Ai), a2 = s3.users, o2 = s3.next, this._token = o2, this._hasNext = !!o2, this._isLoading = false, [2, a2];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, i2;
}(Oo);
var Ci = function(t2) {
  function n2(n3) {
    var r2 = n3.userId, s3 = n3.limit, a2 = n3.token, o2 = n3.userIdsFilter, u2 = t2.call(this) || this;
    return u2.method = ae.GET, u2.path = "".concat(ue, "/").concat(r2, "/block"), u2.params = se({ limit: s3, token: a2, user_ids: o2 }), u2;
  }
  return t(n2, t2), n2;
}(Fe);
var Oi = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.users = n2.users.map(function(e2) {
      return new ls(t3, e2);
    }), r2.next = n2.next, r2;
  }
  return t(t2, e), t2;
}(qe);
var ki = function(e) {
  function i2(t2, n2) {
    var r2, i3 = this;
    return (i3 = e.call(this, t2, n2) || this).userIdsFilter = null, i3.userIdsFilter = null !== (r2 = n2.userIdsFilter) && void 0 !== r2 ? r2 : null, i3;
  }
  return t(i2, e), i2.prototype._validate = function() {
    return e.prototype._validate.call(this) && C("string", this.userIdsFilter, true);
  }, i2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, r2, i3, s3, a2, o2, c2, l;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid), r2 = e2.sdkState, i3 = e2.requestQueue, s3 = new Ci(oe(n(n({}, this), { userId: r2.userId, token: this._token }))), [4, i3.send(s3)]) : [3, 2] : [3, 5];
          case 1:
            return a2 = d.sent(), o2 = a2.as(Oi), c2 = o2.users, l = o2.next, this._token = l, this._hasNext = !!l, this._isLoading = false, [2, c2];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, i2;
}(Oo);
var Pi = function(e) {
  function t2(t3) {
    var n2 = t3.userId, r2 = t3.limit, s3 = t3.token, a2 = e.call(this) || this;
    return a2.method = ae.GET, a2.path = "".concat(ue, "/").concat(encodeURIComponent(n2), "/friends"), a2.params = { limit: r2, token: s3 }, a2;
  }
  return t(t2, e), t2;
}(Fe);
var Ri = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.hasMore = n2.has_more, r2.users = n2.users.map(function(e2) {
      return new ls(t3, e2);
    }), r2.next = n2.next, r2;
  }
  return t(t2, e), t2;
}(qe);
var xi = function(e) {
  function t2() {
    return null !== e && e.apply(this, arguments) || this;
  }
  return t(t2, e), t2.prototype._validate = function() {
    return e.prototype._validate.call(this);
  }, t2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2, o2, c2, l;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid), t3 = e2.sdkState, r2 = e2.requestQueue, i2 = new Pi(n(n({}, this), { userId: t3.userId, token: this._token })), [4, r2.send(i2)]) : [3, 2] : [3, 5];
          case 1:
            return s3 = d.sent(), a2 = s3.as(Ri), o2 = a2.users, c2 = a2.hasMore, l = a2.next, this._token = l, this._hasNext = c2, this._isLoading = false, [2, o2];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(Oo);
var Di = {};
var Li = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.itemSizeLimit, r2 = void 0 === n2 ? 1048576 : n2, i2 = e2.cacheLimit, s3 = void 0 === i2 ? 256 : i2, a2 = e2.blockHashBase, o2 = void 0 === a2 ? 2 : a2, u2 = e2.blockHashMultiplier, c2 = void 0 === u2 ? 10 : u2, l = e2.blockHashConstant, d = void 0 === l ? 11 : l, h = e2.transactionApplyDelay, f = void 0 === h ? 200 : h, p = e2.disableLogger, m = void 0 !== p && p;
    return Di[t2] || (this.itemSizeLimit = r2, this.cacheLimit = s3, this.blockHashBase = o2, this.blockHashMultiplier = c2, this.blockHashConstant = d, this.transactionApplyDelay = f, this.disableLogger = m, Di[t2] = this), Di[t2];
  }
  return e.get = function(e2) {
    return Di[e2];
  }, e;
}();
!function(e) {
  e[e.UNKNOWN_ERROR = 6e7] = "UNKNOWN_ERROR", e[e.STORE_NOT_DEFINED = 61001e3] = "STORE_NOT_DEFINED", e[e.STORE_NOT_AVAILABLE = 61001001] = "STORE_NOT_AVAILABLE", e[e.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING = 61001002] = "STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING", e[e.STORE_IS_FULL = 61001003] = "STORE_IS_FULL", e[e.STORE_NOT_INITIALIZED = 61001004] = "STORE_NOT_INITIALIZED", e[e.STORE_INVALID_KEY_TYPE = 61002e3] = "STORE_INVALID_KEY_TYPE", e[e.STORE_BROKEN_INTEGRITY = 61002001] = "STORE_BROKEN_INTEGRITY", e[e.STORE_BROKEN_BLOB = 61002002] = "STORE_BROKEN_BLOB", e[e.STORE_ENCRYPTION_INVALID = 61002003] = "STORE_ENCRYPTION_INVALID", e[e.STORE_ITEM_SIZE_LIMIT_EXCEEDED = 61017e3] = "STORE_ITEM_SIZE_LIMIT_EXCEEDED", e[e.STORE_READ_FAILED = 61017001] = "STORE_READ_FAILED", e[e.STORE_WRITE_FAILED = 61017002] = "STORE_WRITE_FAILED", e[e.DATABASE_SCHEMA_NOT_ON_UPGRADE = 62002e3] = "DATABASE_SCHEMA_NOT_ON_UPGRADE", e[e.COLLECTION_NOT_READY = 63001e3] = "COLLECTION_NOT_READY", e[e.COLLECTION_KEY_NOT_MATCH = 63002e3] = "COLLECTION_KEY_NOT_MATCH", e[e.COLLECTION_QUERY_NOT_VALID = 63002001] = "COLLECTION_QUERY_NOT_VALID", e[e.COLLECTION_KEY_NOT_FOUND = 63004e3] = "COLLECTION_KEY_NOT_FOUND", e[e.COLLECTION_KEY_NOT_GIVEN = 63004001] = "COLLECTION_KEY_NOT_GIVEN", e[e.COLLECTION_INSERT_DUPLICATE = 63009e3] = "COLLECTION_INSERT_DUPLICATE", e[e.COLLECTION_WRITE_FAILED = 63017e3] = "COLLECTION_WRITE_FAILED", e[e.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED = 63017001] = "COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED", e[e.INDEX_TABLE_IS_REQUIRED = 65001e3] = "INDEX_TABLE_IS_REQUIRED", e[e.INDEX_TYPE_NOT_MATCH = 65002e3] = "INDEX_TYPE_NOT_MATCH", e[e.COMPARE_TYPE_NOT_MATCH = 69002001] = "COMPARE_TYPE_NOT_MATCH", e[e.CIRCULAR_REFERENCE_FOUND = 69002002] = "CIRCULAR_REFERENCE_FOUND";
}(Ei || (Ei = {}));
var Fi;
var qi = function(e) {
  function t2(n2) {
    var r2 = n2.code, i2 = void 0 === r2 ? Ei.UNKNOWN_ERROR : r2, s3 = n2.message, a2 = void 0 === s3 ? "Unknown error occurred." : s3, o2 = e.call(this, a2) || this;
    return o2.code = i2, Object.setPrototypeOf(o2, t2.prototype), o2;
  }
  return t(t2, e), Object.defineProperty(t2, "storeNotDefined", { get: function() {
    return new t2({ code: Ei.STORE_NOT_DEFINED, message: "Store is not defined. Specify the store on NestDB()" });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeNotAvailable", { get: function() {
    return new t2({ code: Ei.STORE_NOT_AVAILABLE, message: "Store is not available. Check your environment settings." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeNotAvailableInPrivateBrowsing", { get: function() {
    return new t2({ code: Ei.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING, message: "Store is not available because it is in private browsing." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeIsFull", { get: function() {
    return new t2({ code: Ei.STORE_IS_FULL, message: "Store is full." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeNotInitialized", { get: function() {
    return new t2({ code: Ei.STORE_NOT_INITIALIZED, message: "Store is not initialized." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeKeyTypeIsInvalid", { get: function() {
    return new t2({ code: Ei.STORE_INVALID_KEY_TYPE, message: "Store key should be string type." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeBrokenIntegrity", { get: function() {
    return new t2({ code: Ei.STORE_BROKEN_INTEGRITY, message: "Data should be in a store but it does not. Integrity is broken." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeBrokenBlob", { get: function() {
    return new t2({ code: Ei.STORE_BROKEN_BLOB, message: "Data should be in a store but it does not. Blob data is broken." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeEncryptionInvalid", { get: function() {
    return new t2({ code: Ei.STORE_ENCRYPTION_INVALID, message: "Encryption algorithm has changed. All the store should reset." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeItemSizeExceeded", { get: function() {
    return new t2({ code: Ei.STORE_ITEM_SIZE_LIMIT_EXCEEDED, message: "The size of the item exceeds the limit that the store allows." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeReadFailed", { get: function() {
    return new t2({ code: Ei.STORE_READ_FAILED, message: "Failed to read from store." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "storeWriteFailed", { get: function() {
    return new t2({ code: Ei.STORE_WRITE_FAILED, message: "Failed to write to store." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "databaseSchemaNotOnUpgrade", { get: function() {
    return new t2({ code: Ei.DATABASE_SCHEMA_NOT_ON_UPGRADE, message: "Committing schema is not allowed when upgrade is not running." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionNotReady", { get: function() {
    return new t2({ code: Ei.COLLECTION_NOT_READY, message: "Collection is not ready due to an error during initialization." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionKeyNotMatch", { get: function() {
    return new t2({ code: Ei.COLLECTION_KEY_NOT_MATCH, message: "keyName of collection could not change." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionQueryNotValid", { get: function() {
    return new t2({ code: Ei.COLLECTION_QUERY_NOT_VALID, message: "Query parameter is not a valid format." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionInsertDuplicate", { get: function() {
    return new t2({ code: Ei.COLLECTION_INSERT_DUPLICATE, message: "The key already exists." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionKeyNotFound", { get: function() {
    return new t2({ code: Ei.COLLECTION_KEY_NOT_FOUND, message: "The key is not found." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionKeyNotGiven", { get: function() {
    return new t2({ code: Ei.COLLECTION_KEY_NOT_GIVEN, message: "The item should contain [keyName] property." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionWriteFailed", { get: function() {
    return new t2({ code: Ei.COLLECTION_WRITE_FAILED, message: "Failed to write an item." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "collectionItemSizeExceeded", { get: function() {
    return new t2({ code: Ei.COLLECTION_ITEM_SIZE_LIMIT_EXCEEDED, message: "The size of the item exceeds the limit that a collection allows." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "indexTableIsRequired", { get: function() {
    return new t2({ code: Ei.INDEX_TABLE_IS_REQUIRED, message: "Index table is required." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "indexTypesNotMatch", { get: function() {
    return new t2({ code: Ei.INDEX_TYPE_NOT_MATCH, message: "Indexed column should have primitive type." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "compareTypesNotMatch", { get: function() {
    return new t2({ code: Ei.COMPARE_TYPE_NOT_MATCH, message: "Values to compare have different types." });
  }, enumerable: false, configurable: true }), Object.defineProperty(t2, "circularReferenceFound", { get: function() {
    return new t2({ code: Ei.CIRCULAR_REFERENCE_FOUND, message: "Cannot handle circular referenced object." });
  }, enumerable: false, configurable: true }), t2;
}(Error);
!function(e) {
  e.INIT = "init", e.READY = "ready", e.CLOSED = "closed";
}(Fi || (Fi = {}));
var zi;
var Bi = function(e, t2) {
  if (void 0 === t2 && (t2 = /* @__PURE__ */ new WeakMap()), "object" == typeof e && null !== e) {
    if (t2.has(e))
      throw qi.circularReferenceFound;
    var n2;
    return t2.set(e, true), Array.isArray(e) ? n2 = e.map(function(e2) {
      return Bi(e2, t2);
    }) : e instanceof RegExp || e instanceof Date ? n2 = e : (n2 = {}, Object.keys(e).forEach(function(r2) {
      n2[r2] = Bi(e[r2], t2);
    })), t2.delete(e), n2;
  }
  return e;
};
var ji = function(e, t2) {
  if (null == t2)
    return 1;
  if (null == e)
    return -1;
  if (typeof e != typeof t2)
    throw qi.compareTypesNotMatch;
  var n2 = 0;
  switch (typeof e) {
    case "boolean":
    case "number":
      n2 = e - t2;
      break;
    case "string":
      n2 = e.localeCompare(t2);
  }
  return n2;
};
var Ki = function(e, t2) {
  for (var n2 = 0, r2 = 0; r2 < e.length; r2++)
    n2 = e.charCodeAt(r2) + (n2 << 6) + (n2 << 16) - n2;
  return (n2 >>> 0) % t2;
};
var Qi = function(e) {
  return new Promise(function(t2) {
    setTimeout(function() {
      return t2();
    }, e);
  });
};
var Gi = function(e, t2) {
  if (!t2)
    return false;
  if ("function" != typeof e) {
    for (var n2 in e) {
      if (["/and", "&&"].includes(n2)) {
        if (e[n2].some(function(e2) {
          return !Gi(e2, t2);
        }))
          return false;
      } else if (["/or", "||"].includes(n2)) {
        if (e[n2].every(function(e2) {
          return !Gi(e2, t2);
        }))
          return false;
      } else if ("/where" === n2) {
        if (!(0, e[n2])(t2))
          return false;
      } else {
        var r2 = n2;
        if ("object" == typeof e[r2]) {
          var i2 = e[r2];
          for (var s3 in i2)
            switch (s3) {
              case "/eq":
              case "=":
                if ((a2 = t2[r2]) !== (o2 = i2[s3]))
                  return false;
                break;
              case "/neq":
              case "!=":
                if ((a2 = t2[r2]) === (o2 = i2[s3]))
                  return false;
                break;
              case "/gt":
              case ">":
                var a2 = t2[r2], o2 = i2[s3];
                if (!(ji(a2, o2) > 0))
                  return false;
                break;
              case "/gte":
              case ">=":
                a2 = t2[r2], o2 = i2[s3];
                if (!(ji(a2, o2) >= 0))
                  return false;
                break;
              case "/lt":
              case "<":
                a2 = t2[r2], o2 = i2[s3];
                if (!(ji(a2, o2) < 0))
                  return false;
                break;
              case "/lte":
              case "<=":
                a2 = t2[r2], o2 = i2[s3];
                if (!(ji(a2, o2) <= 0))
                  return false;
                break;
              case "/in":
                a2 = t2[r2];
                if (!(o2 = i2[s3]).includes(a2))
                  return false;
                break;
              case "/nin":
                a2 = t2[r2];
                if ((o2 = i2[s3]).includes(a2))
                  return false;
                break;
              case "/contain":
                a2 = t2[r2], o2 = i2[s3];
                if (!a2.includes(o2))
                  return false;
                break;
              case "/regex":
                a2 = t2[r2];
                if (!(o2 = i2[s3]).test(a2))
                  return false;
                break;
              case "/where":
                a2 = t2[r2];
                if (!(0, i2[s3])(a2))
                  return false;
            }
        } else if ("function" == typeof e[r2]) {
          if (!e[r2](t2[r2]))
            return false;
        } else if (e[r2] !== t2[r2])
          return false;
      }
    }
    return true;
  }
  return e(t2);
};
var Vi = function() {
};
var Hi = function() {
  return Promise.resolve();
};
var Wi = function(e) {
  return e;
};
var Yi = function(e, t2) {
  t2();
};
!function(e) {
  e[e.FORWARD = 0] = "FORWARD", e[e.BACKWARD = 1] = "BACKWARD";
}(zi || (zi = {}));
var Ji;
var Xi;
var Zi;
var $i = function() {
  function e(e2) {
    var t2 = e2.initialPrevValue, n2 = void 0 === t2 ? null : t2, r2 = e2.initialNextValue, i2 = void 0 === r2 ? null : r2, s3 = e2.iterator, a2 = e2.map, o2 = void 0 === a2 ? Wi : a2, u2 = e2.backward, c2 = void 0 === u2 ? Hi : u2, l = e2.forward, d = void 0 === l ? Hi : l, h = e2.complete, f = void 0 === h ? Vi : h;
    this._prevValue = n2, this._nextValue = i2, this._error = null, this._map = o2, this._backward = c2, this._forward = d, this._iterator = s3, this._complete = f;
  }
  return Object.defineProperty(e.prototype, "prevValue", { get: function() {
    return this._map(this._prevValue);
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "nextValue", { get: function() {
    return this._map(this._nextValue);
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "error", { get: function() {
    return this._error;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "hasPrevious", { get: function() {
    return !!this._prevValue;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "hasNext", { get: function() {
    return !!this._nextValue;
  }, enumerable: false, configurable: true }), e.prototype.prev = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            if (!this.hasPrevious)
              return [3, 6];
            r2.label = 1;
          case 1:
            return r2.trys.push([1, 3, , 4]), e2 = this._prevValue, t2 = this, [4, this._backward()];
          case 2:
            return t2._prevValue = r2.sent() || null, this._nextValue = e2, [3, 4];
          case 3:
            return n2 = r2.sent(), this._error = n2, [3, 4];
          case 4:
            return [4, this._iterator(this)];
          case 5:
            return [2, r2.sent()];
          case 6:
            this._complete(), r2.label = 7;
          case 7:
            return [2];
        }
      });
    });
  }, e.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            if (!this.hasNext)
              return [3, 6];
            r2.label = 1;
          case 1:
            return r2.trys.push([1, 3, , 4]), e2 = this._nextValue, t2 = this, [4, this._forward()];
          case 2:
            return t2._nextValue = r2.sent() || null, this._prevValue = e2, [3, 4];
          case 3:
            return n2 = r2.sent(), this._error = n2, [3, 4];
          case 4:
            return [4, this._iterator(this)];
          case 5:
            return [2, r2.sent()];
          case 6:
            this._complete(), r2.label = 7;
          case 7:
            return [2];
        }
      });
    });
  }, e.prototype.stop = function() {
    this._prevValue = null, this._nextValue = null, this._complete();
  }, e;
}();
var es = function() {
  function e(e2) {
    var t2 = e2.condition, n2 = void 0 === t2 ? {} : t2, r2 = e2.backward, i2 = void 0 !== r2 && r2, s3 = e2.blockManager, a2 = e2.indexer;
    this.condition = n2, this.backward = i2, this._blockManager = s3, this._indexer = a2;
  }
  return e.prototype.findOptimizedStartPosition = function() {
    var e2 = this, t2 = ["=", "/eq", ">", ">=", "/gt", "/gte"], n2 = ["=", "/eq", "<", "<=", "/lt", "/lte"];
    if (this.backward) {
      var r2 = this._indexer.origin.length - 1;
      if ("function" != typeof this.condition)
        for (h = 0; h < this._indexer.fields.length; h++) {
          var i2 = this._indexer.fields[h], s3 = 1;
          if ("-" === i2[0] && (i2 = i2.slice(1), s3 = -1), this.condition[i2]) {
            if ("object" == typeof this.condition[i2]) {
              var a2 = s3 > 0 ? n2 : t2;
              for (var o2 in this.condition[i2])
                if (a2.includes(o2)) {
                  for (var u2 = r2; u2 >= 0; u2--)
                    if (s3 * ji(this._indexer.origin[u2].columnValues[h], this.condition[i2][o2]) <= 0) {
                      r2 = u2;
                      break;
                    }
                }
            } else
              for (u2 = r2; u2 >= 0; u2--)
                if (s3 * ji(this._indexer.origin[u2].columnValues[h], this.condition[i2]) <= 0) {
                  r2 = u2;
                  break;
                }
          }
        }
      return Math.min(r2 + 1, this._indexer.origin.length - 1);
    }
    var c2 = 0;
    if ("function" != typeof this.condition)
      for (var l = function(r3) {
        var i3 = d._indexer.fields[r3], s4 = 1;
        if ("-" === i3[0] && (i3 = i3.slice(1), s4 = -1), d.condition[i3]) {
          if ("object" == typeof d.condition[i3])
            Object.keys(d.condition[i3]).forEach(function(a4) {
              if ((s4 > 0 ? t2 : n2).includes(a4)) {
                for (var o3 = c2; o3 < e2._indexer.origin.length; o3++)
                  if (s4 * ji(e2._indexer.origin[o3].columnValues[r3], e2.condition[i3][a4]) >= 0) {
                    c2 = o3;
                    break;
                  }
              }
            });
          else
            for (var a3 = c2; a3 < d._indexer.origin.length; a3++)
              if (s4 * ji(d._indexer.origin[a3].columnValues[r3], d.condition[i3]) >= 0) {
                c2 = a3;
                break;
              }
        }
      }, d = this, h = 0; h < this._indexer.fields.length; h++)
        l(h);
    return Math.max(c2 - 1, 0);
  }, e.prototype.each = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2 = this;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            if (t2 = this.findOptimizedStartPosition(), n2 = 0, this.backward && this._indexer.origin[t2] && (n2 = this._indexer.origin[t2].keys.length - 1), r2 = function() {
              if (u2._indexer.origin[t2]) {
                if (!u2._indexer.origin[t2].keys[++n2]) {
                  if (!u2._indexer.origin[++t2])
                    return false;
                  n2 = 0;
                }
                return true;
              }
              return false;
            }, i2 = function() {
              if (u2._indexer.origin[t2]) {
                if (!u2._indexer.origin[t2].keys[--n2]) {
                  if (!u2._indexer.origin[--t2])
                    return false;
                  n2 = u2._indexer.origin[t2].keys.length - 1;
                }
                return true;
              }
              return false;
            }, s3 = null, !this._indexer.origin[t2])
              return [3, 4];
            a2 = this.backward ? i2 : r2, c2.label = 1;
          case 1:
            return [4, this._blockManager.getFromBlock(this._indexer.origin[t2].keys[n2])];
          case 2:
            if ((o2 = c2.sent()) && Gi(this.condition, o2))
              return s3 = o2, [3, 4];
            c2.label = 3;
          case 3:
            if (a2())
              return [3, 1];
            c2.label = 4;
          case 4:
            return [4, new Promise(function(a3) {
              var o3 = new $i({ initialNextValue: Bi(s3), iterator: e2, forward: function() {
                return r(u2, void 0, void 0, function() {
                  var e3, s4;
                  return s(this, function(a4) {
                    switch (a4.label) {
                      case 0:
                        e3 = this.backward ? i2 : r2, a4.label = 1;
                      case 1:
                        return e3() ? [4, this._blockManager.getFromBlock(this._indexer.origin[t2].keys[n2])] : [3, 3];
                      case 2:
                        return (s4 = a4.sent()) && Gi(this.condition, s4) ? [2, Bi(s4)] : [3, 1];
                      case 3:
                        return [2, null];
                    }
                  });
                });
              }, backward: function() {
                return r(u2, void 0, void 0, function() {
                  var e3, s4;
                  return s(this, function(a4) {
                    switch (a4.label) {
                      case 0:
                        e3 = this.backward ? r2 : i2, a4.label = 1;
                      case 1:
                        return e3() ? [4, this._blockManager.getFromBlock(this._indexer.origin[t2].keys[n2])] : [3, 3];
                      case 2:
                        return (s4 = a4.sent()) && Gi(this.condition, s4) ? [2, Bi(s4)] : [3, 1];
                      case 3:
                        return [2, null];
                    }
                  });
                });
              }, complete: a3 });
              e2(o3);
            })];
          case 5:
            return [2, c2.sent()];
        }
      });
    });
  }, e;
}();
var ts = function() {
  function e(e2) {
    var t2 = e2.condition, n2 = void 0 === t2 ? {} : t2, r2 = e2.backward, i2 = void 0 !== r2 && r2, s3 = e2.mutex, a2 = e2.blockManager, o2 = e2.indexer;
    this._mutex = s3, this._iterator = new es({ condition: n2, backward: i2, blockManager: a2, indexer: o2 });
  }
  return e.prototype.fetch = function(e2) {
    return void 0 === e2 && (e2 = {}), r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3 = this;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            if (t2 = Math.max(e2.offset || 0, 0), 0 === (n2 = "number" == typeof e2.limit ? e2.limit : Number.MAX_SAFE_INTEGER))
              return [2, []];
            if (n2 < 0)
              throw qi.collectionQueryNotValid;
            a2.label = 1;
          case 1:
            return a2.trys.push([1, 4, , 5]), r2 = [], [4, this._mutex.lock()];
          case 2:
            return a2.sent(), [4, this._iterator.each(function(e3) {
              return r(s3, void 0, void 0, function() {
                return s(this, function(i3) {
                  return e3.error ? e3.stop() : e3.hasNext ? 0 === t2 ? (r2.push(e3.nextValue), 0 < n2 && n2 <= r2.length ? e3.stop() : e3.next()) : (t2--, e3.next()) : e3.stop(), [2];
                });
              });
            })];
          case 3:
            return a2.sent(), this._mutex.unlock(), [2, r2];
          case 4:
            throw i2 = a2.sent(), this._mutex.unlock(), i2;
          case 5:
            return [2];
        }
      });
    });
  }, e.prototype.count = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2 = this;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return r2.trys.push([0, 3, , 4]), e2 = 0, [4, this._mutex.lock()];
          case 1:
            return r2.sent(), [4, this._iterator.each(function(t3) {
              return r(n2, void 0, void 0, function() {
                return s(this, function(n3) {
                  return t3.error ? t3.stop() : t3.hasNext ? (e2++, t3.next()) : t3.stop(), [2];
                });
              });
            })];
          case 2:
            return r2.sent(), this._mutex.unlock(), [2, e2];
          case 3:
            throw t2 = r2.sent(), this._mutex.unlock(), t2;
          case 4:
            return [2];
        }
      });
    });
  }, e;
}();
var ns = function(e) {
  return "".concat("nest", "@").concat(e);
};
var rs = function(e, t2) {
  return "".concat(ns(e), "/").concat(t2);
};
var is = function(e, t2) {
  return "".concat(rs(e, t2), ".metadata");
};
var ss = function(e, t2) {
  return "".concat(rs(e, t2), "/block.");
};
var as2 = function(e, t2) {
  return "".concat(rs(e, t2), "/blob.");
};
var os2 = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.collectionName, r2 = e2.store;
    this.dbname = t2, this.collectionName = n2, this.store = r2;
  }
  return e.prototype.get = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this.store.get(e2)];
          case 1:
            return (t2 = l.sent()) ? (n2 = t2.data, r2 = t2.type, "undefined" == typeof fetch ? [3, 4] : [4, fetch(n2)]) : [3, 5];
          case 2:
            return [4, l.sent().blob()];
          case 3:
            return [2, l.sent()];
          case 4:
            for (i2 = [], s3 = atob(n2.split(",")[1]), a2 = 0; a2 < s3.length; a2 += 512) {
              for (o2 = s3.slice(a2, a2 + 512), u2 = new Array(o2.length), c2 = 0; c2 < o2.length; c2++)
                u2[c2] = o2.charCodeAt(c2);
              i2.push(new Uint8Array(u2));
            }
            return [2, new Blob(i2, { type: r2 })];
          case 5:
            return [2, null];
        }
      });
    });
  }, e.prototype.save = function(e2, t2) {
    return void 0 === t2 && (t2 = "".concat(Date.now())), r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2 = this;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return [4, new Promise(function(n3) {
              var r3 = function(e3, t3, n4, r4) {
                return void 0 === r4 && (r4 = 0), "".concat(as2(e3, t3)).concat(n4, ".").concat(r4);
              }(a2.dbname, a2.collectionName, t2), i3 = new FileReader();
              i3.onload = function() {
                n3({ blobId: r3, data: i3.result, type: e2.type });
              }, i3.readAsDataURL(e2);
            })];
          case 1:
            return n2 = o2.sent(), r2 = n2.blobId, i2 = n2.data, s3 = n2.type, [4, this.store.set({ key: r2, value: { data: i2, type: s3 } })];
          case 2:
            return o2.sent(), [2, r2];
        }
      });
    });
  }, e.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return [4, this.store.remove(e2)];
          case 1:
            return t2.sent(), [2];
        }
      });
    });
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2 = this;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e2 = as2(this.dbname, this.collectionName), [4, this.store.getAllKeys()];
          case 1:
            return t2 = r2.sent(), [4, Promise.all(t2.filter(function(t3) {
              return t3.startsWith(e2);
            }).map(function(e3) {
              return r(n2, void 0, void 0, function() {
                return s(this, function(t3) {
                  switch (t3.label) {
                    case 0:
                      return [4, this.store.remove(e3)];
                    case 1:
                      return [2, t3.sent()];
                  }
                });
              });
            }))];
          case 2:
            return r2.sent(), [2];
        }
      });
    });
  }, e;
}();
!function(e) {
  e[e.COMMIT = 0] = "COMMIT", e[e.WRITE = 1] = "WRITE", e[e.ERROR = 2] = "ERROR";
}(Ji || (Ji = {})), function(e) {
  e.PENDING = "pending", e.PERSISTENT = "persistent", e.VOLATILE = "volatile";
}(Xi || (Xi = {})), function(e) {
  e[e.NO_CACHE = 0] = "NO_CACHE", e[e.DEFAULT = 1] = "DEFAULT", e[e.PERSISTENT = 2] = "PERSISTENT";
}(Zi || (Zi = {}));
var us;
var cs2;
var ls2 = [Xi.PENDING, Xi.VOLATILE];
var ds = {};
var hs = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.limit, r2 = void 0 === n2 ? 256 : n2;
    return ds[t2] || (this.dbname = t2, this._items = [], this._limit = r2, ds[t2] = this), ds[t2];
  }
  return e.get = function(e2) {
    return ds[e2];
  }, Object.defineProperty(e.prototype, "items", { get: function() {
    return this._items;
  }, enumerable: false, configurable: true }), e.prototype.find = function(e2, t2, n2) {
    return void 0 === n2 && (n2 = Zi.DEFAULT), r(this, void 0, void 0, function() {
      var r2, i2;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return (r2 = this.get(t2)) ? [3, 2] : [4, e2.get(t2)];
          case 1:
            return (i2 = s3.sent()) && (r2 = { key: t2, value: i2, state: n2 === Zi.PERSISTENT ? Xi.PERSISTENT : Xi.VOLATILE }, this.put(r2)), [3, 3];
          case 2:
            n2 === Zi.PERSISTENT && (r2.state = Xi.PERSISTENT), s3.label = 3;
          case 3:
            return [2, r2];
        }
      });
    });
  }, e.prototype.get = function(e2, t2) {
    void 0 === t2 && (t2 = Zi.DEFAULT);
    var n2 = this._items.map(function(e3) {
      return e3.key;
    }).indexOf(e2);
    if (n2 > -1) {
      var r2 = this._items[n2];
      return t2 === Zi.PERSISTENT && (r2.state = Xi.PERSISTENT), t2 !== Zi.NO_CACHE && this.put(r2), r2;
    }
    return null;
  }, e.prototype.put = function(e2) {
    var t2, n2;
    if (this._limit > 0) {
      var r2 = this._items.map(function(e3) {
        return e3.key;
      }).indexOf(e2.key);
      if (r2 > -1)
        ls2.includes(this._items[r2].state) && ls2.includes(e2.state) ? (this._items.splice(r2, 1), this._items.push(e2)) : (this._items[r2].state = e2.state, this._items[r2].value = e2.value);
      else {
        this._items.push(e2);
        var i2 = this._items.filter(function(e3) {
          return e3.state === Xi.VOLATILE;
        }), s3 = i2.length - this._limit;
        if (s3 > 0) {
          var a2 = [];
          try {
            for (var o2 = o(this._items), u2 = o2.next(); !u2.done; u2 = o2.next()) {
              var c2 = u2.value;
              c2.state === Xi.VOLATILE && s3 > 0 ? s3-- : a2.push(c2);
            }
          } catch (e3) {
            t2 = { error: e3 };
          } finally {
            try {
              u2 && !u2.done && (n2 = o2.return) && n2.call(o2);
            } finally {
              if (t2)
                throw t2.error;
            }
          }
          this._items = a2;
        }
      }
    }
  }, e.prototype.remove = function(e2) {
    var t2 = this._items.map(function(e3) {
      return e3.key;
    }).indexOf(e2);
    t2 > -1 && this._items.splice(t2, 1);
  }, e.prototype.clearByCondition = function(e2) {
    this._items = this._items.filter(function(t2) {
      return !e2(t2);
    });
  }, e.prototype.clearForDatabase = function(e2) {
    this.clearByCondition(function(t2) {
      return t2.key.startsWith(ns(e2));
    });
  }, e.prototype.clear = function(e2) {
    void 0 === e2 && (e2 = false), this._items = e2 ? [] : this._items.filter(function(e3) {
      return e3.state !== Xi.VOLATILE;
    });
  }, e;
}();
var fs = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.collectionName, r2 = e2.store;
    this._requests = [], this._onCommit = /* @__PURE__ */ new Map(), this._onWrite = /* @__PURE__ */ new Map(), this._onError = /* @__PURE__ */ new Map(), this.dbname = t2, this.collectionName = n2, this.metadataKey = function(e3, t3) {
      return "".concat(rs(e3, t3), "/trans.metadata");
    }(t2, n2), this.recordsetKey = function(e3, t3) {
      return "".concat(rs(e3, t3), "/trans.recordset");
    }(t2, n2), this._store = r2;
  }
  return Object.defineProperty(e.prototype, "generation", { get: function() {
    return this._metadata ? this._metadata.generation : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "requestCount", { get: function() {
    return this._requests.length;
  }, enumerable: false, configurable: true }), e.prototype._getReducedRecordset = function(e2) {
    return void 0 === e2 && (e2 = []), r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._store.get(this.recordsetKey)];
          case 1:
            return (t2 = n2.sent() || []).push.apply(t2, c([], a(e2), false)), [2, this._reduceRecordSet(t2)];
        }
      });
    });
  }, e.prototype._reduceRecordSet = function(e2) {
    for (var t2 = [], n2 = {}, r2 = e2.length - 1; r2 >= 0; r2--) {
      for (var i2 = e2[r2], s3 = [], a2 = i2.requests.length - 1; a2 >= 0; a2--) {
        var o2 = i2.requests[a2], u2 = o2.data;
        n2[u2.key] || (s3.unshift(o2), n2[u2.key] = true);
      }
      s3.length > 0 && (i2.requests = s3, t2.unshift(i2));
    }
    return t2;
  }, e.prototype._applyRecord = function(e2, t2) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, c2, l, d;
      return s(this, function(h) {
        switch (h.label) {
          case 0:
            n2 = hs.get(this.dbname), r2 = t2.generation, i2 = t2.requests, s3 = null, h.label = 1;
          case 1:
            return h.trys.push([1, 3, , 4]), [4, this._store.setMany(i2.map(function(e3) {
              return n(n({}, e3.data), { generation: r2 });
            }))];
          case 2:
            for (a2 = h.sent(), o2 = 0; o2 < i2.length; o2++)
              a2[o2] instanceof Error && (s3 || (s3 = a2[o2]), c2 = i2[o2].data, n2.put(n(n({}, c2), { state: Xi.PERSISTENT })));
            return [3, 4];
          case 3:
            return l = h.sent(), s3 = l, [3, 4];
          case 4:
            return s3 ? [3, 6] : (d = e2.filter(function(e3) {
              return e3.generation !== r2;
            }), [4, this._store.set({ key: this.recordsetKey, value: d })]);
          case 5:
            return h.sent(), this._onWrite.forEach(function(e3) {
              e3(i2.map(function(e4) {
                return e4.data;
              }));
            }), [3, 7];
          case 6:
            this._onError.forEach(function(e3) {
              s3 && e3(s3);
            }), h.label = 7;
          case 7:
            return [2];
        }
      });
    });
  }, e.prototype.init = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2, s3, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return e2 = this, [4, this._store.get(this.metadataKey)];
          case 1:
            return e2._metadata = u2.sent() || { generation: 1 }, [4, this._getReducedRecordset()];
          case 2:
            t2 = u2.sent(), u2.label = 3;
          case 3:
            u2.trys.push([3, 8, 9, 10]), n2 = o(t2), r2 = n2.next(), u2.label = 4;
          case 4:
            return r2.done ? [3, 7] : (i2 = r2.value, [4, this._applyRecord(t2, i2)]);
          case 5:
            u2.sent(), u2.label = 6;
          case 6:
            return r2 = n2.next(), [3, 4];
          case 7:
            return [3, 10];
          case 8:
            return s3 = u2.sent(), a2 = { error: s3 }, [3, 10];
          case 9:
            try {
              r2 && !r2.done && (o2 = n2.return) && o2.call(n2);
            } finally {
              if (a2)
                throw a2.error;
            }
            return [7];
          case 10:
            return [2];
        }
      });
    });
  }, e.prototype.on = function(e2, t2, n2) {
    switch (e2) {
      case Ji.COMMIT:
        this._onCommit.set(t2, n2);
        break;
      case Ji.WRITE:
        this._onWrite.set(t2, n2);
        break;
      case Ji.ERROR:
        this._onError.set(t2, n2);
    }
  }, e.prototype.requestWrite = function(e2, t2) {
    this._requests.push({ data: e2, options: t2 }), hs.get(this.dbname).put(n({ state: Xi.PENDING }, e2));
  }, e.prototype.requestMultipleWrite = function(e2, t2) {
    var n2, r2, i2 = hs.get(this.dbname);
    try {
      for (var s3 = o(e2), a2 = s3.next(); !a2.done; a2 = s3.next()) {
        var o2 = a2.value;
        this._requests.push({ data: o2, options: t2 }), i2.put(n({ state: Xi.PENDING }, o2));
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        a2 && !a2.done && (r2 = s3.return) && r2.call(s3);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        return hs.get(this.dbname).clearByCondition(function(e3) {
          return e3.state === Xi.PENDING;
        }), this._requests = [], [2];
      });
    });
  }, e.prototype.commit = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2, s3, a2, o2, c2, l, d, h, f = this;
      return s(this, function(p) {
        switch (p.label) {
          case 0:
            if (!((e2 = this._requests).length > 0))
              return [3, 4];
            for (t2 = [], n2 = {}, o2 = e2.length - 1; o2 >= 0; o2--)
              r2 = e2[o2], l = r2.data, n2[l.key] || (n2[l.key] = true, t2.unshift(r2));
            return i2 = { generation: this.generation, requests: t2 }, [4, this._getReducedRecordset([i2])];
          case 1:
            return s3 = p.sent(), [4, this._store.set({ key: this.recordsetKey, value: s3 })];
          case 2:
            return p.sent(), this._metadata.generation++, [4, this._store.set({ key: this.metadataKey, value: this._metadata })];
          case 3:
            for (p.sent(), a2 = hs.get(this.dbname), o2 = 0; o2 < t2.length; o2++)
              c2 = t2[o2], l = c2.data, d = c2.options, a2.put(n(n({}, l), { state: d && d.persistent ? Xi.PERSISTENT : Xi.VOLATILE }));
            this._requests = [], this._onCommit.forEach(function(t3) {
              t3(e2.map(function(e3) {
                return e3.data;
              }));
            }), h = Li.get(this.dbname), setTimeout(function() {
              try {
                f._applyRecord(s3, i2);
              } catch (e3) {
                f._onError.forEach(function(t3) {
                  return t3(e3);
                });
              }
            }, h.transactionApplyDelay), p.label = 4;
          case 4:
            return [2];
        }
      });
    });
  }, e;
}();
var ps = function() {
  function e(e2) {
    var t2 = e2.blockId, n2 = e2.keyName, r2 = e2.items, i2 = void 0 === r2 ? [] : r2, s3 = e2.limit;
    this.blockId = t2, this.keyName = n2, this.limit = s3, this._items = c([], a(i2), false);
  }
  return e.createFromCacheItem = function(t2) {
    return t2 ? new e(t2.value) : null;
  }, Object.defineProperty(e.prototype, "isEmpty", { get: function() {
    return 0 === this._items.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "items", { get: function() {
    return this._items;
  }, enumerable: false, configurable: true }), e.prototype.serialize = function() {
    return { blockId: this.blockId, keyName: this.keyName, limit: this.limit, items: this._items };
  }, e.prototype.getItemByKey = function(e2) {
    var t2 = this, n2 = this._items.find(function(n3) {
      var r2 = n3[t2.keyName];
      return e2 === r2;
    });
    return null != n2 ? n2 : null;
  }, e.prototype.has = function(e2) {
    var t2 = this;
    return this._items.map(function(e3) {
      return e3[t2.keyName];
    }).includes(e2);
  }, e.prototype.add = function(e2) {
    var t2 = this, n2 = this._items.map(function(e3) {
      return e3[t2.keyName];
    }).indexOf(e2[this.keyName]);
    return n2 < 0 ? this._items.length < this.limit && (this._items.push(e2), true) : (this._items[n2] = e2, true);
  }, e.prototype.remove = function(e2) {
    for (var t2 = 0; t2 < this._items.length; t2++)
      if (this._items[t2][this.keyName] === e2)
        return this._items.splice(t2, 1), true;
    return false;
  }, e.prototype.clear = function() {
    this._items = [];
  }, e;
}();
var ms2 = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.collectionName, r2 = e2.metadata, i2 = e2.hashFunction, s3 = void 0 === i2 ? Ki : i2, a2 = e2.transaction, o2 = e2.store;
    this.dbname = t2, this.collectionName = n2, this.hashFunction = s3, this.metadata = r2, this._transaction = a2, this._store = o2;
  }
  return Object.defineProperty(e.prototype, "keyName", { get: function() {
    return this.metadata.keyName;
  }, enumerable: false, configurable: true }), e.prototype.createBlockId = function(e2, t2) {
    return void 0 === t2 && (t2 = this.metadata.blockLevel), n2 = this.dbname, r2 = this.collectionName, i2 = t2, s3 = "".concat(function(e3, t3, n3) {
      var r3 = n3.base * Math.pow(n3.multiplier, t3) + n3.constant;
      return (n3.hashFunction || Ki)(e3, r3);
    }(e2, t2, { hashFunction: this.hashFunction, base: this.metadata.blockHashBase, multiplier: this.metadata.blockHashMultiplier, constant: this.metadata.blockHashConstant })), "".concat(ss(n2, r2)).concat(i2, ".").concat(s3);
    var n2, r2, i2, s3;
  }, e.prototype._findBlock = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            t2 = hs.get(this.dbname), n2 = this.metadata.blockLevel, a2.label = 1;
          case 1:
            return n2 > 0 ? (r2 = this.createBlockId(e2, n2), [4, t2.find(this._store, r2)]) : [3, 4];
          case 2:
            if ((i2 = a2.sent()) && (s3 = ps.createFromCacheItem(i2), null == s3 ? void 0 : s3.getItemByKey(e2)))
              return [2, s3];
            a2.label = 3;
          case 3:
            return n2--, [3, 1];
          case 4:
            return [2, null];
        }
      });
    });
  }, e.prototype.getFromBlock = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._findBlock(e2)];
          case 1:
            return [2, (t2 = n2.sent()) ? t2.getItemByKey(e2) : null];
        }
      });
    });
  }, e.prototype.putToBlock = function(e2, t2) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return n2 = Li.get(this.dbname), r2 = this.createBlockId(e2), i2 = Math.floor(this._store.itemSizeLimit / n2.itemSizeLimit), [4, hs.get(this.dbname).find(this._store, r2)];
          case 1:
            return s3 = o2.sent(), (null == (a2 = s3 ? ps.createFromCacheItem(s3) : new ps({ blockId: r2, keyName: this.keyName, items: [], limit: i2 })) ? void 0 : a2.add(t2)) ? (this._transaction.requestWrite({ key: a2.blockId, value: a2.serialize() }), [2, true]) : [2, false];
        }
      });
    });
  }, e.prototype.removeFromBlock = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._findBlock(e2)];
          case 1:
            return (t2 = n2.sent()) && t2.remove(e2) ? (this._transaction.requestWrite({ key: t2.blockId, value: t2.serialize() }), [2, true]) : [2, false];
        }
      });
    });
  }, e.prototype.clearAllBlocks = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return e2 = ss(this.dbname, this.collectionName), [4, this._store.getAllKeys()];
          case 1:
            return t2 = r2.sent(), n2 = t2.filter(function(t3) {
              return t3.startsWith(e2);
            }), [4, this._store.removeMany(n2)];
          case 2:
            return r2.sent(), [4, this._transaction.clear()];
          case 3:
            return r2.sent(), hs.get(this.dbname).clearByCondition(function(t3) {
              return t3.key.startsWith(e2);
            }), [2];
        }
      });
    });
  }, e;
}();
var vs = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.collectionName, r2 = e2.keyName, i2 = e2.fields, s3 = e2.transaction, a2 = e2.store, o2 = this;
    this._origin = [], this._table = [];
    var u2 = function(e3, t3, n3) {
      return "".concat(rs(e3, t3), "/index.").concat(n3);
    }(t2, n2, i2.join(">"));
    this.dbname = t2, this.collectionName = n2, this.keyName = r2, this.fields = i2, this.indexerKey = u2, this._store = a2, this._transaction = s3, this._transaction.on(Ji.COMMIT, this.indexerKey, function() {
      return o2.commit();
    }), this._transaction.on(Ji.ERROR, this.indexerKey, function() {
      return o2.abort();
    });
  }
  return e.createKey = function(e2) {
    return e2.join(">");
  }, e.parseKey = function(e2) {
    return e2.split(">");
  }, e.prototype._addItem = function(e2) {
    var t2 = e2[this.keyName], n2 = this.getColumnValues(e2), r2 = a(this.indexOf(n2), 2), i2 = r2[0];
    return r2[1] ? !this._table[i2].keys.includes(t2) && (this._table[i2].keys.push(t2), true) : (this._table.splice(i2, 0, { columnValues: n2, keys: [t2] }), true);
  }, e.prototype._removeItem = function(e2) {
    var t2 = e2[this.keyName], n2 = this.getColumnValues(e2), r2 = a(this.indexOf(n2), 2), i2 = r2[0];
    if (r2[1]) {
      var s3 = this._table[i2].keys.indexOf(t2);
      if (s3 > -1)
        return this._table[i2].keys.splice(s3, 1), 0 === this._table[i2].keys.length && this._table.splice(i2, 1), true;
    }
    return false;
  }, Object.defineProperty(e.prototype, "origin", { get: function() {
    return this._origin;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "table", { get: function() {
    return this._table;
  }, enumerable: false, configurable: true }), e.prototype.getColumnValues = function(e2) {
    var t2, n2, r2, i2, s3 = [];
    try {
      for (var a2 = o(this.fields), o2 = a2.next(); !o2.done; o2 = a2.next()) {
        var u2 = o2.value;
        if ("-" === u2[0] && (u2 = u2.slice(1)), r2 = e2[u2], i2 = void 0, i2 = typeof r2, null !== r2 && "undefined" !== i2 && "boolean" !== i2 && "number" !== i2 && "string" !== i2)
          throw qi.indexTypesNotMatch;
        s3.push(e2[u2]);
      }
    } catch (e3) {
      t2 = { error: e3 };
    } finally {
      try {
        o2 && !o2.done && (n2 = a2.return) && n2.call(a2);
      } finally {
        if (t2)
          throw t2.error;
      }
    }
    return s3;
  }, e.prototype.diff = function(e2, t2) {
    for (var n2 in this.fields) {
      var r2 = "-" === this.fields[n2][0] ? -1 : 1, i2 = ji(e2[n2], t2[n2]);
      if (0 !== i2)
        return r2 * i2;
    }
    return 0;
  }, e.prototype.indexOf = function(e2) {
    if (this._table.length > 0) {
      for (var t2 = 0, n2 = this._table.length - 1; t2 <= n2; ) {
        var r2 = Math.floor((t2 + n2) / 2), i2 = this.diff(e2, this._table[r2].columnValues);
        if (i2 > 0)
          t2 = r2 + 1;
        else {
          if (!(i2 < 0))
            return [r2, true];
          n2 = r2 - 1;
        }
      }
      return [t2, false];
    }
    return [0, false];
  }, e.prototype.ensure = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, p, m, y;
      return s(this, function(_) {
        switch (_.label) {
          case 0:
            return [4, (e2 = hs.get(this.dbname)).find(this._store, this.indexerKey, Zi.PERSISTENT)];
          case 1:
            return (t2 = _.sent()) ? [3, 11] : (n2 = ss(this.dbname, this.collectionName), [4, this._store.getAllKeys()]);
          case 2:
            r2 = _.sent(), _.label = 3;
          case 3:
            _.trys.push([3, 8, 9, 10]), i2 = o(r2), s3 = i2.next(), _.label = 4;
          case 4:
            return s3.done ? [3, 7] : (a2 = s3.value).startsWith(n2) ? [4, e2.find(this._store, a2, Zi.NO_CACHE)] : [3, 6];
          case 5:
            if (o2 = _.sent(), u2 = ps.createFromCacheItem(o2))
              try {
                for (m = void 0, c2 = o(u2.items), l = c2.next(); !l.done; l = c2.next())
                  d = l.value, this._addItem(d);
              } catch (e3) {
                m = { error: e3 };
              } finally {
                try {
                  l && !l.done && (y = c2.return) && y.call(c2);
                } finally {
                  if (m)
                    throw m.error;
                }
              }
            _.label = 6;
          case 6:
            return s3 = i2.next(), [3, 4];
          case 7:
            return [3, 10];
          case 8:
            return h = _.sent(), f = { error: h }, [3, 10];
          case 9:
            try {
              s3 && !s3.done && (p = i2.return) && p.call(i2);
            } finally {
              if (f)
                throw f.error;
            }
            return [7];
          case 10:
            return this._transaction.requestWrite({ key: this.indexerKey, value: this._table }, { persistent: true }), [3, 12];
          case 11:
            this._origin = t2.value, this._table = Bi(this._origin), _.label = 12;
          case 12:
            return [2];
        }
      });
    });
  }, e.prototype.drop = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return hs.get(this.dbname).remove(this.indexerKey), [4, this._store.remove(this.indexerKey)];
          case 1:
            return e2.sent(), [2];
        }
      });
    });
  }, e.prototype.addItem = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        return this._addItem(e2) && this._transaction.requestWrite({ key: this.indexerKey, value: this._table }, { persistent: true }), [2];
      });
    });
  }, e.prototype.removeItem = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        return this._removeItem(e2) && this._transaction.requestWrite({ key: this.indexerKey, value: this._table }, { persistent: true }), [2];
      });
    });
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        return this._table = [], this._transaction.requestWrite({ key: this.indexerKey, value: this._table }, { persistent: true }), [2];
      });
    });
  }, e.prototype.commit = function() {
    this._origin = this._table, this._table = Bi(this._origin);
  }, e.prototype.abort = function() {
    this._table = Bi(this._origin);
  }, e;
}();
var ys = function() {
  return "undefined" != typeof document && "undefined" != typeof navigator && "ReactNative" !== navigator.product;
};
var _s = function() {
  var e = (/* @__PURE__ */ new Date()).getTime();
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(t2) {
    var n2 = (e + 16 * Math.random()) % 16 | 0;
    return e = Math.floor(e / 16), ("x" === t2 ? n2 : 3 & n2 | 8).toString(16);
  });
};
!function(e) {
  e[e.PROCESSING = 0] = "PROCESSING", e[e.DONE = 1] = "DONE";
}(us || (us = {})), function(e) {
  e.NEWNODE = "newnode", e.REMOVENODE = "removenode", e.CLAIM_HOST = "claimhost", e.SYNC_HOST = "synchost", e.REQUEST_LOCK = "requestlock", e.ACQUIRE_LOCK = "acquirelock", e.RELEASE_LOCK = "releaselock";
}(cs2 || (cs2 = {}));
var gs;
var bs = {};
var Is = function() {
  function e(e2, t2) {
    void 0 === t2 && (t2 = {});
    var n2 = this;
    return this._state = us.PROCESSING, this._queue = [], this._activationQueue = [], bs[e2] && !t2.forceCreate || (this.nodeId = _s(), this.key = e2, ys() && (t2.startAsInvisible ? this.registerNode() : "visible" === document.visibilityState ? this.claimHost() : this.registerNode(), document.addEventListener("visibilitychange", function() {
      "visible" === document.visibilityState && n2.claimHost();
    }), window.addEventListener("message", function(e3) {
      var t3, r2, i2 = e3.data;
      if (null == i2 ? void 0 : i2.isNestDbMessage) {
        var s3 = i2.nodeId, a2 = i2.requestId, o2 = i2.key, u2 = i2.op, c2 = i2.data;
        if (s3 !== n2.nodeId && o2 === n2.key)
          switch (u2) {
            case cs2.NEWNODE:
              n2._sendSync();
              break;
            case cs2.CLAIM_HOST:
              n2._sendSync(), n2._hostId = s3;
              break;
            case cs2.SYNC_HOST:
              if (!n2.isInSync) {
                n2._activationTimeout && clearTimeout(n2._activationTimeout);
                var l = c2, d = l.currentItemRequestId, h = l.queue, f = function(e4) {
                  var t4 = n2._queue.findIndex(function(t5) {
                    return t5.requestId === e4.requestId;
                  });
                  t4 < 0 && n2._requestLock({ isNestDbMessage: true, nodeId: e4.nodeId, requestId: e4.requestId, key: n2.key, op: cs2.REQUEST_LOCK, ts: e4.ts });
                };
                try {
                  for (var p = o(h), m = p.next(); !m.done; m = p.next()) {
                    f(m.value);
                  }
                } catch (e4) {
                  t3 = { error: e4 };
                } finally {
                  try {
                    m && !m.done && (r2 = p.return) && r2.call(p);
                  } finally {
                    if (t3)
                      throw t3.error;
                  }
                }
                n2._currentItem = n2._queue.find(function(e4) {
                  return e4.requestId === d;
                }), n2._completeSync();
              }
              break;
            case cs2.REMOVENODE:
              n2._queue = n2._queue.filter(function(e4) {
                return e4.nodeId !== i2.nodeId;
              }), n2._currentItem && n2._currentItem.nodeId === i2.nodeId && (n2._currentItem = void 0, n2._acquire(n2._queue[0]));
              break;
            case cs2.REQUEST_LOCK:
              n2._requestLock(i2);
              break;
            case cs2.ACQUIRE_LOCK:
              var y = n2._queue.find(function(e4) {
                return e4.requestId === a2;
              });
              n2._acquire(y);
              break;
            case cs2.RELEASE_LOCK:
              n2._release(a2);
          }
      }
    }), window.addEventListener("beforeunload", function() {
      n2._send(cs2.REMOVENODE);
    })), bs[e2] = this), bs[e2];
  }
  return Object.defineProperty(e.prototype, "locked", { get: function() {
    return !!this._currentItem;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "isHost", { get: function() {
    return this._hostId === this.nodeId;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "isInSync", { get: function() {
    return this._state == us.DONE;
  }, enumerable: false, configurable: true }), e.prototype._send = function(e2, t2) {
    var n2;
    void 0 === t2 && (t2 = {});
    var r2 = { isNestDbMessage: true, nodeId: this.nodeId, requestId: null !== (n2 = null == t2 ? void 0 : t2.requestId) && void 0 !== n2 ? n2 : _s(), key: this.key, op: e2, data: t2.data, ts: Date.now() };
    return ys() && window.postMessage(r2, "*"), r2;
  }, e.prototype._acquire = function(e2) {
    e2 ? (this._currentItem = e2, this._currentItem.onAcquired && this._currentItem.onAcquired(e2.requestId)) : this._currentItem = void 0;
  }, e.prototype._release = function(e2) {
    if (this._currentItem && this._currentItem.requestId === e2) {
      var t2 = this._currentItem;
      this._currentItem = void 0, t2.nodeId === this.nodeId && this._send(cs2.RELEASE_LOCK, { requestId: t2.requestId });
      var n2 = this._queue.findIndex(function(t3) {
        return t3.requestId === e2;
      });
      n2 > -1 && this._queue.splice(n2, 1), t2.onReleased && t2.onReleased(e2);
    }
  }, e.prototype._requestLock = function(e2) {
    var t2 = this;
    return new Promise(function(n2) {
      for (var r2 = { nodeId: e2.nodeId, requestId: e2.requestId, ts: e2.ts, onAcquired: function(e3) {
        t2.isHost && t2._send(cs2.ACQUIRE_LOCK, { requestId: e3 }), n2();
      }, onReleased: function() {
        t2._acquire(t2._queue[0]);
      } }, i2 = false, s3 = 0; s3 < t2._queue.length; s3++)
        if (t2._queue[s3].ts > r2.ts) {
          t2._queue.splice(s3, 0, r2), i2 = true;
          break;
        }
      i2 || t2._queue.push(r2), t2._currentItem || t2._acquire(t2._queue[0]);
    });
  }, e.prototype._sendSync = function() {
    var e2;
    this.isHost && this._send(cs2.SYNC_HOST, { data: { currentItemRequestId: null === (e2 = this._currentItem) || void 0 === e2 ? void 0 : e2.requestId, queue: this._queue.map(function(e3) {
      return { nodeId: e3.nodeId, requestId: e3.requestId, ts: e3.ts };
    }) } });
  }, e.prototype._waitUntilSyncCompleted = function() {
    return r(this, void 0, void 0, function() {
      var e2 = this;
      return s(this, function(t2) {
        return this.isHost && !this.isInSync ? [2, new Promise(function(t3) {
          e2._activationQueue.push(t3);
        })] : [2];
      });
    });
  }, e.prototype._waitSync = function() {
    var e2 = this;
    this.isInSync || (this._activationTimeout = setTimeout(function() {
      e2._completeSync();
    }, 8));
  }, e.prototype._completeSync = function() {
    this.isInSync || (this._state = us.DONE, this._activationQueue.forEach(function(e2) {
      return e2();
    }), this._activationQueue = []);
  }, e.prototype.registerNode = function() {
    this._send(cs2.NEWNODE), this._waitSync();
  }, e.prototype.claimHost = function() {
    this._hostId = this.nodeId, this._send(cs2.CLAIM_HOST), this._waitSync();
  }, e.prototype.lock = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return [4, this._waitUntilSyncCompleted()];
          case 1:
            return t2.sent(), e2 = this._send(cs2.REQUEST_LOCK), [4, this._requestLock(e2)];
          case 2:
            return t2.sent(), [2];
        }
      });
    });
  }, e.prototype.unlock = function() {
    var e2;
    (null === (e2 = this._currentItem) || void 0 === e2 ? void 0 : e2.requestId) && this._release(this._currentItem.requestId);
  }, e;
}();
var Es = function() {
  function e(e2) {
    var t2 = e2.dbname, n2 = e2.collectionName, r2 = e2.keyName, i2 = e2.keyHash, s3 = e2.indexes, a2 = e2.store, o2 = this;
    this._state = Fi.INIT, this._indexers = [], this.dbname = t2, this.name = n2, this.keyName = r2, this.indexes = c([[r2]], a(s3.filter(function(e3) {
      return vs.createKey(e3) !== o2.keyName;
    })), false), this._keyHash = i2, this._store = a2, this._mutex = new Is(function(e3, t3) {
      return "".concat(rs(e3, t3), ".lock");
    }(t2, n2)), this._blobContainer = new os2({ dbname: t2, collectionName: n2, store: a2 }), this._transaction = new fs({ dbname: t2, collectionName: n2, store: a2 });
  }
  return e.metadataOf = function(e2, t2, n2) {
    return r(this, void 0, void 0, function() {
      var r2;
      return s(this, function(i2) {
        switch (i2.label) {
          case 0:
            return r2 = is(e2, t2), [4, n2.get(r2)];
          case 1:
            return [2, i2.sent()];
        }
      });
    });
  }, Object.defineProperty(e.prototype, "state", { get: function() {
    return this._state;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "isReady", { get: function() {
    return this._state === Fi.READY;
  }, enumerable: false, configurable: true }), e.prototype.init = function() {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, y, _ = this;
      return s(this, function(g) {
        switch (g.label) {
          case 0:
            return [4, this._mutex.lock()];
          case 1:
            g.sent(), g.label = 2;
          case 2:
            return g.trys.push([2, 9, , 10]), t2 = Li.get(this.dbname), [4, e.metadataOf(this.dbname, this.name, this._store)];
          case 3:
            return n2 = g.sent(), this._metadata = n2 || { keyName: this.keyName, blockLevel: 1, blockHashBase: t2.blockHashBase, blockHashMultiplier: t2.blockHashMultiplier, blockHashConstant: t2.blockHashConstant, indexes: this.indexes }, [4, this._transaction.init()];
          case 4:
            g.sent(), this._blockManager = new ms2({ dbname: this.dbname, collectionName: this.name, hashFunction: this._keyHash, metadata: this._metadata, transaction: this._transaction, store: this._store }), r2 = c([], a(this.indexes), false), i2 = [], s3 = r2.map(function(e2) {
              return vs.createKey(e2);
            }), a2 = n2 ? n2.indexes.map(function(e2) {
              return vs.createKey(e2);
            }) : [];
            try {
              for (o2 = o(a2), u2 = o2.next(); !u2.done; u2 = o2.next())
                c2 = u2.value, s3.includes(c2) || i2.push(vs.parseKey(c2));
            } catch (e2) {
              f = { error: e2 };
            } finally {
              try {
                u2 && !u2.done && (y = o2.return) && y.call(o2);
              } finally {
                if (f)
                  throw f.error;
              }
            }
            return (l = []).push.apply(l, c([], a(r2.map(function(e2) {
              var t3 = new vs({ dbname: _.dbname, collectionName: _.name, keyName: _.keyName, fields: e2, transaction: _._transaction, store: _._store });
              return _._indexers.push(t3), t3.ensure();
            })), false)), l.push.apply(l, c([], a(i2.map(function(e2) {
              return new vs({ dbname: _.dbname, collectionName: _.name, keyName: _.keyName, fields: e2, transaction: _._transaction, store: _._store }).drop();
            })), false)), [4, Promise.all(l)];
          case 5:
            return g.sent(), [4, this._transaction.commit()];
          case 6:
            return g.sent(), s3.sort().join(",") === a2.sort().join(",") ? [3, 8] : (d = is(this.dbname, this.name), this._metadata.indexes = r2, [4, this._store.set({ key: d, value: this._metadata })]);
          case 7:
            g.sent(), g.label = 8;
          case 8:
            return this._state = Fi.READY, this._mutex.unlock(), [3, 10];
          case 9:
            throw h = g.sent(), this._mutex.unlock(), h;
          case 10:
            return [2];
        }
      });
    });
  }, e.prototype.close = function() {
    this._state = Fi.CLOSED;
  }, e.prototype._hasPropertyOfKeyName = function(e2) {
    var t2 = e2[this.keyName];
    return "string" == typeof t2 && !!t2;
  }, e.prototype._getIndexerBy = function(e2) {
    var t2, n2;
    void 0 === e2 && (e2 = null), e2 || (e2 = [this.keyName]);
    var r2 = vs.createKey(e2);
    try {
      for (var i2 = o(this._indexers), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        if (r2 === vs.createKey(a2.fields))
          return a2;
      }
    } catch (e3) {
      t2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (n2 = i2.return) && n2.call(i2);
      } finally {
        if (t2)
          throw t2.error;
      }
    }
    throw qi.indexTableIsRequired;
  }, e.prototype._upgradeBlockLevel = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return e2 = is(this.dbname, this.name), this._metadata.blockLevel++, [4, this._store.set({ key: e2, value: this._metadata })];
          case 1:
            return t2.sent(), [2];
        }
      });
    });
  }, e.prototype._requestInsert = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return t2 = e2[this.keyName], [4, this._blockManager.getFromBlock(t2)];
          case 1:
            return o2.sent() ? [3, 13] : [4, this._blockManager.putToBlock(t2, e2)];
          case 2:
            return o2.sent() ? [3, 5] : [4, this._upgradeBlockLevel()];
          case 3:
            return o2.sent(), [4, this._blockManager.putToBlock(t2, e2)];
          case 4:
            o2.sent(), o2.label = 5;
          case 5:
            o2.trys.push([5, 10, 11, 12]), n2 = o(this._indexers), r2 = n2.next(), o2.label = 6;
          case 6:
            return r2.done ? [3, 9] : [4, r2.value.addItem(e2)];
          case 7:
            o2.sent(), o2.label = 8;
          case 8:
            return r2 = n2.next(), [3, 6];
          case 9:
            return [3, 12];
          case 10:
            return i2 = o2.sent(), s3 = { error: i2 }, [3, 12];
          case 11:
            try {
              r2 && !r2.done && (a2 = n2.return) && a2.call(n2);
            } finally {
              if (s3)
                throw s3.error;
            }
            return [7];
          case 12:
            return [3, 14];
          case 13:
            throw qi.collectionInsertDuplicate;
          case 14:
            return [2];
        }
      });
    });
  }, e.prototype._requestUpsert = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f;
      return s(this, function(p) {
        switch (p.label) {
          case 0:
            return t2 = e2[this.keyName], [4, this._blockManager.getFromBlock(t2)];
          case 1:
            return (n2 = p.sent()) ? [3, 13] : [4, this._blockManager.putToBlock(t2, e2)];
          case 2:
            return p.sent() ? [3, 5] : [4, this._upgradeBlockLevel()];
          case 3:
            return p.sent(), [4, this._blockManager.putToBlock(t2, e2)];
          case 4:
            p.sent(), p.label = 5;
          case 5:
            p.trys.push([5, 10, 11, 12]), r2 = o(this._indexers), i2 = r2.next(), p.label = 6;
          case 6:
            return i2.done ? [3, 9] : [4, (u2 = i2.value).addItem(e2)];
          case 7:
            p.sent(), p.label = 8;
          case 8:
            return i2 = r2.next(), [3, 6];
          case 9:
            return [3, 12];
          case 10:
            return s3 = p.sent(), l = { error: s3 }, [3, 12];
          case 11:
            try {
              i2 && !i2.done && (d = r2.return) && d.call(r2);
            } finally {
              if (l)
                throw l.error;
            }
            return [7];
          case 12:
            return [3, 23];
          case 13:
            return [4, this._blockManager.putToBlock(t2, e2)];
          case 14:
            p.sent(), p.label = 15;
          case 15:
            p.trys.push([15, 21, 22, 23]), a2 = o(this._indexers), o2 = a2.next(), p.label = 16;
          case 16:
            return o2.done ? [3, 20] : 0 === (u2 = o2.value).diff(u2.getColumnValues(n2), u2.getColumnValues(e2)) ? [3, 19] : [4, u2.removeItem(n2)];
          case 17:
            return p.sent(), [4, u2.addItem(e2)];
          case 18:
            p.sent(), p.label = 19;
          case 19:
            return o2 = a2.next(), [3, 16];
          case 20:
            return [3, 23];
          case 21:
            return c2 = p.sent(), h = { error: c2 }, [3, 23];
          case 22:
            try {
              o2 && !o2.done && (f = a2.return) && f.call(a2);
            } finally {
              if (h)
                throw h.error;
            }
            return [7];
          case 23:
            return [2];
        }
      });
    });
  }, e.prototype._requestUpdate = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return t2 = e2[this.keyName], [4, this._blockManager.getFromBlock(t2)];
          case 1:
            return (n2 = c2.sent()) ? [4, this._blockManager.putToBlock(t2, e2)] : [3, 11];
          case 2:
            c2.sent(), c2.label = 3;
          case 3:
            c2.trys.push([3, 9, 10, 11]), r2 = o(this._indexers), i2 = r2.next(), c2.label = 4;
          case 4:
            return i2.done ? [3, 8] : 0 === (s3 = i2.value).diff(s3.getColumnValues(n2), s3.getColumnValues(e2)) ? [3, 7] : [4, s3.removeItem(n2)];
          case 5:
            return c2.sent(), [4, s3.addItem(e2)];
          case 6:
            c2.sent(), c2.label = 7;
          case 7:
            return i2 = r2.next(), [3, 4];
          case 8:
            return [3, 11];
          case 9:
            return a2 = c2.sent(), o2 = { error: a2 }, [3, 11];
          case 10:
            try {
              i2 && !i2.done && (u2 = r2.return) && u2.call(r2);
            } finally {
              if (o2)
                throw o2.error;
            }
            return [7];
          case 11:
            return [2];
        }
      });
    });
  }, e.prototype._requestRemove = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return [4, this._blockManager.getFromBlock(e2)];
          case 1:
            return (t2 = o2.sent()) ? [4, this._blockManager.removeFromBlock(e2)] : [3, 10];
          case 2:
            o2.sent(), o2.label = 3;
          case 3:
            o2.trys.push([3, 8, 9, 10]), n2 = o(this._indexers), r2 = n2.next(), o2.label = 4;
          case 4:
            return r2.done ? [3, 7] : [4, r2.value.removeItem(t2)];
          case 5:
            o2.sent(), o2.label = 6;
          case 6:
            return r2 = n2.next(), [3, 4];
          case 7:
            return [3, 10];
          case 8:
            return i2 = o2.sent(), s3 = { error: i2 }, [3, 10];
          case 9:
            try {
              r2 && !r2.done && (a2 = n2.return) && a2.call(n2);
            } finally {
              if (s3)
                throw s3.error;
            }
            return [7];
          case 10:
            return [2];
        }
      });
    });
  }, e.prototype._requestClear = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return [4, this._blockManager.clearAllBlocks()];
          case 1:
            s3.sent(), s3.label = 2;
          case 2:
            s3.trys.push([2, 7, 8, 9]), e2 = o(this._indexers), t2 = e2.next(), s3.label = 3;
          case 3:
            return t2.done ? [3, 6] : [4, t2.value.clear()];
          case 4:
            s3.sent(), s3.label = 5;
          case 5:
            return t2 = e2.next(), [3, 3];
          case 6:
            return [3, 9];
          case 7:
            return n2 = s3.sent(), r2 = { error: n2 }, [3, 9];
          case 8:
            try {
              t2 && !t2.done && (i2 = e2.return) && i2.call(e2);
            } finally {
              if (r2)
                throw r2.error;
            }
            return [7];
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.getByKey = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 6];
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return r2.trys.push([2, 4, , 5]), [4, this._blockManager.getFromBlock(e2)];
          case 3:
            return t2 = r2.sent(), this._mutex.unlock(), [2, Bi(t2)];
          case 4:
            throw n2 = r2.sent(), this._mutex.unlock(), n2;
          case 5:
            return [3, 7];
          case 6:
            throw qi.collectionNotReady;
          case 7:
            return [2];
        }
      });
    });
  }, e.prototype.query = function(e2) {
    if (void 0 === e2 && (e2 = {}), this.isReady)
      return new ts({ condition: e2.where, mutex: this._mutex, blockManager: this._blockManager, indexer: this._getIndexerBy(e2.index), backward: !!e2.backward });
    throw qi.collectionNotReady;
  }, e.prototype.insertOne = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 8];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            if (n2.trys.push([2, 5, , 7]), !this._hasPropertyOfKeyName(e2))
              throw qi.collectionKeyNotGiven;
            return [4, this._requestInsert(Bi(e2))];
          case 3:
            return n2.sent(), [4, this._transaction.commit()];
          case 4:
            return n2.sent(), this._mutex.unlock(), [2, e2];
          case 5:
            return t2 = n2.sent(), [4, this._transaction.clear()];
          case 6:
            throw n2.sent(), this._mutex.unlock(), t2;
          case 7:
            return [3, 9];
          case 8:
            throw qi.collectionNotReady;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.insertMany = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2 = this;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 15];
          case 1:
            c2.sent(), c2.label = 2;
          case 2:
            if (c2.trys.push([2, 12, , 14]), e2.some(function(e3) {
              return !u2._hasPropertyOfKeyName(e3);
            }))
              throw qi.collectionKeyNotGiven;
            c2.label = 3;
          case 3:
            c2.trys.push([3, 8, 9, 10]), t2 = o(e2), n2 = t2.next(), c2.label = 4;
          case 4:
            return n2.done ? [3, 7] : (r2 = n2.value, [4, this._requestInsert(Bi(r2))]);
          case 5:
            c2.sent(), c2.label = 6;
          case 6:
            return n2 = t2.next(), [3, 4];
          case 7:
            return [3, 10];
          case 8:
            return i2 = c2.sent(), a2 = { error: i2 }, [3, 10];
          case 9:
            try {
              n2 && !n2.done && (o2 = t2.return) && o2.call(t2);
            } finally {
              if (a2)
                throw a2.error;
            }
            return [7];
          case 10:
            return [4, this._transaction.commit()];
          case 11:
            return c2.sent(), this._mutex.unlock(), [2, e2];
          case 12:
            return s3 = c2.sent(), [4, this._transaction.clear()];
          case 13:
            throw c2.sent(), this._mutex.unlock(), s3;
          case 14:
            return [3, 16];
          case 15:
            throw qi.collectionNotReady;
          case 16:
            return [2];
        }
      });
    });
  }, e.prototype.upsertOne = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 8];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            if (n2.trys.push([2, 5, , 7]), !this._hasPropertyOfKeyName(e2))
              throw qi.collectionKeyNotGiven;
            return [4, this._requestUpsert(Bi(e2))];
          case 3:
            return n2.sent(), [4, this._transaction.commit()];
          case 4:
            return n2.sent(), this._mutex.unlock(), [2, e2];
          case 5:
            return t2 = n2.sent(), [4, this._transaction.clear()];
          case 6:
            throw n2.sent(), this._mutex.unlock(), t2;
          case 7:
            return [3, 9];
          case 8:
            throw qi.collectionNotReady;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.upsertMany = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2 = this;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 15];
          case 1:
            c2.sent(), c2.label = 2;
          case 2:
            if (c2.trys.push([2, 12, , 14]), e2.some(function(e3) {
              return !u2._hasPropertyOfKeyName(e3);
            }))
              throw qi.collectionKeyNotGiven;
            c2.label = 3;
          case 3:
            c2.trys.push([3, 8, 9, 10]), t2 = o(e2), n2 = t2.next(), c2.label = 4;
          case 4:
            return n2.done ? [3, 7] : (r2 = n2.value, [4, this._requestUpsert(Bi(r2))]);
          case 5:
            c2.sent(), c2.label = 6;
          case 6:
            return n2 = t2.next(), [3, 4];
          case 7:
            return [3, 10];
          case 8:
            return i2 = c2.sent(), a2 = { error: i2 }, [3, 10];
          case 9:
            try {
              n2 && !n2.done && (o2 = t2.return) && o2.call(t2);
            } finally {
              if (a2)
                throw a2.error;
            }
            return [7];
          case 10:
            return [4, this._transaction.commit()];
          case 11:
            return c2.sent(), this._mutex.unlock(), [2, e2];
          case 12:
            return s3 = c2.sent(), [4, this._transaction.clear()];
          case 13:
            throw c2.sent(), this._mutex.unlock(), s3;
          case 14:
            return [3, 16];
          case 15:
            throw qi.collectionNotReady;
          case 16:
            return [2];
        }
      });
    });
  }, e.prototype.update = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 8];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            if (n2.trys.push([2, 5, , 7]), !this._hasPropertyOfKeyName(e2))
              throw qi.collectionKeyNotGiven;
            return [4, this._requestUpdate(Bi(e2))];
          case 3:
            return n2.sent(), [4, this._transaction.commit()];
          case 4:
            return n2.sent(), this._mutex.unlock(), [2, e2];
          case 5:
            return t2 = n2.sent(), [4, this._transaction.clear()];
          case 6:
            throw n2.sent(), this._mutex.unlock(), t2;
          case 7:
            return [3, 9];
          case 8:
            throw qi.collectionNotReady;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.updateIf = function(e2, t2) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, p, m, y = this;
      return s(this, function(_) {
        switch (_.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 16];
          case 1:
            _.sent(), _.label = 2;
          case 2:
            return _.trys.push([2, 13, , 15]), n2 = e2.where, r2 = void 0 === n2 ? {} : n2, i2 = e2.index, s3 = void 0 === i2 ? null : i2, a2 = e2.backward, o2 = void 0 !== a2 && a2, u2 = [], [4, new es({ condition: r2, blockManager: this._blockManager, backward: o2, indexer: this._getIndexerBy(s3) }).each(function(e3) {
              return r(y, void 0, void 0, function() {
                var n3;
                return s(this, function(i3) {
                  if (e3.error)
                    throw e3.stop(), e3.error;
                  return e3.hasNext ? (n3 = e3.nextValue, Gi(r2, n3) && t2.set && ("function" != typeof t2.set ? Object.keys(t2.set).forEach(function(e4) {
                    var r3;
                    n3[e4] = null === (r3 = t2.set) || void 0 === r3 ? void 0 : r3[e4];
                  }) : t2.set(n3), u2.push(n3)), e3.next()) : e3.stop(), [2];
                });
              });
            })];
          case 3:
            _.sent(), _.label = 4;
          case 4:
            _.trys.push([4, 9, 10, 11]), c2 = o(u2), l = c2.next(), _.label = 5;
          case 5:
            return l.done ? [3, 8] : (d = l.value, [4, this._requestUpdate(Bi(d))]);
          case 6:
            _.sent(), _.label = 7;
          case 7:
            return l = c2.next(), [3, 5];
          case 8:
            return [3, 11];
          case 9:
            return h = _.sent(), p = { error: h }, [3, 11];
          case 10:
            try {
              l && !l.done && (m = c2.return) && m.call(c2);
            } finally {
              if (p)
                throw p.error;
            }
            return [7];
          case 11:
            return [4, this._transaction.commit()];
          case 12:
            return _.sent(), this._mutex.unlock(), [2, u2];
          case 13:
            return f = _.sent(), [4, this._transaction.clear()];
          case 14:
            throw _.sent(), this._mutex.unlock(), f;
          case 15:
            return [3, 17];
          case 16:
            throw this._transaction.clear(), qi.collectionNotReady;
          case 17:
            return [2];
        }
      });
    });
  }, e.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 8];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return n2.trys.push([2, 5, , 7]), [4, this._requestRemove(e2)];
          case 3:
            return n2.sent(), [4, this._transaction.commit()];
          case 4:
            return n2.sent(), this._mutex.unlock(), [3, 7];
          case 5:
            return t2 = n2.sent(), [4, this._transaction.clear()];
          case 6:
            throw n2.sent(), this._mutex.unlock(), t2;
          case 7:
            return [3, 9];
          case 8:
            throw qi.collectionNotReady;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.removeIf = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, p, m = this;
      return s(this, function(y) {
        switch (y.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 15];
          case 1:
            y.sent(), y.label = 2;
          case 2:
            return y.trys.push([2, 13, , 14]), t2 = e2.where, n2 = void 0 === t2 ? {} : t2, r2 = e2.index, i2 = void 0 === r2 ? null : r2, s3 = e2.backward, a2 = void 0 !== s3 && s3, o2 = [], [4, new es({ condition: n2, blockManager: this._blockManager, backward: a2, indexer: this._getIndexerBy(i2) }).each(function(e3) {
              return r(m, void 0, void 0, function() {
                var t3, r3;
                return s(this, function(i3) {
                  if (e3.error)
                    throw e3.stop(), e3.error;
                  return e3.hasNext ? (t3 = e3.nextValue, Gi(n2, t3) && (r3 = t3[this.keyName], o2.push(r3)), e3.next()) : e3.stop(), [2];
                });
              });
            })];
          case 3:
            y.sent(), y.label = 4;
          case 4:
            y.trys.push([4, 9, 10, 11]), u2 = o(o2), c2 = u2.next(), y.label = 5;
          case 5:
            return c2.done ? [3, 8] : (l = c2.value, [4, this._requestRemove(l)]);
          case 6:
            y.sent(), y.label = 7;
          case 7:
            return c2 = u2.next(), [3, 5];
          case 8:
            return [3, 11];
          case 9:
            return d = y.sent(), f = { error: d }, [3, 11];
          case 10:
            try {
              c2 && !c2.done && (p = u2.return) && p.call(u2);
            } finally {
              if (f)
                throw f.error;
            }
            return [7];
          case 11:
            return [4, this._transaction.commit()];
          case 12:
            return y.sent(), this._mutex.unlock(), [2, o2];
          case 13:
            throw h = y.sent(), this._mutex.unlock(), h;
          case 14:
            return [3, 16];
          case 15:
            throw this._transaction.clear(), qi.collectionNotReady;
          case 16:
            return [2];
        }
      });
    });
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return this.isReady ? [4, this._mutex.lock()] : [3, 8];
          case 1:
            t2.sent(), t2.label = 2;
          case 2:
            return t2.trys.push([2, 5, , 7]), [4, this._requestClear()];
          case 3:
            return t2.sent(), [4, this._transaction.commit()];
          case 4:
            return t2.sent(), this._mutex.unlock(), [3, 7];
          case 5:
            return e2 = t2.sent(), [4, this._transaction.clear()];
          case 6:
            throw t2.sent(), this._mutex.unlock(), e2;
          case 7:
            return [3, 9];
          case 8:
            throw qi.collectionNotReady;
          case 9:
            return [2];
        }
      });
    });
  }, e.prototype.getBlob = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return [4, this._blobContainer.get(e2)];
          case 1:
            return [2, t2.sent()];
        }
      });
    });
  }, e.prototype.saveBlob = function(e2, t2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._blobContainer.save(e2, t2)];
          case 1:
            return [2, n2.sent()];
        }
      });
    });
  }, e.prototype.removeBlob = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return [4, this._blobContainer.remove(e2)];
          case 1:
            return t2.sent(), [2];
        }
      });
    });
  }, e.prototype.removeAllBlobs = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, this._blobContainer.clear()];
          case 1:
            return e2.sent(), [2];
        }
      });
    });
  }, e;
}();
var Ts = "[NESTDB]";
var ws = true;
var Ms = function() {
  function e() {
  }
  return e.off = function() {
    ws = false;
  }, e.log = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    ws && console.log.apply(console, c(["".concat(Ts, "[LOG]")], a(e2), false));
  }, e.warning = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    ws && console.warn.apply(console, c(["".concat(Ts, "[WARNING]")], a(e2), false));
  }, e.error = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    ws && console.error.apply(console, c(["".concat(Ts, "[ERROR]")], a(e2), false));
  }, e;
}();
var Ss = [{}, { a: 700400, n: "error" }];
var Us = function() {
  function e(e2) {
    var t2, n2, r2;
    this.encryption = null !== (t2 = e2.encryption) && void 0 !== t2 ? t2 : x, this.itemSizeLimit = null !== (n2 = e2.itemSizeLimit) && void 0 !== n2 ? n2 : 4194304, this.metadataBuffer = null !== (r2 = e2.metadataBuffer) && void 0 !== r2 ? r2 : 256;
  }
  return Object.defineProperty(e.prototype, "_encryptionCheckKey", { get: function() {
    return "".concat(this.dbname, ".encrypt");
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "_reservedKeys", { get: function() {
    return [this._encryptionCheckKey];
  }, enumerable: false, configurable: true }), e.prototype._getRawKey = function(e2, t2) {
    return void 0 === t2 && (t2 = ""), "".concat(e2).concat(t2);
  }, e.prototype._generateShardPostfixArray = function(e2) {
    return void 0 === e2 && (e2 = 1), c([], a(Array(e2).keys()), false);
  }, e.prototype._shardify = function(e2) {
    var t2 = this, n2 = e2.key, r2 = e2.value, i2 = JSON.stringify(this.encryption.encrypt(r2)), s3 = Math.ceil(i2.length / this.adjustedItemSizeLimit);
    return this._generateShardPostfixArray(s3).map(function(e3) {
      var r3 = { key: t2._getRawKey(n2, ".".concat(e3)), data: i2.substring(e3 * t2.adjustedItemSizeLimit, (e3 + 1) * t2.adjustedItemSizeLimit) };
      return 0 === e3 && (r3.metadata = { shards: s3 }), r3;
    });
  }, e.prototype._resetIfEncryptionChanged = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2, s3, a2, o2, u2, c2 = this;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this.get(this._encryptionCheckKey)];
          case 1:
            if (e2 = l.sent(), t2 = { encrypted: Ss.map(function(e3) {
              var t3;
              return null === (t3 = c2.encryption) || void 0 === t3 ? void 0 : t3.encrypt(e3);
            }) }, !e2)
              return [3, 8];
            if (!e2.encrypted || !Array.isArray(e2.encrypted))
              return [3, 6];
            for (i2 in n2 = e2.encrypted, r2 = [], n2)
              r2.push(i2);
            s3 = 0, l.label = 2;
          case 2:
            return s3 < r2.length ? (i2 = r2[s3]) in n2 ? (a2 = i2, o2 = JSON.stringify(e2.encrypted[a2]), u2 = JSON.stringify(t2.encrypted[a2]), o2 === u2 ? [3, 4] : (Ms.warning("Encryption algorithm has changed. Stored data would be cleared."), [4, this.clear()])) : [3, 4] : [3, 5];
          case 3:
            return l.sent(), [3, 5];
          case 4:
            return s3++, [3, 2];
          case 5:
            return [3, 8];
          case 6:
            return [4, this.clear()];
          case 7:
            l.sent(), l.label = 8;
          case 8:
            return [4, this.set({ key: this._encryptionCheckKey, value: t2 })];
          case 9:
            return l.sent(), [2];
        }
      });
    });
  }, Object.defineProperty(e.prototype, "adjustedItemSizeLimit", { get: function() {
    return Math.max(this.itemSizeLimit - this.metadataBuffer, 4);
  }, enumerable: false, configurable: true }), e.prototype.usage = function() {
    return r(this, void 0, void 0, function() {
      var e2, t2, n2, r2, i2, s3, a2, o2, u2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return e2 = 0, [4, this._getAllRawKeys()];
          case 1:
            t2 = c2.sent(), c2.label = 2;
          case 2:
            c2.trys.push([2, 7, 8, 9]), n2 = o(t2), r2 = n2.next(), c2.label = 3;
          case 3:
            return r2.done ? [3, 6] : (i2 = r2.value, [4, this._getRaw(i2)]);
          case 4:
            (s3 = c2.sent()) && (e2 += JSON.stringify(s3).length), c2.label = 5;
          case 5:
            return r2 = n2.next(), [3, 3];
          case 6:
            return [3, 9];
          case 7:
            return a2 = c2.sent(), o2 = { error: a2 }, [3, 9];
          case 8:
            try {
              r2 && !r2.done && (u2 = n2.return) && u2.call(n2);
            } finally {
              if (o2)
                throw o2.error;
            }
            return [7];
          case 9:
            return [2, e2];
        }
      });
    });
  }, e.prototype.getAllKeys = function() {
    return r(this, void 0, void 0, function() {
      var e2 = this;
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return [4, this._getAllRawKeys()];
          case 1:
            return [2, t2.sent().filter(function(e3) {
              return e3.endsWith(".0");
            }).map(function(e3) {
              return e3.replace(/\.0$/, "");
            }).filter(function(t3) {
              return !e2._reservedKeys.includes(t3);
            })];
        }
      });
    });
  }, e.prototype.get = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2 = this;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            return t2 = this._getRawKey(e2, ".0"), [4, this._getRaw(t2)];
          case 1:
            if (!(n2 = u2.sent()))
              return [3, 7];
            u2.label = 2;
          case 2:
            return u2.trys.push([2, 6, , 7]), r2 = n2.data, (null == (i2 = n2.metadata) ? void 0 : i2.shards) && i2.shards > 1 ? [4, Promise.all(this._generateShardPostfixArray(null == i2 ? void 0 : i2.shards).map(function(t3) {
              return r(o2, void 0, void 0, function() {
                var n3, i3;
                return s(this, function(s4) {
                  switch (s4.label) {
                    case 0:
                      return t3 > 0 ? (n3 = this._getRawKey(e2, ".".concat(t3)), [4, this._getRaw(n3)]) : [3, 2];
                    case 1:
                      if (!(i3 = s4.sent()))
                        throw qi.storeBrokenIntegrity;
                      return [2, i3.data];
                    case 2:
                      return [2, r2];
                  }
                });
              });
            }))] : [3, 4];
          case 3:
            return a2 = u2.sent(), [3, 5];
          case 4:
            a2 = [r2], u2.label = 5;
          case 5:
            return s3 = a2, [2, this.encryption.decrypt(JSON.parse(s3.join("")))];
          case 6:
            return u2.sent(), [2, null];
          case 7:
            return [2, null];
        }
      });
    });
  }, e.prototype.set = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return t2 = this._shardify(e2), [4, this._setRaw(t2)];
          case 1:
            return n2.sent(), [2, n({}, e2.value)];
        }
      });
    });
  }, e.prototype.setMany = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2 = this;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return t2 = [], [4, this._setRaw(t2.concat.apply(t2, c([], a(e2.map(function(e3) {
              return n2._shardify(e3);
            })), false)))];
          case 1:
            return r2.sent(), [2, e2.map(function(e3) {
              return e3.value;
            })];
        }
      });
    });
  }, e.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2 = this;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return t2 = this._getRawKey(e2, ".0"), [4, this._getRaw(t2)];
          case 1:
            return (n2 = o2.sent()) ? (r2 = n2.metadata, i2 = this._generateShardPostfixArray(null == r2 ? void 0 : r2.shards).map(function(t3) {
              return a2._getRawKey(e2, ".".concat(t3));
            }), [4, this._removeRaw(i2)]) : [3, 3];
          case 2:
            return o2.sent(), null == (s3 = hs.get(this.dbname)) || s3.remove(e2), [2, true];
          case 3:
            return [2, false];
        }
      });
    });
  }, e.prototype.removeMany = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d = this;
      return s(this, function(h) {
        switch (h.label) {
          case 0:
            t2 = hs.get(this.dbname), n2 = [], r2 = function(e3) {
              var r3, s4, a3;
              return s(this, function(o3) {
                switch (o3.label) {
                  case 0:
                    return r3 = i2._getRawKey(e3, ".0"), [4, i2._getRaw(r3)];
                  case 1:
                    return (s4 = o3.sent()) && (a3 = s4.metadata, n2.push.apply(n2, c([], a(i2._generateShardPostfixArray(null == a3 ? void 0 : a3.shards).map(function(t3) {
                      return d._getRawKey(e3, ".".concat(t3));
                    })), false))), null == t2 || t2.remove(e3), [2];
                }
              });
            }, i2 = this, h.label = 1;
          case 1:
            h.trys.push([1, 6, 7, 8]), s3 = o(e2), a2 = s3.next(), h.label = 2;
          case 2:
            return a2.done ? [3, 5] : (o2 = a2.value, [5, r2(o2)]);
          case 3:
            h.sent(), h.label = 4;
          case 4:
            return a2 = s3.next(), [3, 2];
          case 5:
            return [3, 8];
          case 6:
            return u2 = h.sent(), c2 = { error: u2 }, [3, 8];
          case 7:
            try {
              a2 && !a2.done && (l = s3.return) && l.call(s3);
            } finally {
              if (c2)
                throw c2.error;
            }
            return [7];
          case 8:
            return n2.length > 0 ? [4, this._removeRaw(n2)] : [3, 10];
          case 9:
            h.sent(), h.label = 10;
          case 10:
            return [2, e2];
        }
      });
    });
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t2) {
        return null == (e2 = hs.get(this.dbname)) || e2.clearForDatabase(this.dbname), [2];
      });
    });
  }, e;
}();
var As = {};
var Ns = function(e) {
  function t2(t3) {
    void 0 === t3 && (t3 = {});
    var n2, r2 = this;
    r2 = e.call(this, n(n({}, t3), { itemSizeLimit: null !== (n2 = t3.itemSizeLimit) && void 0 !== n2 ? n2 : 4194304 })) || this;
    var i2 = t3.delay, s3 = void 0 === i2 ? 1 : i2;
    return r2.delay = s3, r2.observer = {}, r2;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "rawData", { get: function() {
    return As[this.dbname];
  }, set: function(e2) {
    As[this.dbname] = e2;
  }, enumerable: false, configurable: true }), t2.prototype._getAllRawKeys = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        if (As[this.dbname])
          return [2, Object.keys(As[this.dbname])];
        throw qi.storeNotAvailable;
      });
    });
  }, t2.prototype._getRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return As[this.dbname] ? [4, Qi(this.delay)] : [3, 2];
          case 1:
            return t3.sent(), [2, As[this.dbname][e2] ? n({ key: e2 }, As[this.dbname][e2]) : null];
          case 2:
            throw qi.storeNotAvailable;
        }
      });
    });
  }, t2.prototype._setRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2, o2, u2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return As[this.dbname] ? [4, Qi(this.delay)] : [3, 2];
          case 1:
            c2.sent();
            try {
              for (t3 = o(e2), n2 = t3.next(); !n2.done; n2 = t3.next())
                r2 = n2.value, i2 = r2.key, s3 = r2.data, a2 = r2.metadata, As[this.dbname][i2] = Object.freeze({ data: s3, metadata: a2 });
            } catch (e3) {
              o2 = { error: e3 };
            } finally {
              try {
                n2 && !n2.done && (u2 = t3.return) && u2.call(t3);
              } finally {
                if (o2)
                  throw o2.error;
              }
            }
            return [3, 3];
          case 2:
            throw qi.storeNotAvailable;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype._removeRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return As[this.dbname] ? [4, Qi(this.delay)] : [3, 2];
          case 1:
            a2.sent();
            try {
              for (t3 = o(e2), n2 = t3.next(); !n2.done; n2 = t3.next())
                r2 = n2.value, As[this.dbname][r2] && delete As[this.dbname][r2];
            } catch (e3) {
              i2 = { error: e3 };
            } finally {
              try {
                n2 && !n2.done && (s3 = t3.return) && s3.call(t3);
              } finally {
                if (i2)
                  throw i2.error;
              }
            }
            return [3, 3];
          case 2:
            throw qi.storeNotAvailable;
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.observe = function(e2, t3, n2) {
    var r2 = this;
    this.observer[e2] || (this.observer[e2] = {}), t3.forEach(function(t4) {
      return r2.observer[e2][t4] = n2;
    });
  }, t2.prototype.checkAvailability = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        return [2];
      });
    });
  }, t2.prototype.init = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.dbname = e2, As[this.dbname] || (As[this.dbname] = {}), [4, this._resetIfEncryptionChanged()];
          case 1:
            return t3.sent(), [2];
        }
      });
    });
  }, t2.prototype.set = function(t3) {
    return r(this, void 0, void 0, function() {
      var n2, r2;
      return s(this, function(i2) {
        if ((n2 = this.observer[t3.key]) && "function" == typeof n2.set && (r2 = n2.set()))
          throw r2;
        return [2, e.prototype.set.call(this, t3)];
      });
    });
  }, t2.prototype.setMany = function(t3) {
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, u2;
      return s(this, function(c2) {
        try {
          for (n2 = o(t3), r2 = n2.next(); !r2.done; r2 = n2.next())
            if (i2 = r2.value, (s3 = this.observer[i2.key]) && "function" == typeof s3.set && (a2 = s3.set()))
              throw a2;
        } catch (e2) {
          o2 = { error: e2 };
        } finally {
          try {
            r2 && !r2.done && (u2 = n2.return) && u2.call(n2);
          } finally {
            if (o2)
              throw o2.error;
          }
        }
        return [2, e.prototype.setMany.call(this, t3)];
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, e.prototype.clear.call(this)];
          case 1:
            return t3.sent(), [4, Qi(this.delay)];
          case 2:
            return t3.sent(), As[this.dbname] = {}, [2];
        }
      });
    });
  }, t2;
}(Us);
var Cs = "NestDBStore";
!function(e) {
  e[e.UNINITIALIZED = 0] = "UNINITIALIZED", e[e.OPENING = 1] = "OPENING", e[e.OPEN = 2] = "OPEN", e[e.CLOSED = 3] = "CLOSED";
}(gs || (gs = {}));
var Os;
var ks = function(e) {
  function t2(t3) {
    void 0 === t3 && (t3 = {});
    var n2, r2 = this;
    return (r2 = e.call(this, n(n({}, t3), { itemSizeLimit: null !== (n2 = t3.itemSizeLimit) && void 0 !== n2 ? n2 : 104857600 })) || this)._storeName = Cs, r2._state = gs.UNINITIALIZED, r2._openJobQueue = [], r2._window = "undefined" != typeof window ? window : void 0, r2._indexedDb = r2._window ? r2._window.indexedDB || r2._window.mozIndexedDB || r2._window.webkitIndexedDB || r2._window.msIndexedDB : void 0, r2;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "state", { get: function() {
    return this._state;
  }, enumerable: false, configurable: true }), t2.prototype.isTransactionInactiveError = function(e2) {
    return e2 instanceof Error && e2.message.includes("The transaction is inactive");
  }, t2.prototype._putToObjectStore = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        return [2, new Promise(function(n3, r2) {
          var i2 = e2.put(t3);
          i2.addEventListener("success", function(e3) {
            n3(e3.target.result);
          }), i2.addEventListener("error", function() {
            r2("Failed to write.");
          });
        })];
      });
    });
  }, t2.prototype._deleteFromObjectStore = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        return [2, new Promise(function(n3, r2) {
          var i2 = e2.delete(t3);
          i2.addEventListener("success", function() {
            return n3(t3);
          }), i2.addEventListener("error", function(e3) {
            return r2(e3.target.error);
          });
        })];
      });
    });
  }, t2.prototype._openDatabase = function(e2) {
    var t3 = this;
    return new Promise(function(n2, r2) {
      if (t3._indexedDb) {
        t3._state = gs.OPENING;
        var i2 = t3._indexedDb.open(e2);
        i2.addEventListener("upgradeneeded", function(e3) {
          e3.target.result.createObjectStore(Cs, { keyPath: "key" });
        }), i2.addEventListener("success", function(r3) {
          t3._state = gs.OPEN, t3._database = r3.target.result, t3._openJobQueue.forEach(function(e3) {
            return e3();
          }), t3._openJobQueue = [], t3._database.onclose = function() {
            t3._database = void 0, t3._state = gs.OPENING, setTimeout(function() {
              t3._openDatabase(e2);
            }, 5);
          }, n2(t3._database);
        }), i2.addEventListener("error", function(e3) {
          t3._state = gs.UNINITIALIZED, r2(e3.target.error);
        });
      } else
        r2(qi.storeNotAvailable);
    });
  }, t2.prototype._getObjectStore = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this._database ? [2, this._database.transaction(this._storeName, e2).objectStore(this._storeName)] : [3, 1];
          case 1:
            switch (this._state) {
              case gs.UNINITIALIZED:
              case gs.OPEN:
                return [3, 2];
              case gs.OPENING:
              case gs.CLOSED:
                return [3, 3];
            }
            return [3, 4];
          case 2:
            throw qi.storeNotInitialized;
          case 3:
            return [2, new Promise(function(n3) {
              t3._openJobQueue.push(function() {
                return n3(t3._getObjectStore(e2));
              });
            })];
          case 4:
            return [4, this._getObjectStore(e2)];
          case 5:
            return [2, n2.sent()];
        }
      });
    });
  }, t2.prototype._getAllRawKeys = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return [4, this._getObjectStore("readonly")];
          case 1:
            return e2 = t3.sent(), [4, new Promise(function(t4, n2) {
              var r2 = e2.getAllKeys();
              r2.addEventListener("success", function(e3) {
                t4(e3.target.result);
              }), r2.addEventListener("error", function(e3) {
                return n2(e3.target.error);
              });
            })];
          case 2:
            return [2, t3.sent()];
        }
      });
    });
  }, t2.prototype._getRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._getObjectStore("readonly")];
          case 1:
            return t3 = n2.sent(), [4, new Promise(function(n3, r2) {
              var i2 = t3.get(e2);
              i2.addEventListener("success", function(e3) {
                var t4;
                n3(null === (t4 = null == e3 ? void 0 : e3.target) || void 0 === t4 ? void 0 : t4.result);
              }), i2.addEventListener("error", function(e3) {
                return r2(e3.target.error);
              });
            })];
          case 2:
            return [2, n2.sent()];
        }
      });
    });
  }, t2.prototype._setRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2, o2, u2, c2 = this;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this._getObjectStore("readwrite")];
          case 1:
            t3 = l.sent(), l.label = 2;
          case 2:
            return l.trys.push([2, 4, , 15]), [4, Promise.all(e2.map(function(e3) {
              return c2._putToObjectStore(t3, e3);
            }))];
          case 3:
            return l.sent(), [3, 15];
          case 4:
            if (n2 = l.sent(), !this.isTransactionInactiveError(n2))
              return [3, 13];
            l.label = 5;
          case 5:
            l.trys.push([5, 10, 11, 12]), r2 = o(e2), i2 = r2.next(), l.label = 6;
          case 6:
            return i2.done ? [3, 9] : (s3 = i2.value, [4, this._putToObjectStore(t3, s3)]);
          case 7:
            l.sent(), l.label = 8;
          case 8:
            return i2 = r2.next(), [3, 6];
          case 9:
            return [3, 12];
          case 10:
            return a2 = l.sent(), o2 = { error: a2 }, [3, 12];
          case 11:
            try {
              i2 && !i2.done && (u2 = r2.return) && u2.call(r2);
            } finally {
              if (o2)
                throw o2.error;
            }
            return [7];
          case 12:
            return [3, 14];
          case 13:
            throw n2;
          case 14:
            return [3, 15];
          case 15:
            return [2];
        }
      });
    });
  }, t2.prototype._removeRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2, o2, u2, c2 = this;
      return s(this, function(l) {
        switch (l.label) {
          case 0:
            return [4, this._getObjectStore("readwrite")];
          case 1:
            t3 = l.sent(), l.label = 2;
          case 2:
            return l.trys.push([2, 4, , 15]), [4, Promise.all(e2.map(function(e3) {
              return c2._deleteFromObjectStore(t3, e3);
            }))];
          case 3:
            return l.sent(), [3, 15];
          case 4:
            if (n2 = l.sent(), !this.isTransactionInactiveError(n2))
              return [3, 13];
            l.label = 5;
          case 5:
            l.trys.push([5, 10, 11, 12]), r2 = o(e2), i2 = r2.next(), l.label = 6;
          case 6:
            return i2.done ? [3, 9] : (s3 = i2.value, [4, this._deleteFromObjectStore(t3, s3)]);
          case 7:
            l.sent(), l.label = 8;
          case 8:
            return i2 = r2.next(), [3, 6];
          case 9:
            return [3, 12];
          case 10:
            return a2 = l.sent(), o2 = { error: a2 }, [3, 12];
          case 11:
            try {
              i2 && !i2.done && (u2 = r2.return) && u2.call(r2);
            } finally {
              if (o2)
                throw o2.error;
            }
            return [7];
          case 12:
            return [3, 14];
          case 13:
            throw n2;
          case 14:
            return [3, 15];
          case 15:
            return [2];
        }
      });
    });
  }, t2.prototype._triggerDatabaseClose = function() {
    this._database && this._database.onclose && this._database.onclose(new Event("dummy"));
  }, t2.prototype.checkAvailability = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            if (!((null == (e2 = "undefined" != typeof window ? window : null) ? void 0 : e2.indexedDB) || (null == e2 ? void 0 : e2.mozIndexedDB) || (null == e2 ? void 0 : e2.webkitIndexedDB) || (null == e2 ? void 0 : e2.msIndexedDB)))
              return [3, 6];
            if (this._indexedDb = e2.indexedDB || e2.mozIndexedDB || e2.webkitIndexedDB || e2.msIndexedDB, !this._window || !ys())
              return [3, 4];
            if (!(ys() && navigator.userAgent && navigator.userAgent.includes("Edge/")))
              return [3, 1];
            if (!this._window.indexedDB && (e2.PointerEvent || e2.MSPointerEvent))
              throw qi.storeNotAvailableInPrivateBrowsing;
            return [3, 3];
          case 1:
            return [4, new Promise(function(e3, n3) {
              if (t3._indexedDb)
                try {
                  var r2 = t3._indexedDb.open("_testMozilla");
                  r2.onerror = function() {
                    return n3(qi.storeNotAvailableInPrivateBrowsing);
                  }, r2.onsuccess = function(r3) {
                    if (r3.target.result.close(), t3._indexedDb) {
                      var i2 = t3._indexedDb.deleteDatabase("_testMozilla");
                      i2.onerror = function() {
                        return e3();
                      }, i2.onsuccess = function() {
                        return e3();
                      };
                    } else
                      n3(qi.storeNotAvailable);
                  };
                } catch (e4) {
                  n3(qi.storeNotAvailableInPrivateBrowsing);
                }
              else
                n3(qi.storeNotAvailable);
            })];
          case 2:
            n2.sent(), n2.label = 3;
          case 3:
            return [3, 5];
          case 4:
            throw qi.storeNotAvailable;
          case 5:
            return [3, 7];
          case 6:
            throw qi.storeNotAvailable;
          case 7:
            return [2];
        }
      });
    });
  }, t2.prototype.init = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.dbname = e2, [4, this.checkAvailability()];
          case 1:
            return t3.sent(), [4, this._openDatabase(e2)];
          case 2:
            return t3.sent(), [4, this._resetIfEncryptionChanged()];
          case 3:
            return t3.sent(), [2];
        }
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, e.prototype.clear.call(this)];
          case 1:
            return n2.sent(), [4, this._getObjectStore("readwrite")];
          case 2:
            return t3 = n2.sent(), [4, new Promise(function(e2, n3) {
              var r2 = t3.clear();
              r2.addEventListener("success", function() {
                return e2();
              }), r2.addEventListener("error", function(e3) {
                return n3(e3.target.error);
              });
            })];
          case 3:
            return [2, n2.sent()];
        }
      });
    });
  }, t2;
}(Us);
var Ps = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.AsyncStorage, i2 = t3.itemSizeLimit, s3 = void 0 === i2 ? 2097152 : i2, a2 = i(t3, ["AsyncStorage", "itemSizeLimit"]);
    return (n2 = e.call(this, n(n({}, a2), { itemSizeLimit: s3 })) || this)._asyncStorage = r2, n2;
  }
  return t(t2, e), t2.prototype._isBelonging = function(e2) {
    return e2.startsWith("".concat(this.dbname, "/"));
  }, t2.prototype._getActualKey = function(e2) {
    return "".concat(this.dbname, "/").concat(e2);
  }, t2.prototype._getAllRawKeys = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._asyncStorage.getAllKeys()];
          case 1:
            return e2 = n2.sent(), [2, e2.filter(function(e3) {
              return t3._isBelonging(e3);
            }).map(function(e3) {
              return e3.substring("".concat(t3.dbname, "/").length);
            })];
        }
      });
    });
  }, t2.prototype._getRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._asyncStorage.getItem(this._getActualKey(e2))];
          case 1:
            return [2, (t3 = n2.sent()) ? JSON.parse(t3) : null];
        }
      });
    });
  }, t2.prototype._setRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2, o2;
      return s(this, function(u2) {
        switch (u2.label) {
          case 0:
            t3 = [];
            try {
              for (n2 = o(e2), r2 = n2.next(); !r2.done; r2 = n2.next())
                i2 = r2.value, s3 = i2.key, i2.data.length <= this.adjustedItemSizeLimit && t3.push([this._getActualKey(s3), JSON.stringify(i2)]);
            } catch (e3) {
              a2 = { error: e3 };
            } finally {
              try {
                r2 && !r2.done && (o2 = n2.return) && o2.call(n2);
              } finally {
                if (a2)
                  throw a2.error;
              }
            }
            return [4, this._asyncStorage.multiSet(t3)];
          case 1:
            return u2.sent(), [2];
        }
      });
    });
  }, t2.prototype._removeRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._asyncStorage.multiRemove(e2.map(function(e3) {
              return t3._getActualKey(e3);
            }))];
          case 1:
            return n2.sent(), [2];
        }
      });
    });
  }, t2.prototype.checkAvailability = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        if (!this._asyncStorage)
          throw qi.storeNotAvailable;
        return [2];
      });
    });
  }, t2.prototype.init = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.dbname = e2, [4, this._resetIfEncryptionChanged()];
          case 1:
            return t3.sent(), [2];
        }
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, e.prototype.clear.call(this)];
          case 1:
            return n2.sent(), [4, this.getAllKeys()];
          case 2:
            return t3 = n2.sent(), [4, this.removeMany(t3)];
          case 3:
            return n2.sent(), [2];
        }
      });
    });
  }, t2;
}(Us);
var Rs = function(e) {
  function t2(t3) {
    var n2, r2 = this;
    return (r2 = e.call(this, n(n({}, t3), { itemSizeLimit: null !== (n2 = t3.itemSizeLimit) && void 0 !== n2 ? n2 : 6291456 })) || this)._mmkv = t3.MMKV, r2;
  }
  return t(t2, e), t2.prototype._isBelonging = function(e2) {
    return e2.startsWith("".concat(this.dbname, "/"));
  }, t2.prototype._getActualKey = function(e2) {
    return "".concat(this.dbname, "/").concat(e2);
  }, t2.prototype._getAllRawKeys = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._mmkv.getAllKeys()];
          case 1:
            return e2 = n2.sent(), [2, e2.filter(function(e3) {
              return t3._isBelonging(e3);
            }).map(function(e3) {
              return e3.substring("".concat(t3.dbname, "/").length);
            })];
        }
      });
    });
  }, t2.prototype._getRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this._mmkv.getString(this._getActualKey(e2))];
          case 1:
            return [2, (t3 = n2.sent()) ? JSON.parse(t3) : null];
        }
      });
    });
  }, t2.prototype._setRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        try {
          for (t3 = o(e2), n2 = t3.next(); !n2.done; n2 = t3.next())
            r2 = n2.value, i2 = r2.key, r2.data.length <= this.adjustedItemSizeLimit && this._mmkv.set(this._getActualKey(i2), JSON.stringify(r2));
        } catch (e3) {
          s3 = { error: e3 };
        } finally {
          try {
            n2 && !n2.done && (a2 = t3.return) && a2.call(t3);
          } finally {
            if (s3)
              throw s3.error;
          }
        }
        return [2];
      });
    });
  }, t2.prototype._removeRaw = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3;
      return s(this, function(a2) {
        try {
          for (t3 = o(e2), n2 = t3.next(); !n2.done; n2 = t3.next())
            r2 = n2.value, this._mmkv.delete(this._getActualKey(r2));
        } catch (e3) {
          i2 = { error: e3 };
        } finally {
          try {
            n2 && !n2.done && (s3 = t3.return) && s3.call(t3);
          } finally {
            if (i2)
              throw i2.error;
          }
        }
        return [2];
      });
    });
  }, t2.prototype.checkAvailability = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        if (!this._mmkv)
          throw qi.storeNotAvailable;
        return [2];
      });
    });
  }, t2.prototype.init = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.dbname = e2, [4, this._resetIfEncryptionChanged()];
          case 1:
            return t3.sent(), [2];
        }
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, e.prototype.clear.call(this)];
          case 1:
            return n2.sent(), [4, this.getAllKeys()];
          case 2:
            return t3 = n2.sent(), [4, this.removeMany(t3)];
          case 3:
            return n2.sent(), [2];
        }
      });
    });
  }, t2;
}(Us);
!function(e) {
  e.INIT = "INIT", e.OPENING = "OPENING", e.OPENED = "OPENED", e.CLOSED = "CLOSED";
}(Os || (Os = {}));
var xs;
var Ds = function() {
  function e(e2) {
    var t2 = e2.name, n2 = e2.version, r2 = e2.store, i2 = e2.config;
    this.name = t2, this._version = n2, this._state = Os.INIT, this._config = i2 || new Li({ dbname: t2 }), this._store = r2, this._event = { success: Vi, error: Vi, storeReplaced: Vi, upgrade: Yi }, this._collections = /* @__PURE__ */ new Map(), this._globalMutex = new Is("".concat(this.name, ".lock")), this._config.disableLogger && Ms.off(), new hs({ dbname: t2, limit: this._config.cacheLimit });
  }
  return Object.defineProperty(e.prototype, "version", { get: function() {
    return this._version;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "state", { get: function() {
    return this._state;
  }, enumerable: false, configurable: true }), Object.defineProperty(e.prototype, "store", { get: function() {
    return this._store;
  }, enumerable: false, configurable: true }), e.prototype._initializeCollection = function(e2, t2) {
    var n2;
    return r(this, void 0, void 0, function() {
      var r2, i2, s3;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            return i2 = this._collections.get(e2), t2 ? (r2 = new Es({ dbname: this.name, collectionName: e2, keyName: t2.keyName, indexes: null !== (n2 = t2.index) && void 0 !== n2 ? n2 : [[t2.keyName]], store: this._store }), [3, 3]) : [3, 1];
          case 1:
            return i2 && i2.state === Fi.READY ? [3, 3] : [4, Es.metadataOf(this.name, e2, this._store)];
          case 2:
            (s3 = a2.sent()) && (r2 = new Es({ dbname: this.name, collectionName: e2, keyName: s3.keyName, indexes: s3.indexes, store: this._store })), a2.label = 3;
          case 3:
            return r2 ? (this._collections.set(e2, r2), [4, r2.init()]) : [3, 5];
          case 4:
            a2.sent(), a2.label = 5;
          case 5:
            return [2];
        }
      });
    });
  }, e.prototype.estimateUsage = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, (t2 = this._store, r(void 0, void 0, void 0, function() {
              return s(this, function(e3) {
                switch (e3.label) {
                  case 0:
                    return [4, t2.usage()];
                  case 1:
                    return [2, e3.sent()];
                }
              });
            }))];
          case 1:
            return [2, e2.sent()];
        }
        var t2;
      });
    });
  }, e.prototype.commitSchema = function(e2) {
    return r(this, void 0, void 0, function() {
      var t2 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this._state !== Os.OPENING ? [3, 2] : [4, Promise.all(e2.map(function(e3) {
              return r(t2, void 0, void 0, function() {
                return s(this, function(t3) {
                  switch (t3.label) {
                    case 0:
                      return [4, this._initializeCollection(e3.collectionName, e3)];
                    case 1:
                      return t3.sent(), [2];
                  }
                });
              });
            }))];
          case 1:
            return n2.sent(), [3, 3];
          case 2:
            throw qi.databaseSchemaNotOnUpgrade;
          case 3:
            return [2];
        }
      });
    });
  }, e.prototype.open = function() {
    var e2;
    return r(this, void 0, void 0, function() {
      var t2, n2, r2, i2, s3, a2, o2, u2, c2, l, d = this;
      return s(this, function(h) {
        switch (h.label) {
          case 0:
            return [4, this._globalMutex.lock()];
          case 1:
            if (h.sent(), this._state === Os.OPENED)
              return [3, 20];
            this._state = Os.OPENING, h.label = 2;
          case 2:
            return h.trys.push([2, 13, , 20]), [4, this._store.init(this.name)];
          case 3:
            return h.sent(), f = this.name, t2 = "".concat(ns(f), ".metadata"), n2 = { version: 0, collectionNames: [] }, [4, this._store.get(t2)];
          case 4:
            r2 = null !== (e2 = h.sent()) && void 0 !== e2 ? e2 : n2, h.label = 5;
          case 5:
            h.trys.push([5, 10, 11, 12]), i2 = o(r2.collectionNames), s3 = i2.next(), h.label = 6;
          case 6:
            return s3.done ? [3, 9] : (a2 = s3.value, [4, this._initializeCollection(a2)]);
          case 7:
            h.sent(), h.label = 8;
          case 8:
            return s3 = i2.next(), [3, 6];
          case 9:
            return [3, 12];
          case 10:
            return o2 = h.sent(), c2 = { error: o2 }, [3, 12];
          case 11:
            try {
              s3 && !s3.done && (l = i2.return) && l.call(i2);
            } finally {
              if (c2)
                throw c2.error;
            }
            return [7];
          case 12:
            return [2, new Promise(function(e3, n3) {
              var i3 = function(e4) {
                r2.version < d._version ? d._event.upgrade(r2.version, function(n4) {
                  return r(d, void 0, void 0, function() {
                    var i4;
                    return s(this, function(s5) {
                      switch (s5.label) {
                        case 0:
                          if (n4)
                            return [3, 5];
                          r2.version++, r2.collectionNames = Array.from(this._collections.keys()), s5.label = 1;
                        case 1:
                          return s5.trys.push([1, 3, , 4]), [4, this._store.set({ key: t2, value: r2 })];
                        case 2:
                          return s5.sent(), e4({ continued: true }), [3, 4];
                        case 3:
                          return i4 = s5.sent(), e4({ continued: false, err: i4 }), [3, 4];
                        case 4:
                          return [3, 6];
                        case 5:
                          e4({ continued: false, err: n4 }), s5.label = 6;
                        case 6:
                          return [2];
                      }
                    });
                  });
                }) : e4({ continued: false });
              }, s4 = function(t3) {
                var a3 = t3.continued, o3 = void 0 !== a3 && a3, u3 = t3.err, c3 = void 0 === u3 ? null : u3;
                o3 ? setTimeout(function() {
                  return i3(s4);
                }, 10) : c3 ? (Ms.error(c3.message), d._globalMutex.unlock(), d._event.error(c3), n3(c3)) : Promise.all(r2.collectionNames.map(function(e4) {
                  return d._initializeCollection(e4);
                })).then(function() {
                  d._state = Os.OPENED, d._globalMutex.unlock(), d._event.success(), e3();
                }).catch(function(e4) {
                  Ms.error(e4.message), d._globalMutex.unlock(), d._event.error(e4), n3(e4);
                });
              };
              i3(s4);
            })];
          case 13:
            switch (u2 = h.sent(), u2.code) {
              case Ei.STORE_NOT_AVAILABLE_IN_PRIVATE_BROWSING:
                return [3, 14];
              case Ei.STORE_NOT_AVAILABLE:
                return [3, 16];
            }
            return [3, 18];
          case 14:
            return Ms.warning("Access to the local storage is not allowed. Switched to MemoryStore automatically."), this._store = new Ns({}), this._globalMutex.unlock(), this._event.error(u2), this._event.storeReplaced(this._store), [4, this.open()];
          case 15:
            return h.sent(), [3, 19];
          case 16:
            return Ms.warning("IndexedDB is not available in this environment. Switched to MemoryStore automatically. Consider using other store to save data persistently (e.g. AsyncStorage)."), this._store = new Ns({}), this._globalMutex.unlock(), this._event.error(u2), this._event.storeReplaced(this._store), [4, this.open()];
          case 17:
            return h.sent(), [3, 19];
          case 18:
            throw Ms.error(u2.message), this._globalMutex.unlock(), this._event.error(u2), u2;
          case 19:
            return [3, 20];
          case 20:
            return [2];
        }
        var f;
      });
    });
  }, e.prototype.close = function() {
    this._collections.forEach(function(e2) {
      return e2.close();
    }), this._state = Os.CLOSED;
  }, e.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, Promise.all(Array.from(this._collections.values()).map(function(e3) {
              return e3.clear();
            }))];
          case 1:
            return e2.sent(), [2];
        }
      });
    });
  }, e.prototype.reset = function() {
    return r(this, void 0, void 0, function() {
      var e2;
      return s(this, function(t2) {
        switch (t2.label) {
          case 0:
            return (e2 = hs.get(this.name)) && e2.clearForDatabase(this.name), [4, this._store.clear()];
          case 1:
            return t2.sent(), [2];
        }
      });
    });
  }, e.prototype.on = function(e2, t2) {
    this._event[e2] = t2;
  }, e.prototype.off = function(e2) {
    if ("function" == typeof this._event[e2])
      if ("upgrade" === e2)
        this._event[e2] = Yi;
      else
        this._event[e2] = Vi;
  }, e.prototype.collection = function(e2) {
    var t2 = this._collections.get(e2);
    if (t2)
      return t2;
    throw qi.collectionNotReady;
  }, e;
}();
!function(e) {
  e[e.VERBOSE = 0] = "VERBOSE", e[e.DEBUG = 1] = "DEBUG", e[e.INFO = 2] = "INFO", e[e.WARN = 3] = "WARN", e[e.ERROR = 4] = "ERROR", e[e.NONE = 5] = "NONE";
}(xs || (xs = {}));
var Ls;
var Fs = function() {
  function e() {
    this.level = xs.WARN;
  }
  return e.prototype.verbose = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    this.level <= xs.VERBOSE && console.log.apply(console, c(["[verbose]"], a(e2), false));
  }, e.prototype.debug = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    this.level <= xs.DEBUG && console.log.apply(console, c(["[debug]"], a(e2), false));
  }, e.prototype.info = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    this.level <= xs.INFO && console.log.apply(console, c(["[info]"], a(e2), false));
  }, e.prototype.warn = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    this.level <= xs.WARN && console.warn.apply(console, c(["[warn]"], a(e2), false));
  }, e.prototype.error = function() {
    for (var e2 = [], t2 = 0; t2 < arguments.length; t2++)
      e2[t2] = arguments[t2];
    this.level <= xs.ERROR && console.error.apply(console, c(["[error]"], a(e2), false));
  }, e;
}();
var qs = function() {
  function e(e2) {
    var t2, n2, r2, i2;
    this.messageTypeFilter = null !== (t2 = null == e2 ? void 0 : e2.messageTypeFilter) && void 0 !== t2 ? t2 : j.ALL, this.customTypesFilter = null !== (n2 = null == e2 ? void 0 : e2.customTypesFilter) && void 0 !== n2 ? n2 : null, this.senderUserIdsFilter = null !== (r2 = null == e2 ? void 0 : e2.senderUserIdsFilter) && void 0 !== r2 ? r2 : null, this.replyType = null !== (i2 = null == e2 ? void 0 : e2.replyType) && void 0 !== i2 ? i2 : Q.NONE;
  }
  return e.prototype.clone = function() {
    var t2 = new e(), n2 = JSON.parse(JSON.stringify(this));
    return Object.keys(n2).forEach(function(e2) {
      t2[e2] = n2[e2];
    }), t2;
  }, e.prototype.match = function(e2) {
    switch (this.messageTypeFilter) {
      case j.USER:
        if (e2.messageType !== G.USER)
          return false;
        break;
      case j.FILE:
        if (e2.messageType !== G.FILE)
          return false;
        break;
      case j.ADMIN:
        if (e2.messageType !== G.ADMIN)
          return false;
    }
    if (this.customTypesFilter && this.customTypesFilter.length > 0 && !this.customTypesFilter.includes("*") && !this.customTypesFilter.includes(e2.customType))
      return false;
    if (this.senderUserIdsFilter && this.senderUserIdsFilter.length > 0) {
      if (!(e2 instanceof _t))
        return false;
      if (!this.senderUserIdsFilter.includes(e2.sender.userId))
        return false;
    }
    if (e2 instanceof yt)
      switch (this.replyType) {
        case Q.NONE:
          if (e2.parentMessageId > 0)
            return false;
          break;
        case Q.ONLY_REPLY_TO_CHANNEL:
          if (e2 instanceof _t && e2.parentMessageId > 0 && !e2.replyToChannel)
            return false;
      }
    return true;
  }, e;
}();
!function(e) {
  e.CHANNEL_LATEST = "channel_latest", e.NEWEST_CHILD_MESSAGE = "newest_child_message";
}(Ls || (Ls = {}));
var zs;
var Bs = function(e) {
  switch (e) {
    case Ls.CHANNEL_LATEST:
      return ["channelUrl", "-createdAt", "-messageId"];
    case Ls.NEWEST_CHILD_MESSAGE:
      return ["channelUrl", "-parentMessageId", "-createdAt", "-messageId"];
  }
};
var js = function() {
  return ["channelUrl", "-createdAt", "-notificationId"];
};
var Ks = n(n({}, on), { scheduledAt: void 0 });
var Qs = function(e) {
  return dn(e) && S("number", e.scheduledAt, true);
};
var Gs = n(n({}, rn), { scheduledAt: 0, file: void 0, fileUrl: void 0, fileName: void 0, mimeType: void 0, fileSize: void 0, thumbnailSizes: void 0, requireAuth: false });
var Vs = function(e) {
  return sn(e) && S("number", e.scheduledAt) && (k(e.file) || S("string", e.fileUrl)) && S("string", e.fileName, true) && S("string", e.mimeType, true) && S("number", e.fileSize, true) && (null === e.thumbnailSizes || void 0 === e.thumbnailSizes || e.thumbnailSizes.every(function(e2) {
    return S("object", e2) && e2.maxWidth > 0 && e2.maxHeight > 0;
  }));
};
var Hs = "UnsentMessage";
var Ws = "reqId";
var Ys = {};
var Js = function(t2) {
  function i2(e) {
    var n2 = t2.call(this, e) || this;
    return n2._mutex = new Is("unsendmessagecache.lock"), Ys[e] = n2, n2;
  }
  return t(i2, t2), Object.defineProperty(i2.prototype, "_cacheContext", { get: function() {
    return uo.of(this._iid).cacheContext;
  }, enumerable: false, configurable: true }), i2.of = function(e, t3) {
    return void 0 === t3 && (t3 = false), Ys[e] && !t3 || (Ys[e] = new i2(e)), Ys[e];
  }, Object.defineProperty(i2.prototype, "collection", { get: function() {
    var e = this._cacheContext.nestdb, t3 = null == e ? void 0 : e.collection(Hs);
    if (!t3)
      throw b.databaseError;
    return t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(i2.prototype, "localCacheEnabled", { get: function() {
    return this._cacheContext.localCacheEnabled && !!this.collection;
  }, enumerable: false, configurable: true }), i2.prototype._serialize = function(t3) {
    if (t3.messageId > 0)
      throw b.invalidParameters;
    var n2, r2 = n({}, t3.serialize());
    return t3 instanceof wt ? (t3.messageParams && (r2.messageParams = an(t3.messageParams)), t3.scheduledInfo && t3.scheduledInfo.scheduledMessageParams && (r2.scheduledInfo.scheduledMessageParams = (n2 = t3.scheduledInfo.scheduledMessageParams, n(n({}, an(n2)), { scheduledAt: n2.scheduledAt })))) : t3 instanceof Nt ? (t3.messageParams && (r2.messageParams = pn(t3.messageParams)), t3.scheduledInfo && t3.scheduledInfo.scheduledMessageParams && (r2.scheduledInfo.scheduledMessageParams = function(e) {
      return n(n({}, pn(e)), { scheduledAt: e.scheduledAt });
    }(t3.scheduledInfo.scheduledMessageParams))) : t3 instanceof Mt && t3.messageParams && (r2.messageParams = function(t4) {
      return se({ fileInfoList: t4.fileInfoList, isReplyToChannel: t4.isReplyToChannel, pushNotificationDeliveryOption: t4.pushNotificationDeliveryOption });
    }(t3.messageParams)), r2;
  }, i2.prototype._deserialize = function(e) {
    return e = n(n({}, e), { messageId: parseInt(e.messageId) }), la.of(this._iid).buildMessageFromSerializedData(e);
  }, i2.prototype._deserializeWithMessageCreateParams = function(e) {
    var t3, n2, r2;
    return r(this, void 0, void 0, function() {
      var i3, s3, a2, o2, u2, c2, l = this;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return i3 = la.of(this._iid), s3 = this._deserialize(e), e.messageParams ? s3 instanceof wt ? (o2 = e.messageParams, s3.messageParams = i3.buildUserMessageCreateParamsFromSerializedData(o2, s3), [3, 6]) : [3, 1] : [3, 6];
          case 1:
            return s3 instanceof Nt ? (o2 = e.messageParams).fileKey && "string" == typeof o2.fileKey && fn(null !== (t3 = o2.fileType) && void 0 !== t3 ? t3 : "") ? (a2 = o2, [4, this.collection.getBlob(o2.fileKey)]) : [3, 3] : [3, 4];
          case 2:
            a2.file = null !== (n2 = d.sent()) && void 0 !== n2 ? n2 : void 0, d.label = 3;
          case 3:
            return s3.messageParams = i3.buildFileMessageCreateParamsFromSerializedData(o2, s3), [3, 6];
          case 4:
            return s3 instanceof Mt && ((o2 = e.messageParams) && o2.fileInfoList) ? (s3.messageParams = i3.buildMultipleFilesMessageCreateParamsFromSerializedData(o2, s3), [4, Promise.all(s3.messageParams.fileInfoList.map(function(e2) {
              return r(l, void 0, void 0, function() {
                var t4, n3, r3, i4, s4;
                return s(this, function(a3) {
                  switch (a3.label) {
                    case 0:
                      return "string" == typeof (null === (n3 = e2._uploadedMetaData) || void 0 === n3 ? void 0 : n3.fileKey) && fn(null !== (i4 = null === (r3 = e2._uploadedMetaData) || void 0 === r3 ? void 0 : r3.fileType) && void 0 !== i4 ? i4 : "") ? (t4 = e2, [4, this.collection.getBlob(e2._uploadedMetaData.fileKey)]) : [3, 2];
                    case 1:
                      t4.file = null !== (s4 = a3.sent()) && void 0 !== s4 ? s4 : void 0, a3.label = 2;
                    case 2:
                      return [2];
                  }
                });
              });
            }))]) : [3, 6];
          case 5:
            d.sent(), d.label = 6;
          case 6:
            return s3.scheduledInfo && e.scheduledInfo && e.scheduledInfo.scheduledMessageParams ? s3 instanceof wt ? (u2 = e.scheduledInfo.scheduledMessageParams, s3.scheduledInfo.scheduledMessageParams = i3.buildScheduledUserMessageCreateParamsFromSerializedData(u2, s3), [3, 10]) : [3, 7] : [3, 10];
          case 7:
            return s3 instanceof Nt ? (u2 = e.scheduledInfo.scheduledMessageParams).fileKey && "string" == typeof u2.fileKey && "string" == typeof u2.fileType && fn(u2.fileType) ? (c2 = u2, [4, this.collection.getBlob(u2.fileKey)]) : [3, 9] : [3, 10];
          case 8:
            c2.file = null !== (r2 = d.sent()) && void 0 !== r2 ? r2 : void 0, d.label = 9;
          case 9:
            s3.scheduledInfo.scheduledMessageParams = i3.buildScheduledFileMessageCreateParamsFromSerializedData(u2, s3), d.label = 10;
          case 10:
            return [2, s3];
        }
      });
    });
  }, i2.prototype._getFileInfoBlobKey = function(e, t3) {
    return "".concat(e, ".").concat(t3);
  }, i2.prototype.get = function(e) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.getByKey("".concat(e))] : [3, 2];
          case 1:
            if (t3 = n2.sent())
              return [2, this._deserializeWithMessageCreateParams(t3)];
            n2.label = 2;
          case 2:
            return [2, void 0];
        }
      });
    });
  }, i2.prototype.fetch = function(e) {
    var t3 = e.channelUrl, n2 = e.filter, r2 = void 0 === n2 ? new qs() : n2, i3 = e.order, s3 = void 0 === i3 ? Ls.CHANNEL_LATEST : i3, a2 = e.sendingStatus, o2 = e.backward, u2 = void 0 !== o2 && o2, c2 = e.parentMessageId;
    return r(this, void 0, void 0, function() {
      var e2, n3, i4, o3, l = this;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return this.localCacheEnabled ? (e2 = Bs(s3), n3 = { "/where": function(e3) {
              return !!(s3 !== Ls.NEWEST_CHILD_MESSAGE || c2 && 0 !== e3.parentMessageId && e3.parentMessageId === c2) && r2.match(l._deserialize(e3));
            } }, t3 && (n3.channelUrl = t3), a2 && (n3.sendingStatus = a2), i4 = { where: n3, index: e2, backward: u2 }, [4, this.collection.query(i4)]) : [3, 3];
          case 1:
            return [4, d.sent().fetch({})];
          case 2:
            return o3 = d.sent(), [2, Promise.all(o3.map(function(e3) {
              return r(l, void 0, void 0, function() {
                return s(this, function(t4) {
                  switch (t4.label) {
                    case 0:
                      return [4, this._deserializeWithMessageCreateParams(e3)];
                    case 1:
                      return [2, t4.sent()];
                  }
                });
              });
            }))];
          case 3:
            return [2, []];
        }
      });
    });
  }, i2.prototype.getAllChildMessages = function(e, t3) {
    return void 0 === t3 && (t3 = new qs()), r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.fetch({ filter: t3, order: Ls.NEWEST_CHILD_MESSAGE, channelUrl: e.channelUrl, backward: false, parentMessageId: e.messageId })];
          case 1:
            return [2, n2.sent()];
        }
      });
    });
  }, i2.prototype.upsert = function(e) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, Promise.all(e.map(function(e2) {
              return r(t3, void 0, void 0, function() {
                var t4;
                return s(this, function(n3) {
                  switch (n3.label) {
                    case 0:
                      return e2 instanceof Nt || e2 instanceof Mt ? [4, this._mutex.lock()] : [3, 4];
                    case 1:
                      return n3.sent(), [4, this.saveBlob(e2)];
                    case 2:
                      return n3.sent(), [4, this._mutex.unlock()];
                    case 3:
                      n3.sent(), n3.label = 4;
                    case 4:
                      return t4 = this._serialize(e2), [4, this.collection.upsertOne(t4)];
                    case 5:
                      return n3.sent(), [2];
                  }
                });
              });
            }))] : [3, 2];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, i2.prototype.upsertChildMessages = function(e) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, Promise.all(e.map(function(e2) {
              return r(t3, void 0, void 0, function() {
                var t4;
                return s(this, function(n3) {
                  switch (n3.label) {
                    case 0:
                      return t4 = [], e2.threadInfo && e2.threadInfo.replyCount > 0 ? [4, this.getAllChildMessages(e2)] : [3, 2];
                    case 1:
                      t4 = n3.sent(), n3.label = 2;
                    case 2:
                      return t4.length > 0 ? (t4.forEach(function(t5) {
                        return t5.applyParentMessage(e2);
                      }), [4, this.upsert(t4)]) : [3, 4];
                    case 3:
                      n3.sent(), n3.label = 4;
                    case 4:
                      return [2];
                  }
                });
              });
            }))] : [3, 2];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, i2.prototype.remove = function(e) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i3, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            if (!this.localCacheEnabled)
              return [3, 8];
            o2.label = 1;
          case 1:
            o2.trys.push([1, 6, 7, 8]), t3 = o(e), n2 = t3.next(), o2.label = 2;
          case 2:
            return n2.done ? [3, 5] : (r2 = n2.value, [4, this.collection.remove(r2)]);
          case 3:
            o2.sent(), o2.label = 4;
          case 4:
            return n2 = t3.next(), [3, 2];
          case 5:
            return [3, 8];
          case 6:
            return i3 = o2.sent(), s3 = { error: i3 }, [3, 8];
          case 7:
            try {
              n2 && !n2.done && (a2 = t3.return) && a2.call(t3);
            } finally {
              if (s3)
                throw s3.error;
            }
            return [7];
          case 8:
            return [2];
        }
      });
    });
  }, i2.prototype.removeMessagesOfChannel = function(e) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.removeIf({ where: { channelUrl: e } })] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, i2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e) {
        switch (e.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.clear()] : [3, 2];
          case 1:
            e.sent(), e.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, i2.prototype.saveBlob = function(e) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i3 = this;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return e instanceof Nt ? e.messageParams && (r2 = e.messageParams).file && hn(r2.file) ? [4, this.collection.saveBlob(r2.file, e.reqId)] : [3, 2] : [3, 5];
          case 1:
            n2 = s3.sent(), r2.fileKey = n2, r2.fileType = cn.BLOB, s3.label = 2;
          case 2:
            return e.scheduledInfo && e.scheduledInfo.scheduledMessageParams && ((t3 = e.scheduledInfo.scheduledMessageParams).file && hn(t3.file)) ? [4, this.collection.saveBlob(t3.file, e.reqId)] : [3, 4];
          case 3:
            n2 = s3.sent(), t3.fileKey = n2, t3.fileType = cn.BLOB, s3.label = 4;
          case 4:
            return [3, 7];
          case 5:
            return e instanceof Mt && ((r2 = e.messageParams) && r2.fileInfoList && Array.isArray(r2.fileInfoList)) ? [4, Promise.all(r2.fileInfoList.map(function(t4, n3) {
              return r(i3, void 0, void 0, function() {
                var r3;
                return s(this, function(i4) {
                  switch (i4.label) {
                    case 0:
                      return t4.file && hn(t4.file) ? [4, this.collection.saveBlob(t4.file, this._getFileInfoBlobKey(e.reqId, n3))] : [3, 2];
                    case 1:
                      r3 = i4.sent(), t4._uploadedMetaData || (t4._uploadedMetaData = {}), t4._uploadedMetaData.fileKey = r3, t4._uploadedMetaData.fileType = cn.BLOB, i4.label = 2;
                    case 2:
                      return [2];
                  }
                });
              });
            }))] : [3, 7];
          case 6:
            s3.sent(), s3.label = 7;
          case 7:
            return [2];
        }
      });
    });
  }, i2;
}(Jr);
var Xs = {};
var Zs = function(e) {
  function t2(t3) {
    var n2 = e.call(this, t3) || this;
    return Xs[t3] = n2, n2;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "_sdkState", { get: function() {
    return uo.of(this._iid).sdkState;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_cacheContext", { get: function() {
    return uo.of(this._iid).cacheContext;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_unsentMessageCache", { get: function() {
    return Js.of(this._iid);
  }, enumerable: false, configurable: true }), t2.of = function(e2, n2) {
    return void 0 === n2 && (n2 = false), Xs[e2] && !n2 || (Xs[e2] = new t2(e2)), Xs[e2];
  }, Object.defineProperty(t2.prototype, "collection", { get: function() {
    var e2 = this._cacheContext.nestdb;
    return cs(!!e2).throw(b.databaseError), e2.collection(Zr2);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "localCacheEnabled", { get: function() {
    return this._cacheContext.localCacheEnabled && !!this.collection;
  }, enumerable: false, configurable: true }), t2.prototype._serialize = function(e2) {
    return n(n({}, e2.serialize()), { messageId: "".concat(e2.messageId) });
  }, t2.prototype._deserialize = function(e2) {
    return e2 = n(n({}, e2), { messageId: parseInt(e2.messageId) }), la.of(this._iid).buildMessageFromSerializedData(e2);
  }, t2.prototype.get = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.getByKey("".concat(e2))] : [3, 2];
          case 1:
            if (t3 = n2.sent())
              return [2, this._deserialize(t3)];
            n2.label = 2;
          case 2:
            return [2, void 0];
        }
      });
    });
  }, t2.prototype.fetch = function(e2) {
    var t3 = e2.channelUrl, n2 = e2.token, r2 = e2.limit, i2 = void 0 === r2 ? 100 : r2, s3 = e2.filter, a2 = void 0 === s3 ? new qs() : s3, o2 = e2.order, u2 = void 0 === o2 ? Ls.CHANNEL_LATEST : o2, c2 = e2.backward, l = void 0 !== c2 && c2, d = e2.parentMessageId, h = e2.isPollOnly, f = void 0 !== h && h, p = e2.exactMatch, m = void 0 !== p && p, v2 = e2.inclusive, y = void 0 === v2 || v2;
    return r(this, void 0, void 0, function() {
      var e3, r3, s4, o3 = this;
      return s(this, function(c3) {
        switch (c3.label) {
          case 0:
            return this.localCacheEnabled ? (e3 = Bs(u2), r3 = { where: { channelUrl: t3, "/where": function(e4) {
              if (null != n2 && "" !== n2)
                switch (u2) {
                  case Ls.CHANNEL_LATEST:
                    if (m && e4.createdAt !== n2)
                      return false;
                    if (l) {
                      if (y && e4.createdAt < n2 || !y && e4.createdAt <= n2)
                        return false;
                    } else if (y && e4.createdAt > n2 || !y && e4.createdAt >= n2)
                      return false;
                    break;
                  case Ls.NEWEST_CHILD_MESSAGE:
                    if (!d || 0 === e4.parentMessageId || e4.parentMessageId !== d)
                      return false;
                }
              return !(f && !e4._poll) && a2.match(o3._deserialize(e4));
            } }, index: e3, backward: l }, [4, this.collection.query(r3)]) : [3, 3];
          case 1:
            return [4, c3.sent().fetch({ limit: null != i2 ? i2 : void 0 })];
          case 2:
            return s4 = c3.sent(), [2, Promise.all(s4.map(function(e4) {
              return r(o3, void 0, void 0, function() {
                return s(this, function(t4) {
                  return [2, this._deserialize(e4)];
                });
              });
            }))];
          case 3:
            return [2, []];
        }
      });
    });
  }, t2.prototype.getAllChildMessages = function(e2, t3) {
    return void 0 === t3 && (t3 = new qs()), r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.fetch({ channelUrl: e2.channelUrl, token: Date.now(), limit: null, backward: false, filter: t3, order: Ls.NEWEST_CHILD_MESSAGE, parentMessageId: e2.messageId })];
          case 1:
            return [2, n2.sent()];
        }
      });
    });
  }, t2.prototype.upsert = function(e2) {
    var t3;
    return r(this, void 0, void 0, function() {
      var n2, r2, i2, s3, a2, o2, u2, c2, l = this;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.saveBlobs(e2)] : [3, 13];
          case 1:
            d.sent(), d.label = 2;
          case 2:
            d.trys.push([2, 7, 8, 9]), n2 = o(e2), r2 = n2.next(), d.label = 3;
          case 3:
            return r2.done ? [3, 6] : (i2 = r2.value, (null === (t3 = i2.threadInfo) || void 0 === t3 ? void 0 : t3._isUpdateRequired) ? [4, this.get(i2.messageId)] : [3, 5]);
          case 4:
            (null == (s3 = d.sent()) ? void 0 : s3.threadInfo) && i2.threadInfo._updateFrom(s3.threadInfo), d.label = 5;
          case 5:
            return r2 = n2.next(), [3, 3];
          case 6:
            return [3, 9];
          case 7:
            return a2 = d.sent(), u2 = { error: a2 }, [3, 9];
          case 8:
            try {
              r2 && !r2.done && (c2 = n2.return) && c2.call(n2);
            } finally {
              if (u2)
                throw u2.error;
            }
            return [7];
          case 9:
            return o2 = e2.map(function(e3) {
              return l._serialize(e3);
            }), [4, this.collection.upsertMany(o2)];
          case 10:
            return d.sent(), [4, this.upsertChildMessages(e2)];
          case 11:
            return d.sent(), [4, this._unsentMessageCache.upsertChildMessages(e2)];
          case 12:
            d.sent(), d.label = 13;
          case 13:
            return [2];
        }
      });
    });
  }, t2.prototype.upsertChildMessages = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, Promise.all(e2.map(function(e3) {
              return r(t3, void 0, void 0, function() {
                var t4, n3;
                return s(this, function(r2) {
                  switch (r2.label) {
                    case 0:
                      return t4 = [], (null === (n3 = e3.threadInfo) || void 0 === n3 ? void 0 : n3.replyCount) && e3.threadInfo.replyCount > 0 ? [4, this.getAllChildMessages(e3)] : [3, 2];
                    case 1:
                      t4 = r2.sent(), r2.label = 2;
                    case 2:
                      return t4.length > 0 ? (t4.forEach(function(t5) {
                        return t5.applyParentMessage(e3);
                      }), [4, this.upsert(t4)]) : [3, 4];
                    case 3:
                      r2.sent(), r2.label = 4;
                    case 4:
                      return [2];
                  }
                });
              });
            }))] : [3, 2];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            if (!this.localCacheEnabled)
              return [3, 8];
            o2.label = 1;
          case 1:
            o2.trys.push([1, 6, 7, 8]), t3 = o(e2), n2 = t3.next(), o2.label = 2;
          case 2:
            return n2.done ? [3, 5] : (r2 = n2.value, [4, this.collection.remove("".concat(r2))]);
          case 3:
            o2.sent(), o2.label = 4;
          case 4:
            return n2 = t3.next(), [3, 2];
          case 5:
            return [3, 8];
          case 6:
            return i2 = o2.sent(), s3 = { error: i2 }, [3, 8];
          case 7:
            try {
              n2 && !n2.done && (a2 = t3.return) && a2.call(t3);
            } finally {
              if (s3)
                throw s3.error;
            }
            return [7];
          case 8:
            return [2];
        }
      });
    });
  }, t2.prototype.removeMessagesOfChannel = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.removeIf({ where: { channelUrl: e2 }, index: Bs(Ls.CHANNEL_LATEST) })] : [3, 6];
          case 1:
            return n2.sent(), [4, (t3 = this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync"))];
          case 2:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync.meta"))];
          case 3:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs"))];
          case 4:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs.meta"))];
          case 5:
            n2.sent(), n2.label = 6;
          case 6:
            return [2];
        }
      });
    });
  }, t2.prototype.removeUnderOffset = function(e2, t3, n2) {
    return void 0 === n2 && (n2 = false), r(this, void 0, void 0, function() {
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.removeIf({ where: { channelUrl: e2, createdAt: n2 ? { "<=": t3 } : { "<": t3 } }, index: Bs(Ls.CHANNEL_LATEST) })] : [3, 2];
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.clear()] : [3, 2];
          case 1:
            e2.sent(), e2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.countBetween = function(e2, t3, n2) {
    return r(this, void 0, void 0, function() {
      var r2, i2 = this;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return this.localCacheEnabled ? (r2 = Bs(Ls.CHANNEL_LATEST), [4, this.collection.query({ where: { channelUrl: e2, "/where": function(e3) {
              var r3 = i2._deserialize(e3);
              return n2.includes(r3.createdAt) && t3.match(r3);
            } }, index: r2 }).count()]) : [3, 2];
          case 1:
            return [2, s3.sent()];
          case 2:
            return [2, 0];
        }
      });
    });
  }, t2.prototype.saveBlobs = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3 = this;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, Promise.all(e2.map(function(e3) {
              return r(t3, void 0, void 0, function() {
                var t4, n3;
                return s(this, function(r2) {
                  switch (r2.label) {
                    case 0:
                      return e3 instanceof Nt && e3.messageParams && ((t4 = e3.messageParams).file && hn(t4.file)) ? [4, this.collection.saveBlob(t4.file, e3.reqId)] : [3, 2];
                    case 1:
                      n3 = r2.sent(), t4.fileKey = n3, r2.label = 2;
                    case 2:
                      return [2];
                  }
                });
              });
            }))];
          case 1:
            return n2.sent(), [2];
        }
      });
    });
  }, t2.prototype._getGroupChannelPreferenceSize = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return t3 = 0, [4, (n2 = this._cacheContext.preference).get("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync"))];
          case 1:
            return r2 = o2.sent(), [4, n2.get("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync.meta"))];
          case 2:
            return i2 = o2.sent(), [4, n2.get("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs"))];
          case 3:
            return s3 = o2.sent(), [4, n2.get("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs.meta"))];
          case 4:
            return a2 = o2.sent(), r2 && (t3 += JSON.stringify(r2).length), i2 && (t3 += JSON.stringify(i2).length), s3 && (t3 += JSON.stringify(s3).length), a2 && (t3 += JSON.stringify(a2).length), [2, t3];
        }
      });
    });
  }, t2;
}(Jr);
var $s = {};
var ea = function(e) {
  function t2(t3) {
    var n2 = e.call(this, t3) || this;
    return $s[t3] = n2, n2;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "_sdkState", { get: function() {
    return uo.of(this._iid).sdkState;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_cacheContext", { get: function() {
    return uo.of(this._iid).cacheContext;
  }, enumerable: false, configurable: true }), t2.of = function(e2, n2) {
    return void 0 === n2 && (n2 = false), $s[e2] && !n2 || ($s[e2] = new t2(e2)), $s[e2];
  }, Object.defineProperty(t2.prototype, "collection", { get: function() {
    var e2 = this._cacheContext.nestdb;
    return cs(!!e2).throw(b.databaseError), e2.collection(ti);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "localCacheEnabled", { get: function() {
    return this._cacheContext.localCacheEnabled && !!this.collection;
  }, enumerable: false, configurable: true }), t2.prototype._serialize = function(e2) {
    return n({}, e2.serialize());
  }, t2.prototype._deserialize = function(e2) {
    return la.of(this._iid).buildMessageFromSerializedData(e2);
  }, t2.prototype.get = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.getByKey(e2)] : [3, 2];
          case 1:
            if (t3 = n2.sent())
              return [2, this._deserialize(t3)];
            n2.label = 2;
          case 2:
            return [2, void 0];
        }
      });
    });
  }, t2.prototype.fetch = function(e2) {
    var t3 = e2.channelUrl, n2 = e2.token, r2 = e2.limit, i2 = void 0 === r2 ? 100 : r2, s3 = e2.filter, a2 = void 0 === s3 ? new qs() : s3, o2 = e2.backward, u2 = void 0 !== o2 && o2, c2 = e2.exactMatch, l = void 0 !== c2 && c2, d = e2.inclusive, h = void 0 === d || d;
    return r(this, void 0, void 0, function() {
      var e3, r3 = this;
      return s(this, function(s4) {
        switch (s4.label) {
          case 0:
            return this.localCacheEnabled ? (e3 = { where: { channelUrl: t3, "/where": function(e4) {
              if (n2) {
                if (l && e4.createdAt !== n2)
                  return false;
                if (u2) {
                  if (h && e4.createdAt < n2 || !h && e4.createdAt <= n2)
                    return false;
                } else if (h && e4.createdAt > n2 || !h && e4.createdAt >= n2)
                  return false;
              }
              return a2.match(r3._deserialize(e4));
            } }, index: ["channelUrl", "-createdAt", "-notificationId"], backward: u2 }, [4, this.collection.query(e3)]) : [3, 3];
          case 1:
            return [4, s4.sent().fetch({ limit: null != i2 ? i2 : void 0 })];
          case 2:
            return [2, s4.sent().map(function(e4) {
              return r3._deserialize(e4);
            })];
          case 3:
            return [2, []];
        }
      });
    });
  }, t2.prototype.upsert = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2 = this;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.localCacheEnabled ? (t3 = e2.map(function(e3) {
              return n2._serialize(e3);
            }), [4, this.collection.upsertMany(t3)]) : [3, 2];
          case 1:
            r2.sent(), r2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            if (!this.localCacheEnabled)
              return [3, 8];
            o2.label = 1;
          case 1:
            o2.trys.push([1, 6, 7, 8]), t3 = o(e2), n2 = t3.next(), o2.label = 2;
          case 2:
            return n2.done ? [3, 5] : (r2 = n2.value, [4, this.collection.remove(r2)]);
          case 3:
            o2.sent(), o2.label = 4;
          case 4:
            return n2 = t3.next(), [3, 2];
          case 5:
            return [3, 8];
          case 6:
            return i2 = o2.sent(), s3 = { error: i2 }, [3, 8];
          case 7:
            try {
              n2 && !n2.done && (a2 = t3.return) && a2.call(t3);
            } finally {
              if (s3)
                throw s3.error;
            }
            return [7];
          case 8:
            return [2];
        }
      });
    });
  }, t2.prototype.markAsReadByTimestamp = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.updateIf({ where: { channelUrl: e2, messageStatus: vt.SENT, createdAt: { "<": t3 } } }, { set: { messageStatus: vt.READ } })] : [3, 2];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.markAsReadByMessageIds = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.updateIf({ where: { channelUrl: e2, notificationId: { "/in": t3 }, messageStatus: vt.SENT } }, { set: { messageStatus: vt.READ } })] : [3, 2];
          case 1:
            return [2, n2.sent().length];
          case 2:
            return [2, 0];
        }
      });
    });
  }, t2.prototype.removeMessagesOfChannel = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.removeIf({ where: { channelUrl: e2 }, index: ["channelUrl", "-createdAt", "-notificationId"] })] : [3, 6];
          case 1:
            return n2.sent(), [4, (t3 = this._cacheContext.preference).remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync"))];
          case 2:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/sync.meta"))];
          case 3:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs"))];
          case 4:
            return n2.sent(), [4, t3.remove("sendbird:".concat(this._sdkState.userId, "@groupchannel/").concat(e2, "/message/changelogs.meta"))];
          case 5:
            n2.sent(), n2.label = 6;
          case 6:
            return [2];
        }
      });
    });
  }, t2.prototype.removeUnderOffset = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      return s(this, function(n2) {
        switch (n2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.removeIf({ where: { channelUrl: e2, createdAt: { "<": t3 } }, index: Bs(Ls.CHANNEL_LATEST) })] : [3, 2];
          case 1:
            n2.sent(), n2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.localCacheEnabled ? [4, this.collection.clear()] : [3, 2];
          case 1:
            e2.sent(), e2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.countBetween = function(e2, t3, n2) {
    return r(this, void 0, void 0, function() {
      var r2, i2 = this;
      return s(this, function(s3) {
        switch (s3.label) {
          case 0:
            return this.localCacheEnabled ? (r2 = ["channelUrl", "-createdAt", "-notificationId"], [4, this.collection.query({ where: { channelUrl: e2, "/where": function(e3) {
              var r3 = i2._deserialize(e3);
              return n2.includes(r3.createdAt) && t3.match(r3);
            } }, index: r2 }).count()]) : [3, 2];
          case 1:
            return [2, s3.sent()];
          case 2:
            return [2, 0];
        }
      });
    });
  }, t2;
}(Jr);
var ta = {};
var na = function(e) {
  function t2(t3) {
    var n2 = e.call(this, t3) || this;
    return n2._observers = /* @__PURE__ */ new Map(), n2._dispatcherContext = n2._dispatcher.on(function(e2) {
      return r(n2, void 0, void 0, function() {
        var t4, n3, r2, i2, s3, a2, o2, u2, c2, l, d, h, f, p, m, v2, y, _, g, b2, E, T2 = this;
        return s(this, function(w2) {
          switch (w2.label) {
            case 0:
              return e2 instanceof po ? (t4 = e2.messages, E = e2.source, a2 = e2.isWebSocketEventComing, n3 = t4.filter(function(e3) {
                return e3 instanceof yt && e3.channelType !== H.OPEN && e3.messageId > 0;
              }), r2 = t4.filter(function(e3) {
                return e3 instanceof yt && e3.channelType !== H.OPEN && 0 === e3.messageId;
              }), i2 = t4.filter(function(e3) {
                return e3 instanceof St;
              }), n3.length > 0 ? [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._messageCache.upsert(n3)];
                      case 1:
                        return e3.sent(), [4, this._unsentMessageCache.remove(n3.map(function(e4) {
                          return e4 instanceof _t ? e4.reqId : null;
                        }).filter(function(e4) {
                          return null !== e4;
                        }))];
                      case 2:
                        return e3.sent(), [2];
                    }
                  });
                });
              })] : [3, 2]) : [3, 7];
            case 1:
              w2.sent(), a2 || this._broadcastUpdateEvent(n3, E), w2.label = 2;
            case 2:
              return r2.length > 0 ? [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._unsentMessageCache.upsert(r2)];
                      case 1:
                        return e3.sent(), [2];
                    }
                  });
                });
              })] : [3, 4];
            case 3:
              w2.sent(), a2 || this._broadcastUpdateEvent(r2, E), w2.label = 4;
            case 4:
              return i2.length > 0 ? [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._notificationCache.upsert(i2)];
                      case 1:
                        return e3.sent(), [2];
                    }
                  });
                });
              })] : [3, 6];
            case 5:
              w2.sent(), a2 || this._broadcastUpdateEvent(i2, E), w2.label = 6;
            case 6:
              return [3, 24];
            case 7:
              return e2 instanceof Eo ? (s3 = e2.messageIds, E = e2.source, a2 = e2.isWebSocketEventComing, o2 = s3.filter(function(e3) {
                return "number" == typeof e3;
              }), u2 = s3.filter(function(e3) {
                return "string" == typeof e3;
              }), [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return o2.length > 0 ? [4, this._messageCache.remove(o2)] : [3, 2];
                      case 1:
                        e3.sent(), e3.label = 2;
                      case 2:
                        return u2.length > 0 ? [4, this._notificationCache.remove(u2)] : [3, 4];
                      case 3:
                        e3.sent(), e3.label = 4;
                      case 4:
                        return [2];
                    }
                  });
                });
              })]) : [3, 9];
            case 8:
              return w2.sent(), a2 || this._broadcastRemoveEvent(s3, E), [3, 24];
            case 9:
              return e2 instanceof mo ? (c2 = e2.reqId, E = e2.source, [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._unsentMessageCache.remove([c2])];
                      case 1:
                        return e3.sent(), [2];
                    }
                  });
                });
              })]) : [3, 11];
            case 10:
              return w2.sent(), this._broadcastRemoveUnsentEvent(c2, E), [3, 24];
            case 11:
              return e2 instanceof yo ? (l = e2.polls, E = e2.source, this._cacheContext.localCacheEnabled ? (d = l.map(function(e3) {
                return e3.messageId;
              }), [4, Promise.all(d.map(function(e3) {
                return T2._messageCache.get(e3);
              }))]) : [3, 14]) : [3, 15];
            case 12:
              return (h = w2.sent().filter(function(e3) {
                return e3;
              })).length > 0 && l.forEach(function(e3) {
                var t5 = h.find(function(t6) {
                  return t6.messageId === e3.messageId;
                });
                t5 && t5.applyPoll(e3);
              }), [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._messageCache.upsert(h)];
                      case 1:
                        return [2, e3.sent()];
                    }
                  });
                });
              })];
            case 13:
              w2.sent(), w2.label = 14;
            case 14:
              return this._broadcastPollChangeLogEvent(l, E), [3, 24];
            case 15:
              return e2 instanceof wo ? (f = e2.event, E = e2.source, [4, this._messageCache.get(f.messageId)]) : [3, 19];
            case 16:
              return (p = w2.sent()) && p.isUserMessage() && p.poll && p.poll.applyPollUpdateEvent(f) ? [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._messageCache.upsert([p])];
                      case 1:
                        return [2, e3.sent()];
                    }
                  });
                });
              })] : [3, 18];
            case 17:
              w2.sent(), w2.label = 18;
            case 18:
              return this._broadcastPollUpdateEvent(f, E), [3, 24];
            case 19:
              return e2 instanceof So ? (m = e2.event, E = e2.source, [4, this._messageCache.get(m.messageId)]) : [3, 23];
            case 20:
              return (v2 = w2.sent()) && v2.isUserMessage() && v2.poll && v2.poll.applyPollVoteEvent(m) ? [4, Dr(function() {
                return r(T2, void 0, void 0, function() {
                  return s(this, function(e3) {
                    switch (e3.label) {
                      case 0:
                        return [4, this._messageCache.upsert([v2])];
                      case 1:
                        return [2, e3.sent()];
                    }
                  });
                });
              })] : [3, 22];
            case 21:
              w2.sent(), w2.label = 22;
            case 22:
              return this._broadcastPollVoteEvent(m, E), [3, 24];
            case 23:
              e2 instanceof vo ? (y = e2.event, E = e2.source, y.messageId > 0 && this._broadcastReactionUpdateEvent(y, E)) : e2 instanceof bo ? (_ = e2.event, E = e2.source, this._broadcastThreadUpdateEvent(_, E)) : e2 instanceof go && (g = e2.messageDeletionTimestamp, b2 = e2.channelUrl, E = e2.source, this._broadcastMessageRetentionEvent(g, b2, E)), w2.label = 24;
            case 24:
              return [2];
          }
        });
      });
    }), n2;
  }
  return t(t2, e), Object.defineProperty(t2.prototype, "_cacheContext", { get: function() {
    return uo.of(this._iid).cacheContext;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_dispatcher", { get: function() {
    return uo.of(this._iid).dispatcher;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_messageCache", { get: function() {
    return Zs.of(this._iid);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_unsentMessageCache", { get: function() {
    return Js.of(this._iid);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "_notificationCache", { get: function() {
    return ea.of(this._iid);
  }, enumerable: false, configurable: true }), t2.of = function(e2, n2) {
    var r2;
    return void 0 === n2 && (n2 = false), ta[e2] && !n2 || (ta[e2] && (null === (r2 = ta[e2]._dispatcherContext) || void 0 === r2 || r2.close()), ta[e2] = new t2(e2)), ta[e2];
  }, t2.prototype._broadcastUpdateEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onUpdate && a2.onUpdate(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastPollChangeLogEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onPollChangeLogUpdate && a2.onPollChangeLogUpdate(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastPollUpdateEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onPollUpdate && a2.onPollUpdate(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastPollVoteEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onPollVote && a2.onPollVote(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastRemoveEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onRemove && a2.onRemove(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastRemoveUnsentEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onRemoveUnsent && a2.onRemoveUnsent(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastReactionUpdateEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onReactionUpdate && a2.onReactionUpdate(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastThreadUpdateEvent = function(e2, t3) {
    var n2, r2;
    try {
      for (var i2 = o(this._observers.values()), s3 = i2.next(); !s3.done; s3 = i2.next()) {
        var a2 = s3.value;
        a2.onThreadInfoUpdate && a2.onThreadInfoUpdate(e2, t3);
      }
    } catch (e3) {
      n2 = { error: e3 };
    } finally {
      try {
        s3 && !s3.done && (r2 = i2.return) && r2.call(i2);
      } finally {
        if (n2)
          throw n2.error;
      }
    }
  }, t2.prototype._broadcastMessageRetentionEvent = function(e2, t3, n2) {
    var r2, i2;
    try {
      for (var s3 = o(this._observers.values()), a2 = s3.next(); !a2.done; a2 = s3.next()) {
        var o2 = a2.value;
        o2.onDeletedByRetentionPolicy && o2.onDeletedByRetentionPolicy(e2, t3, n2);
      }
    } catch (e3) {
      r2 = { error: e3 };
    } finally {
      try {
        a2 && !a2.done && (i2 = s3.return) && i2.call(s3);
      } finally {
        if (r2)
          throw r2.error;
      }
    }
  }, t2.prototype.subscribe = function(e2, t3) {
    this._observers.set(e2, t3);
  }, t2.prototype.unsubscribe = function(e2) {
    this._observers.delete(e2);
  }, t2.prototype.unsubscribeAll = function() {
    this._observers.clear();
  }, t2;
}(Jr);
var ra = {};
var ia = function(e) {
  function t2(t3, n2) {
    var r2 = n2.sdkState, i2 = n2.cacheContext, s3 = e.call(this, t3) || this;
    return s3._users = /* @__PURE__ */ new Map(), s3._sdkState = r2, s3._cacheContext = i2, ra[t3] = s3, s3;
  }
  return t(t2, e), t2.of = function(e2) {
    return ra[e2];
  }, Object.defineProperty(t2.prototype, "collection", { get: function() {
    var e2 = this._cacheContext.nestdb;
    return cs(!!e2).throw(b.databaseError), e2.collection(ui);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "localCacheEnabled", { get: function() {
    return this._cacheContext.localCacheEnabled && !!this.collection;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "users", { get: function() {
    return c([], a(this._users.values()), false);
  }, enumerable: false, configurable: true }), t2.prototype._serialize = function(e2, t3) {
    return n(n({}, e2.serialize()), { updatedAt: t3 });
  }, t2.prototype._deserialize = function(e2) {
    return ls._buildUserFromSerializedData(e2);
  }, t2.prototype.isCachedInMemory = function(e2) {
    return this._users.has(e2);
  }, t2.prototype.getUserInfoFromCache = function(e2) {
    if (this._users.has(e2))
      return this._users.get(e2);
  }, t2.prototype.get = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this._users.has(e2) ? [3, 3] : this.localCacheEnabled ? [4, this.collection.getByKey(e2)] : [3, 2];
          case 1:
            if (t3 = r2.sent())
              return n2 = this._deserialize(t3), this._users.set(n2.userId, n2), [2, n2];
            r2.label = 2;
          case 2:
            return [2, void 0];
          case 3:
            return [2, this._users.get(e2)];
        }
      });
    });
  }, t2.prototype.fetch = function(e2) {
    var t3 = e2.limit, n2 = void 0 === t3 ? 100 : t3, r2 = e2.backward, i2 = void 0 !== r2 && r2;
    return r(this, void 0, void 0, function() {
      var e3, t4, r3, s3 = this;
      return s(this, function(a2) {
        switch (a2.label) {
          case 0:
            if (!this.localCacheEnabled)
              return [2, []];
            a2.label = 1;
          case 1:
            return a2.trys.push([1, 4, , 5]), e3 = { index: ["-userId", "-updatedAt"], backward: i2 }, [4, this.collection.query(e3)];
          case 2:
            return [4, a2.sent().fetch({ limit: n2 })];
          case 3:
            return t4 = a2.sent(), (r3 = t4.map(function(e4) {
              return s3._deserialize(e4);
            })).forEach(function(e4) {
              s3._users.has(e4.userId) || s3._users.set(e4.userId, e4);
            }), [2, r3];
          case 4:
            return a2.sent(), [2, []];
          case 5:
            return [2];
        }
      });
    });
  }, t2.prototype.upsert = function(e2, t3) {
    return r(this, void 0, void 0, function() {
      var n2, r2;
      return s(this, function(i2) {
        switch (i2.label) {
          case 0:
            if (!this.localCacheEnabled)
              return [3, 2];
            if (n2 = this._serialize(e2, t3), r2 = this._users.get(e2.userId)) {
              if (r2._hashValue === e2._hashValue)
                return [2];
              if (r2._updatedAt > t3)
                return [2];
            }
            return this._users.set(e2.userId, ls._buildUserFromSerializedData(n2)), [4, this.collection.upsertOne(n2)];
          case 1:
            i2.sent(), i2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.remove = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this._users.has(e2) && this._users.delete(e2), this.localCacheEnabled ? [4, this.collection.remove(e2)] : [3, 2];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2.prototype.clearMemoryCache = function() {
    this._users.clear();
  }, t2.prototype.clear = function() {
    return r(this, void 0, void 0, function() {
      return s(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.clearMemoryCache(), this.localCacheEnabled ? [4, this.collection.clear()] : [3, 2];
          case 1:
            e2.sent(), e2.label = 2;
          case 2:
            return [2];
        }
      });
    });
  }, t2;
}(Jr);
var sa = function(t2) {
  function n2(n3) {
    var r2 = this, s3 = n3.reverse, a2 = void 0 !== s3 && s3, o2 = n3.limit, u2 = void 0 === o2 ? 20 : o2, c2 = n3.keys, l = n3.token;
    return (r2 = t2.call(this) || this).method = ae.GET, r2.path = "".concat(Ae), r2.params = se({ token: l, limit: u2, reverse: a2, order: J.UPDATED_AT, show_ui_template: true, show_color_variables: true, keys: c2 }), r2;
  }
  return t(n2, t2), n2;
}(Fe);
var aa = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this, i2 = n2.next, s3 = n2.has_more, a2 = void 0 !== s3 && s3, o2 = n2.templates;
    return r2.nextToken = i2, r2.hasMore = a2, r2.templates = o2.map(function(e2) {
      return { template: JSON.stringify(e2) };
    }), r2;
  }
  return t(t2, e), t2;
}(qe);
var oa = function(e) {
  function t2(t3) {
    var n2 = this, r2 = t3.key;
    return (n2 = e.call(this) || this).method = ae.GET, n2.path = "".concat(Ae, "/").concat(r2), n2;
  }
  return t(t2, e), t2;
}(Fe);
var ua = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.template = JSON.stringify(n2), r2;
  }
  return t(t2, e), t2;
}(qe);
var ca = {};
var la = function() {
  function n2(e, t2) {
    var n3 = t2.sdkState, r2 = t2.dispatcher, i2 = t2.requestQueue, s3 = t2.onlineDetector, a2 = t2.cacheContext;
    this._iid = e, this._sdkState = n3, this._requestQueue = i2, this._dispatcher = r2, this._cacheContext = a2, Zs.of(e), Js.of(e), na.of(e), this.fileMessageQueue = new Lt(e, { sdkState: n3, dispatcher: r2, requestQueue: i2, onlineDetector: s3, cacheContext: a2 }), ca[e] = this;
  }
  return n2.of = function(e) {
    return ca[e];
  }, n2.prototype._setSenderInfo = function(e) {
    if (this._cacheContext.localCacheEnabled && (e.messageType === G.USER || e.messageType === G.FILE)) {
      var t2 = e.sender;
      if (t2) {
        var n3 = ia.of(this._iid).getUserInfoFromCache(t2.user_id);
        n3 && (e.sender = ls.payloadify(n3));
      }
    }
  }, n2.prototype.buildMessageFromSerializedData = function(e) {
    var t2 = as(e);
    if (t2.notificationId)
      return new St(this._iid, St.payloadify(t2));
    switch (this._setSenderInfo(t2), t2.messageType) {
      case G.USER:
        return new wt(this._iid, wt.payloadify(t2));
      case G.FILE:
        return Mt._isMultipleFilesMessageSerializedData(t2) ? new Mt(this._iid, Mt.payloadify(t2)) : new Nt(this._iid, Nt.payloadify(t2));
      case G.ADMIN:
        return new It(this._iid, It.payloadify(t2));
    }
    throw b.invalidParameters;
  }, n2.prototype.buildUserMessageCreateParamsFromSerializedData = function(n3, r2) {
    return se(oe({ data: r2.data, customType: r2.customType, mentionType: r2.mentionType, mentionedUserIds: r2.mentionedUserIds, mentionedUsers: r2.mentionedUsers, mentionedMessageTemplate: r2.mentionedMessageTemplate, metaArrays: r2.metaArrays, parentMessageId: r2.parentMessageId, isReplyToChannel: n3.isReplyToChannel, pushNotificationDeliveryOption: n3.pushNotificationDeliveryOption, appleCriticalAlertOptions: r2.appleCriticalAlertOptions, reqId: r2.reqId, message: r2.message, translationTargetLanguages: Object.keys(r2.translations), pollId: n3.pollId }));
  }, n2.prototype.buildFileMessageCreateParamsFromSerializedData = function(n3, r2) {
    var i2;
    return se(oe({ data: r2.data, customType: r2.customType, mentionType: r2.mentionType, mentionedUserIds: r2.mentionedUserIds, mentionedUsers: r2.mentionedUsers, metaArrays: r2.metaArrays, parentMessageId: r2.parentMessageId, isReplyToChannel: n3.isReplyToChannel, pushNotificationDeliveryOption: n3.pushNotificationDeliveryOption, appleCriticalAlertOptions: r2.appleCriticalAlertOptions, reqId: r2.reqId, file: n3.file, fileKey: n3.fileKey, fileUrl: r2.plainUrl, fileName: r2.name, fileSize: r2.size, mimeType: r2.type, thumbnailSizes: null === (i2 = r2.thumbnails) || void 0 === i2 ? void 0 : i2.map(function(e) {
      return { maxWidth: e.width, maxHeight: e.height };
    }), fileType: n3.fileType, requireAuth: r2.requireAuth }));
  }, n2.prototype.buildMultipleFilesMessageCreateParamsFromSerializedData = function(t2, n3) {
    var r2 = this;
    return se({ data: n3.data, customType: n3.customType, mentionType: n3.mentionType, mentionedUserIds: n3.mentionedUserIds, mentionedUsers: n3.mentionedUsers, metaArrays: n3.metaArrays, parentMessageId: n3.parentMessageId, isReplyToChannel: t2.isReplyToChannel, pushNotificationDeliveryOption: t2.pushNotificationDeliveryOption, appleCriticalAlertOptions: n3.appleCriticalAlertOptions, reqId: n3.reqId, fileInfoList: t2.fileInfoList.map(function(e) {
      return new Ct(r2._iid, e);
    }) });
  }, n2.prototype.buildScheduledUserMessageCreateParamsFromSerializedData = function(e, t2) {
    return n(n({}, this.buildUserMessageCreateParamsFromSerializedData(e, t2)), { scheduledAt: e.scheduledAt });
  }, n2.prototype.buildScheduledFileMessageCreateParamsFromSerializedData = function(e, t2) {
    return n(n({}, this.buildFileMessageCreateParamsFromSerializedData(e, t2)), { scheduledAt: e.scheduledAt });
  }, n2.prototype.buildSenderFromSerializedData = function(e) {
    var t2 = as(e);
    return new Ge2(this._iid, Ge2.payloadify(t2));
  }, n2.prototype.getMessage = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return t2 = new Gt(e), [4, this._requestQueue.send(t2)];
          case 1:
            return n3 = r2.sent(), [2, n3.as(Vt).message];
        }
      });
    });
  }, n2.prototype.getScheduledMessage = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return t2 = new Xt(e), [4, this._requestQueue.send(t2)];
          case 1:
            return n3 = r2.sent(), [2, n3.as(Zt).message];
        }
      });
    });
  }, n2.prototype.getMessagesByMessageId = function(e, t2, n3, r2, i2) {
    return void 0 === i2 && (i2 = no.REQUEST_MESSAGE), r(this, void 0, void 0, function() {
      var s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return s3 = new Ht(n(n(n({ channelType: t2, channelUrl: e, token: String(n3) }, zt), r2), { sdkSource: qt.EXTERNAL_LEGACY })), [4, this._requestQueue.send(s3)];
          case 1:
            return a2 = c2.sent(), o2 = a2.as(Wt).messages, this._dispatcher.dispatch(new po({ messages: o2, source: i2 })), [2, o2];
        }
      });
    });
  }, n2.prototype.getMessagesByTimestamp = function(e, t2, n3, r2, i2) {
    return void 0 === i2 && (i2 = no.REQUEST_MESSAGE), r(this, void 0, void 0, function() {
      var s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return s3 = new Ht(n(n(n({ channelType: t2, channelUrl: e, timestamp: n3 }, zt), r2), { sdkSource: qt.EXTERNAL_LEGACY })), [4, this._requestQueue.send(s3)];
          case 1:
            return a2 = c2.sent(), o2 = a2.as(Wt).messages, this._dispatcher.dispatch(new po({ messages: o2, source: i2 })), [2, o2];
        }
      });
    });
  }, n2.prototype._getMessagesByTimestampForCollection = function(e, t2, n3, r2, i2, s3, a2, o2) {
    return void 0 === i2 && (i2 = no.REQUEST_MESSAGE), r(this, void 0, void 0, function() {
      var c2, l, d, h, f, p;
      return s(this, function(m) {
        switch (m.label) {
          case 0:
            return c2 = new Ht(n(n(n({ channelType: t2, channelUrl: e, timestamp: n3 }, zt), r2), { checkingHasNext: s3, checkingContinuousMessages: a2, sdkSource: o2 })), [4, this._requestQueue.send(c2)];
          case 1:
            return l = m.sent(), d = l.as(Wt), h = d.messages, f = d.isContinuousMessages, p = d.hasNext, this._dispatcher.dispatch(new po({ messages: h, source: i2 })), [2, { messages: h, isContinuousMessages: f, hasNext: p }];
        }
      });
    });
  }, n2.prototype.getThreadedMessagesByTimestamp = function(e, t2, n3, r2) {
    return void 0 === r2 && (r2 = no.REQUEST_THREADED_MESSAGE), r(this, void 0, void 0, function() {
      var i2, s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return i2 = new Ht(n(n(n({ channelUrl: e.channelUrl, channelType: e.channelType, timestamp: t2 }, gt), n3), { replyType: Q.ALL, parentMessageId: e.messageId, includeThreadInfo: true })), [4, this._requestQueue.send(i2)];
          case 1:
            return s3 = c2.sent(), a2 = s3.as(Wt).messages, (o2 = a2.slice(1)).forEach(function(t3) {
              t3.parentMessage = e;
            }), this._dispatcher.dispatch(new po({ messages: o2, source: r2 })), [2, { parentMessage: a2[0], threadedMessages: o2 }];
        }
      });
    });
  }, n2.prototype.getMessageTemplatesByToken = function(e, t2) {
    return void 0 === t2 && (t2 = {}), r(this, void 0, void 0, function() {
      var n3, r2, i2, s3, a2, o2;
      return s(this, function(c2) {
        switch (c2.label) {
          case 0:
            return n3 = new sa(n({ token: e }, t2)), [4, this._requestQueue.send(n3)];
          case 1:
            return r2 = c2.sent(), i2 = r2.as(aa), s3 = i2.hasMore, a2 = i2.nextToken, o2 = i2.templates, [2, { hasMore: s3, token: a2, templates: o2 }];
        }
      });
    });
  }, n2.prototype.getMessageTemplate = function(e) {
    return r(this, void 0, void 0, function() {
      var t2, n3;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return t2 = new oa({ key: e }), [4, this._requestQueue.send(t2)];
          case 1:
            return n3 = r2.sent(), [2, { template: n3.as(ua).template }];
        }
      });
    });
  }, n2.prototype.getMessageChangelogs = function(n3, r2, i2, s3, a2) {
    return void 0 === a2 && (a2 = no.REQUEST_MESSAGE_CHANGELOGS), r(this, void 0, void 0, function() {
      var o2, c2, l, d, h, f, p, m, v2;
      return s(this, function(y) {
        switch (y.label) {
          case 0:
            return o2 = new Yt(se(oe(n(n({ channelType: r2, channelUrl: n3, timestamp: "number" == typeof i2 ? i2 : null, token: "string" == typeof i2 ? i2 : null }, jt), s3)))), [4, this._requestQueue.send(o2)];
          case 1:
            return c2 = y.sent(), l = c2.as(Jt), d = l.updatedMessages, h = l.deletedMessagesInfo, f = l.hasMore, p = l.nextToken, m = l.forceUseNextToken, v2 = h.map(function(e) {
              return e.messageId;
            }), d.length > 0 && this._dispatcher.dispatch(new po({ messages: d, source: a2 })), v2.length > 0 && this._dispatcher.dispatch(new Eo({ messageIds: v2, source: a2 })), [2, { updatedMessages: d, deletedMessageIds: v2, hasMore: f, token: p, forceUseNextToken: m }];
        }
      });
    });
  }, n2;
}();
var da = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3) || this;
    r2.targetMessageId = 0;
    var i2 = n2.thread_info, s3 = n2.parent_message_id, a2 = n2.channel_url, o2 = n2.channel_type;
    return i2 && S("object", i2) && S("number", s3) && S("string", a2) && S("string", o2) && (r2.threadInfo = new De(t3, i2), r2.targetMessageId = s3, r2.channelUrl = a2, r2.channelType = o2), r2;
  }
  return t(t2, e), t2;
}(Jr);
var ha = { channelUrl: "", channelType: H.BASE, messageId: 0, includeReactions: false, includeMetaArray: false, includeParentMessageInfo: false, includeThreadInfo: false };
var fa = function(t2) {
  function n2(n3) {
    var r2 = n3.channelCustomType, s3 = n3.keyword, a2 = n3.limit, o2 = n3.reverse, u2 = n3.exactMatch, c2 = n3.channelUrl, l = n3.order, d = n3.messageTimestampFrom, h = n3.messageTimestampTo, f = n3.advancedQuery, p = n3.targetFields, m = n3.nextToken, v2 = t2.call(this) || this;
    return v2.method = ae.GET, v2.path = "".concat(Ee, "/messages"), v2.params = se({ custom_type: r2, query: s3, limit: a2, reverse: o2, exact_match: u2, channel_url: c2, message_ts_from: d, message_ts_to: h, sort_field: l, advanced_query: f, target_fields: p, after: m }), v2;
  }
  return t(n2, t2), n2;
}(Fe);
var pa = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.messages = n2.results.map(function(e2) {
      return At(t3, e2);
    }), r2.hasNext = n2.has_next, r2.nextToken = n2.end_cursor, r2.totalCount = n2.total_count, r2;
  }
  return t(t2, e), t2;
}(qe);
!function(e) {
  e.SCORE = "score", e.TIMESTAMP = "ts";
}(zs || (zs = {}));
var ma = function(e) {
  function i2(t2, n2) {
    var r2, i3, s3, a2, o2, u2, c2, l, d, h = this;
    return (h = e.call(this, t2, n2) || this).keyword = "", h.reverse = false, h.exactMatch = false, h.channelUrl = null, h.channelCustomType = null, h.messageTimestampFrom = null, h.messageTimestampTo = null, h.order = zs.SCORE, h.advancedQuery = false, h.targetFields = null, h._nextToken = "", h.totalCount = -1, h.keyword = n2.keyword, h.reverse = null !== (r2 = n2.reverse) && void 0 !== r2 && r2, h.exactMatch = null !== (i3 = n2.exactMatch) && void 0 !== i3 && i3, h.channelUrl = null !== (s3 = n2.channelUrl) && void 0 !== s3 ? s3 : null, h.channelCustomType = null !== (a2 = n2.channelCustomType) && void 0 !== a2 ? a2 : null, h.messageTimestampFrom = null !== (o2 = n2.messageTimestampFrom) && void 0 !== o2 ? o2 : null, h.messageTimestampTo = null !== (u2 = n2.messageTimestampTo) && void 0 !== u2 ? u2 : null, h.order = null !== (c2 = n2.order) && void 0 !== c2 ? c2 : zs.SCORE, h.advancedQuery = null !== (l = n2.advancedQuery) && void 0 !== l && l, h.targetFields = null !== (d = n2.targetFields) && void 0 !== d ? d : null, h;
  }
  return t(i2, e), i2.prototype._validate = function() {
    return e.prototype._validate.call(this) && S("string", this.keyword) && this.keyword.length > 0 && S("boolean", this.reverse) && S("boolean", this.exactMatch) && S("string", this.channelUrl, true) && S("string", this.channelCustomType, true) && S("number", this.messageTimestampFrom, true) && S("number", this.messageTimestampTo, true) && T(zs, this.order) && S("boolean", this.advancedQuery) && C("string", this.targetFields, true);
  }, i2.prototype.next = function() {
    return r(this, void 0, void 0, function() {
      var e2, r2, i3, s3, a2, o2, c2, l;
      return s(this, function(d) {
        switch (d.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, r2 = new fa(oe(n(n({}, this), { nextToken: this._nextToken ? this._nextToken : null }))), [4, e2.send(r2)]) : [3, 2] : [3, 5];
          case 1:
            return i3 = d.sent(), s3 = i3.as(pa), a2 = s3.messages, o2 = s3.hasNext, c2 = s3.nextToken, l = s3.totalCount, this._nextToken = c2, this._hasNext = o2, this._isLoading = false, this.totalCount = l, [2, a2];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, i2;
}(Oo);
var va = function(n2) {
  function s3(r2) {
    var s4 = r2.channelType, a2 = r2.channelUrl, o2 = r2.limit, u2 = r2.token, c2 = n2.call(this) || this;
    return c2.method = ae.GET, c2.path = "".concat(Re(s4), "/").concat(encodeURIComponent(a2), "/messages/parent_thread_message"), c2.params = se(oe({ limit: o2, token: u2 })), c2;
  }
  return t(s3, n2), s3;
}(Fe);
var ya = function(e) {
  function t2(t3, n2) {
    var r2 = e.call(this, t3, n2) || this;
    return r2.token = n2.next, r2.messages = n2.messages.map(function(e2) {
      return At(t3, e2);
    }), r2;
  }
  return t(t2, e), t2;
}(qe);
var _a = function(e) {
  function t2(t3, n2, r2, i2) {
    var s3 = e.call(this, t3, n2, r2, i2) || this;
    return s3._edge = "", s3;
  }
  return t(t2, e), t2.prototype._validate = function() {
    return e.prototype._validate.call(this);
  }, t2.prototype.load = function() {
    return r(this, void 0, void 0, function() {
      var e2, t3, r2, i2, s3, a2;
      return s(this, function(o2) {
        switch (o2.label) {
          case 0:
            return this._validate() ? this._isLoading ? [3, 3] : this._hasNext ? (this._isLoading = true, e2 = uo.of(this._iid).requestQueue, t3 = new va({ channelType: this.channelType, channelUrl: this.channelUrl, token: this._edge, limit: this.limit }), [4, e2.send(t3)]) : [3, 2] : [3, 5];
          case 1:
            return r2 = o2.sent(), i2 = r2.as(ya), s3 = i2.messages, a2 = i2.token, this._edge = a2, this._hasNext = !!a2, this._isLoading = false, [2, s3];
          case 2:
            return [2, []];
          case 3:
            throw b.queryInProgress;
          case 4:
            return [3, 6];
          case 5:
            throw b.invalidParameters;
          case 6:
            return [2];
        }
      });
    });
  }, t2;
}(ko);
var ga = { channelUrl: "", scheduledMessageId: 0 };
var ba = { reverse: false, limit: 20 };
var Ia = function(e) {
  function t2() {
    var t3 = null !== e && e.apply(this, arguments) || this;
    return t3.name = "message", t3;
  }
  return t(t2, e), t2.prototype.init = function(t3, n2) {
    var r2 = n2.sdkState, i2 = n2.dispatcher, s3 = n2.sessionManager, a2 = n2.requestQueue, o2 = n2.logger, u2 = n2.onlineDetector, c2 = n2.cacheContext;
    e.prototype.init.call(this, t3, { sdkState: r2, dispatcher: i2, sessionManager: s3, requestQueue: a2, logger: o2, onlineDetector: u2, cacheContext: c2 }), this._manager = new la(t3, { sdkState: r2, dispatcher: i2, requestQueue: a2, onlineDetector: u2, cacheContext: c2 });
  }, t2.prototype.buildMessageFromSerializedData = function(e2) {
    return this._manager.buildMessageFromSerializedData(e2);
  }, t2.prototype.buildSenderFromSerializedData = function(e2) {
    return this._manager.buildSenderFromSerializedData(e2);
  }, t2.prototype.getMessage = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3, n2;
      return s(this, function(r2) {
        switch (r2.label) {
          case 0:
            return t3 = n(n({}, ha), e2), cs(function(e3) {
              return S("string", e3.channelUrl) && T(H, e3.channelType) && S("number", e3.messageId) && S("boolean", e3.includeReactions, true) && S("boolean", e3.includeMetaArray, true) && S("boolean", e3.includeParentMessageInfo, true) && S("boolean", e3.includeThreadInfo, true);
            }(t3)).throw(b.invalidParameters), [4, this._manager.getMessage(t3)];
          case 1:
            if ((n2 = r2.sent()) instanceof yt || n2 instanceof St || null === n2)
              return [2, n2];
            throw "Unknown message type is given.";
        }
      });
    });
  }, t2.prototype.getScheduledMessage = function(e2) {
    return r(this, void 0, void 0, function() {
      var t3;
      return s(this, function(n2) {
        return t3 = n(n({}, ga), e2), cs(function(e3) {
          return S("string", e3.channelUrl) && "" !== e3.channelUrl && S("number", e3.scheduledMessageId) && e3.scheduledMessageId > 0;
        }(t3)).throw(b.invalidParameters), [2, this._manager.getScheduledMessage(t3)];
      });
    });
  }, t2.prototype.getMessageTemplatesByToken = function(e2, t3) {
    return void 0 === t3 && (t3 = {}), r(this, void 0, void 0, function() {
      var n2;
      return s(this, function(r2) {
        return n2 = n(n({}, ba), t3), cs(S("string", e2, true) && function(e3) {
          return S("boolean", e3.reverse, true) && S("number", e3.limit, true) && C("string", e3.keys, true);
        }(n2)).throw(b.invalidParameters), [2, this._manager.getMessageTemplatesByToken(e2, n2)];
      });
    });
  }, t2.prototype.getMessageTemplate = function(e2) {
    return r(this, void 0, void 0, function() {
      return s(this, function(t3) {
        return cs(S("string", e2)).throw(b.invalidParameters), [2, this._manager.getMessageTemplate(e2)];
      });
    });
  }, t2;
}(lo);

// node_modules/@sendbird/chat/lib/__bundle-acd77193.js
var s2 = function(s3, i2) {
  this.pollId = 0, this.messageId = 0, this.pollId = i2.poll.id, this.messageId = i2.poll.message_id, this._iid = s3, this._payload = i2;
};

export {
  Pe,
  Re2 as Re,
  xe2 as xe,
  De,
  Le2 as Le,
  Fe2 as Fe,
  Ke,
  Qe,
  Ve,
  Ye,
  Je,
  Ze,
  lt,
  dt,
  ht,
  yt,
  _t,
  It,
  Et,
  wt,
  St,
  Ut,
  At,
  Nt,
  Pt,
  qt,
  Qt,
  $t,
  en,
  tn,
  nn,
  un,
  ln,
  vn,
  yn,
  _n,
  bn,
  In,
  En,
  Tn,
  Un,
  On,
  Rn,
  Gn,
  nr,
  ar,
  ur,
  lr,
  hr,
  pr,
  Ir,
  Tr,
  Mr,
  Pr,
  Hr,
  Wr,
  Yr,
  Jr2 as Jr,
  Xr,
  Zr2 as Zr,
  $r,
  ti,
  ni,
  ri,
  ii,
  ai,
  oi,
  ui,
  ci,
  li,
  fi,
  pi,
  yi,
  bi,
  Ii,
  Ti,
  wi,
  Mi,
  Si,
  Ni,
  ki,
  xi,
  Li,
  Ns,
  Os,
  ks,
  Ps,
  Rs,
  xs,
  Ds,
  Ls,
  Fs,
  qs,
  Bs,
  js,
  Ks,
  Qs,
  Gs,
  Vs,
  Hs,
  Ws,
  Js,
  Zs,
  na,
  ia,
  la,
  da,
  ma,
  _a,
  Ia,
  s2 as s
};
//# sourceMappingURL=chunk-TTFJWE4I.js.map
